(function(){var $ID="mstrFilterPanelMenu",$BOX="mstrmojo.Box",$BOXC="mstrmojo-Menu-Box",$SEGBROWID="segBrow",$D=mstrmojo.desc;var fnClearAllFilters=function(){var mn=mstrmojo.all[$ID],fps=mn.fps;if(!fps||!fps.children){return ;}for(var i in fps.children){var pal=fps.children[i];if(!pal.children){continue;}for(var j in pal.children){var s=pal.children[j];if(typeof (s.defn.ttl)!="undefined"){s=s.children[1];}if(s.model){var evt={tks:s.tks,ck:s.ck,ctlKey:s.ckey,unset:true};fps.bufferSlice(evt);s.node.data.ces=[];s.node.defn.cek=null;s.node.data.cs=[];var cnt=s.content;if(s.node.defn.style==mstrmojo.DocSelectorViewFactory.STYLES.SEARCH_BOX){cnt.set("items",[]);}if(s.node.defn.style==mstrmojo.DocSelectorViewFactory.STYLES.SCROLLER){cnt.min=0;var len=cnt.items&&cnt.items.length;cnt.max=len?len-1:0;}s.update(s.node);s.refresh();}}}fps.applyBufferedSlices();mn.close();};var fnApplyBufferedSlices=function(){var mn=mstrmojo.all[$ID],fps=mn.fps;if(fps&&fps.applyBufferedSlices){fps.applyBufferedSlices();}mn.close();};var fnOpenSegmentSaveAs=function(){var mn=mstrmojo.all[$ID],fps=mn.fps;mstrmojo.loader.load("mstrmojo.SegmentSaveAs");var seg=mstrmojo.insert({scriptClass:"mstrmojo.SegmentSaveAs",fps:fps});seg.open();mn.close();};var fnOpenSegmentBrowser=function(){var seg=mstrmojo.all[$SEGBROWID],mn=mstrmojo.all[$ID],fps=mn.fps;if(!seg){mstrmojo.loader.load("mstrmojo.SegmentBrowser");seg=mstrmojo.insert({scriptClass:"mstrmojo.SegmentBrowser",id:$SEGBROWID,folderLinksContextId:25,browsableTypes:259,fps:fps});}if(seg){seg.open();}mn.close();};var fnCollapseAll=function(){_dsChangeAll(false);};var fnExpandAll=function(){_dsChangeAll(true);};var fnSetAutoSubmit=function(){var mn=mstrmojo.all[$ID],fps=mn.fps,nv=!mn.autoSubmit,props={},cb={success:function(){mn.set("autoSubmit",nv);mn.fps.defn.set("cas",nv);fps.parent.buttonbar.applyNow.set("visible",!nv);fps.parent.adjustFPHeight2Fit();mstrmojo.css.toggleClass(fps.parent.toolbarNode,["cas"],!nv);}};props[fps.k]={FormattingLayout:"CtlAutoSubmit\u001F"+(nv?1:0)};fps.applyBufferedSlices();fps.model.saveRWProps(fps.k,props,1,false,cb);mn.close();};function _dsChangeAll(bExpd){var mn=mstrmojo.all[$ID],fps=mn.fps;if(!fps||!fps.children){return ;}var props,val;for(var i in fps.children){var pal=fps.children[i];if(!pal.children||!pal.selected){continue;}for(var j in pal.children){var s=pal.children[j];if(typeof (s.defn.ttl)!="undefined"){var f=bExpd?"onexpand":"oncollapse";val=s[f]({all:true});props=mstrmojo.hash.copy(val,props);}}}if(props){fps.model.saveRWProps(fps.k,props,1,false,{});}mn.close();}function createFPMnBtn(t,clkFn,bds){var btn={scriptClass:"mstrmojo.MenuItem",text:t,cssClass:"mstrmojo-InteractiveButton",onclick:clkFn,bindings:bds};return btn;}function createCheckableFPMnBtn(t,clkFn,bds){bds=bds||{};bds.pressed="mstrmojo.all['"+$ID+"'].autoSubmit";bds.iconClass="this.pressed?'pressed':''";var btn=createFPMnBtn(t,clkFn,bds);btn.onpressedChange=function(){if(this.domNode){mstrmojo.css.toggleClass(this.domNode,"pressed",this.pressed);}};return btn;}mstrmojo.FilterPanelMenu=mstrmojo.registry.ref({id:$ID,slot:"popupNode",scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-Menu",shadowNodeCssClass:"mstrmojo-Menu-shadow",contentNodeCssClass:"mstrmojo-Menu-content",locksHover:true,autoSubmit:true,onOpen:function onOpen(){var op=this.opener,opNode=op&&op[this.slot],opPos=mstrmojo.dom.position(opNode),opTop=opPos.y||0,cmPos=this.cmPos,x,y,diff;if(cmPos){x=cmPos.x;y=cmPos.y-opTop;}else{var el=this.openerButton.domNode;diff=mstrmojo.boxmodel.offset(el,opNode);x=diff.left;y=diff.top+((el&&el.offsetHeight)||0);}var dim=mstrmojo.dom.windowDim(),dn=this.domNode;var h=dn.offsetHeight,bH=dim.h-opTop;diff=Math.max(0,y+h-bH);this.set("top",y-diff+"px");var w=dn.offsetWidth,bW=dim.w;diff=Math.max(0,x+w-bW);this.set("left",x-diff+"px");this.set("autoSubmit",this.fps.defn.cas);},children:[{scriptClass:$BOX,bindings:{},cssClass:$BOXC,children:[createFPMnBtn(mstrmojo.desc(8974,"Clear all filters"),fnClearAllFilters,{}),createFPMnBtn("Apply Now",fnApplyBufferedSlices,{visible:"!mstrmojo.all['"+$ID+"'].autoSubmit",enabled:"mstrmojo.all['"+$ID+"'].fps.applyEnabled"})]},{scriptClass:$BOX,cssClass:$BOXC,bindings:{},children:[createFPMnBtn(mstrmojo.desc(8970,"Expand all"),fnExpandAll,{}),createFPMnBtn(mstrmojo.desc(8971,"Collapse all"),fnCollapseAll,{})]},{scriptClass:$BOX,cssClass:$BOXC,bindings:{},children:[createCheckableFPMnBtn(mstrmojo.desc(1996,"Auto-Apply changes"),fnSetAutoSubmit,{})]}]});}());