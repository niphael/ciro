(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.hash","mstrmojo.TreeNode");var _D=mstrmojo.dom;mstrmojo.TreeBrowserNode=mstrmojo.declare(mstrmojo.TreeNode,null,{scriptClass:"mstrmojo.TreeBrowserNode",markupString:'<li id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" mstrAttach:mousedown,click,dblclick><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><img class="mstrmojo-TreeNode-checkBox" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><ul class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</ul></li>',markupSlots:mstrmojo.hash.copy({checkBoxNode:function(){return this.domNode.firstChild.childNodes[1];}},mstrmojo.TreeNode.prototype.markupSlots),blockBegin:1,allowUnlistedValues:false,contentRetrieved:false,onstateChange:function onstateChange(){if(!this.contentRetrieved&&(this.state==1)){this.set("items",[this.tree.loadingItemCreaterFunc()]);this.tree.getContent(this,this.blockBegin);}},toggleState:function toggleState(){if(this.state!==2){this.set("state",this.state===1?0:1);}},preclick:function preclick(evt){_D.clearBrowserHighlights(evt.hWin);return false;},predblclick:function predblclick(evt){_D.clearBrowserHighlights(evt.hWin);return false;},premousedown:function pmd(evt){var D=mstrmojo.dom,t=mstrmojo.dom.eventTarget(evt.hWin,evt.e),tree=this.tree,isLeaf=(this.state==2),icn=D.contains(this.itemsContainerNode,D.eventTarget(evt.hWin,evt.e),true,this.domNode),toggleOnClick=(tree.branchClickPolicy==mstrmojo.TreeBrowserEnum.BRANCH_POLICY_TOGGLE);if(this.isSpecialNode()||!(t==this.checkBoxNode||(t==this.textNode&&(isLeaf||!toggleOnClick)))){D.stopPropogation(evt.hWin,evt.e);}if((t==this.stateNode)||(t==this.textNode&&!isLeaf&&toggleOnClick)){if(!isLeaf){this.toggleState();}}else{if(t==this.checkBoxNode||icn){if(this._super){this._super(evt);}}else{this.handleNodeClicked();}}},isSpecialNode:function isSpecialNode(){var st=this.data&&this.data.st;return(st<0);},handleNodeClicked:function handleNodeClicked(){var tree=this.tree,w=this.parent,data=this.data;switch(data&&data.st){case"-4":mstrmojo.css.addClass(this.textNode,["loading"]);tree.getContent(w,w.blockBegin-tree.blockCount);break;case"-3":mstrmojo.css.addClass(this.textNode,["loading"]);tree.getContent(w,w.blockBegin+tree.blockCount);break;case"-1":case"-2":break;default:if(tree.handleNodeClicked){tree.handleNodeClicked(data);}}},init:function(props){this._super(props);this.set("state",this.tree.isBranch(this.data)?0:2);},postBuildRendering:function postBuildRendering(){if(this._super){this._super();}var _handler=function(e){_D.preventDefault(window,e||window.event);return false;};_D.attachEvent(this.domNode,"mousedown",_handler);if(this.isSpecialNode()||this.tree.noCheckBox){this.checkBoxNode.style.display="none";}}});})();