(function(){mstrmojo.requiresCls("mstrmojo.Vis","mstrmojo.VisMicroChartTable","mstrmojo.dom","mstrmojo._TouchGestures","mstrmojo._HasTouchScroller","mstrmojo.VisTextTooltip","mstrmojo.hash","mstrmojo.color","mstrmojo.css");var $CLR=mstrmojo.color,$CSS=mstrmojo.css,$HASH=mstrmojo.hash,$forEachHash=$HASH.forEach,$M=Math,$D=mstrmojo.dom;var zf=1;var PAGE_COUNT=5;var TRIANGLE_WIDTH=30;var COMPACT=0;var NORMAL=1;var LARGE=2;var DEFAULT_TH_CSS="border:none;word-break:break-word;white-space:normal;";var DEFAULT_TD_CSS="border:none;background:transparent;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-top:0px;padding-bottom:0px;";var TD_SELECTED_CSS="border:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-top:0px;padding-bottom:0px;";var TH_SELECTED_CSS="border:none;word-break:break-word;white-sapce:normal;";var NO_REPLACE=2;var IN_REPLACE=3;var TOP_Z_INDEX=200;var DOCKED_HEADER=0,OTHER_ROW=1;var ROW_AXIS=1,COL_AXIS=2;var DRILLING_ACTION=1,SELECTOR_ACTION=2,HYPERLINK_ACTION=4;var linkCount=0;var attrCount=0;var order=[];var ID_NAME={};var METRIC_INDEX={};var METRICS=[];var models=[];var LEFT_CHART_ROW="leftRow";var RIGHT_CHART_ROW="rightRow";var GFL=1;var CGL=0;var textAlign={left:"microchart-table-text-L",center:"microchart-table-text-M",right:"microchart-table-text-R"};function getParentBkgColor(){var parentNode=this.domNode.parentNode;while(parentNode){var compStyle=mstrmojo.css.getComputedStyle(parentNode);var bkgColor=compStyle.backgroundColor;if(bkgColor){if(bkgColor.indexOf("rgba")>=0){var rgba=this.utils.rgbaStr2rgba(bkgColor);if(rgba&&rgba[4]){return rgba;}}else{if(bkgColor.indexOf("rgb")>=0){var rgb=$CLR.rgbStr2rgb(bkgColor);return rgb;}}}parentNode=parentNode.parentNode;}bkgColor=this.model["background-color"];if(bkgColor){return $CLR.hex2rgb(bkgColor);}return[255,255,255];}var DEFAULT_DARK_THEME=1;var DEFAULT_LIGHT_THEME=2;var CUSTOM_DARK_THEME=3;var CUSTOM_LIGHT_THEME=4;function getUITheme(){var ct=this.model.vp.ct;if(!ct||ct==""){ct="0";}this.theme=parseInt(ct);if(this.theme==0){var rgb=getParentBkgColor.call(this);var opacity=this.otherProps.mfBkgOpacity;rgb=this.utils.getRGBWithOpacity(rgb,opacity);this.backgroundColor=this.utils.rgb2rgbStr(rgb);var brightness=(rgb[0]*299+rgb[1]*587+rgb[2]*114)/1000;if(brightness>150){this.theme=CUSTOM_LIGHT_THEME;}else{this.theme=CUSTOM_DARK_THEME;}}else{if(this.theme==1){this.backgroundColor="#333333";}else{if(this.theme==2){this.backgroundColor="#f9f9f9";}}}this.domNode.style.backgroundColor=this.backgroundColor;}function setDimensionWithDPI(){zf=this.utils.getScreenZoomFactor();var otherProps=this.otherProps;otherProps.mRowHeight=Math.round(zf*otherProps.mRowHeight);TRIANGLE_WIDTH=Math.round(zf*36);this.dropShadowWidth=Math.round(zf*7);paddingForSS=[Math.round(5*zf),Math.round(8*zf),Math.round(10*zf)];colWidthForChart=[Math.round(100*zf),Math.round(150*zf),Math.round(200*zf)];maxColWidthForAttr=[Math.round(120*zf),Math.round(150*zf),Math.round(180*zf)];maxColWidthForMetric=[Math.round(100*zf),Math.round(150*zf),Math.round(200*zf)];adjustWidthForColumnValue=[Math.round(20*zf),Math.round(40*zf),Math.round(80*zf)];}function isScrollableElementTouched(touch){if(this.enableSmoothScroll){var touchPointOnWidget=this.utils.getTouchXYOnWidget(touch.pageX,touch.pageY,this);var x=touchPointOnWidget.touchX,y=touchPointOnWidget.touchY;if(x<this.leftWidth){return false;}return true;}else{return true;}}function setNodeCssText(node,cssText){var height=node.style.height;var width=node.style.width;var textDecoration=node.style.textDecoration;var display=node.style.display;var fontSize=node.style.fontSize;var fontWeight=node.style.fontWeight;var paddingLeft=node.style.paddingLeft;var paddingRight=node.style.paddingRight;var boxShadow=node.style.boxShadow;node.style.cssText=cssText;node.style.height=height;node.style.width=width;node.style.textDecoration=textDecoration;if(display){node.style.display=display;}if(fontSize){node.style.fontSize=fontSize;}if(fontWeight){node.style.fontWeight=fontWeight;}if(paddingLeft){node.style.paddingLeft=paddingLeft;}if(paddingRight){node.style.paddingRight=paddingRight;}if(boxShadow){node.style.boxShadow=boxShadow;}}function init(w){METRICS=[];METRIC_INDEX={};ID_NAME={};order=[];models=[];GFL=1;CGL=0;linkCount=0;attrCount=0;}function initProp(){var sparklineProps=this.sparklineProps={};sparklineProps.mbShow=true;sparklineProps.mbAllPoints=false;sparklineProps.mbEndPoints=true;sparklineProps.mbRefLine=true;sparklineProps.mbRefArea=true;sparklineProps.mbAssMetric=true;sparklineProps.mbShowTooltip=true;sparklineProps.mwSeriesLineCol="#333333";sparklineProps.mwRefLineCol="#0066FF";sparklineProps.mwRefAreaCol="#DEDEDE";sparklineProps.mstrHeader="[Sparkline]";sparklineProps.mstrAssMetric="";var barProps=this.barProps={};barProps.mbShow=false;barProps.mbShowLegend=true;barProps.mbRefLine=true;barProps.mbShowTooltip=true;barProps.mwPosCol="#66CC00";barProps.mwNegCol="#FF0000";barProps.mwRefLineCol="#0066FF";barProps.mstrHeader="[Bar]";var bulletProps=this.bulletProps={};bulletProps.mbShow=true;bulletProps.mbRefLine=true;bulletProps.mbRefBands=true;bulletProps.mbShowLegend=true;bulletProps.mbAssMetric=true;bulletProps.mbInvertAxis=false;bulletProps.mbShowTooltip=true;bulletProps.mfMinValue=0;bulletProps.mwPosCol="#000066";bulletProps.mwNegCol="#FF0000";bulletProps.mwRefLineCol="#0066FF";bulletProps.mwBand1="#999999";bulletProps.mwBand2="#BBBBBB";bulletProps.mwBand3="#DEDEDE";bulletProps.mstrHeader="[Bullet]";bulletProps.mstrAssMetric="";bulletProps.mstrBand1="Low";bulletProps.mstrBand2="Medium";bulletProps.mstrBand3="High";var otherProps=this.otherProps={};otherProps.mfBkgOpacity=1;otherProps.mnMetricsPerKPI=1;otherProps.mbHideColHeaders=false;otherProps.mbHideTextColumns=false;otherProps.mbLockLayout=false;otherProps.mbShowForHiddenGraphs=true;otherProps.mbInheritFromGridGraph=false;otherProps.mbInSingleColumnMode=false;otherProps.mpColumnIDs=[];otherProps.mpColumnIDsInTreeMode=[];otherProps.mpColumnPositions=null;otherProps.mpColumnWidths=null;otherProps.mpSortKey=null;otherProps.mbSortDescend=true;otherProps.mRowHeight=36;}function isTouchedOnWidget(touch){if(!touch){return false;}var me=this;var pos=mstrmojo.dom.position(this.domNode);var x=touch.pageX-pos.x,y=touch.pageY-pos.y;if((x>0&&x<me.getWidth())&&(y>0&&y<me.getHeight())){return true;}return false;}function convertToColor(intString){var colorString=parseInt(intString).toString(16);var len=colorString.length;for(var i=len;i<6;i++){colorString="0"+colorString;}colorString="#"+colorString;return colorString;}function buildNonTreeRows(){this.rows=[];for(var i=0;i<models.length;i++){this.rows[i]={model:models[i],rowIdx:i,selected:{},rowRef:{}};}}function isSubTotal(row,rowTitles){for(var i=0;i<row.length;i++){if(row[i].etk!=undefined&&row[i].etk<0){return true;}}return false;}function getAttrIdxArray(w){var attrIDArray=w.attrIDArray;var m=w.model,gts=m.gts,rows=gts.row;var id=rows[0].id;attrIDArray[0]=id;for(var i=1;i<rows.length;i++){if(id==rows[i].id||id==rows[i].id+":CG"){}else{id=rows[i].id;attrIDArray[i]=id;}}}function getTreeNode(tree,treePath){var treePathArray=treePath.split("_");var treeNode=tree;for(var i=0;i<treePathArray.length;i++){var idx=treePathArray[i];treeNode=treeNode.childrenTreeNodeList[idx];}return treeNode;}function getPreSiblingTreeNode(tree,treePath){var treePathArray=treePath.split("_");var lowestLevelIdx=treePathArray[treePathArray.length-1];if(lowestLevelIdx>0){treePathArray[treePathArray.length-1]=lowestLevelIdx-1;var treeNode=tree;for(var i=0;i<treePathArray.length;i++){var idx=treePathArray[i];treeNode=treeNode.childrenTreeNodeList[idx];}return treeNode;}else{return null;}return null;}function getParentTreeNodeAtLevel(tree,treePath,level){var treePathArray=treePath.split("_");var treeNode=tree;for(var i=0;i<=level;i++){var idx=treePathArray[i];treeNode=treeNode.childrenTreeNodeList[idx];}return treeNode;}function getBoolValue(value){if(value===true||value==="true"){return true;}return false;}function setNeedExpandToLevel(tree,level){if(!tree){return ;}if(tree.level<=level){tree.needExpand=true;}else{tree.needExpand=false;}var treeNodeList=tree.childrenTreeNodeList;for(var j=0;j<treeNodeList.length;j++){setNeedExpandToLevel(treeNodeList[j],level);}}function initTree(){this.tree={};this.tree.childrenTreeNodeList=[];this.tree.needExpand=true;this.tree.treePath="";this.tree.level=-1;this.attrIDArray=[];this.currSelectedObj=[];this.lastSelectedObj=[];this.initDockedHeadersDone=false;}function compareTreePath(src,des){var count=src.length;if(des.length!=count){return false;}for(var i=0;i<count-1;i++){if(src[i]!=des[i].idx){return false;}}return true;}function convertDataToTreeModels(AttrIndexes){var treeNodeList=this.tree.childrenTreeNodeList,model=this.model,rhs=model.ghs.rhs,rowTitles=model.gts.row,gvs=model.gvs,expsTree=model.vp.exps&&model.vp.exps.tree;var allExpanded=expsTree&&getBoolValue(expsTree.allExpanded);var mcStatus=this.mcStatus;var expandToLevel=-1;var expandedEntryArray=mcStatus?mcStatus.expandedEntryArray:expsTree&&expsTree.expandedEntry;this.attrIDArray=[];var attrIdxArray=this.attrMapIdx;getAttrIdxArray(this);var rowAttrCount=rhs.items&&rhs.items[0]&&rhs.items[0].items&&rhs.items[0].items.length;var levelCount=attrIdxArray.length-1;this.maxTreeLevel=levelCount-2;expandToLevel=mcStatus?mcStatus.expandToLevel:allExpanded?this.maxTreeLevel-1:-1;var lastTreePath=[];for(var i=0;i<rowAttrCount;i++){lastTreePath.push(-1);}var modelIdx=-1;var gridRowCount=rhs.items.length;if(this.mcStatus&&this.mcStatus.currSelectedObj){this.currSelectedObj=this.mcStatus.currSelectedObj;}for(var i=0;i<gridRowCount;i++){var currRow=rhs.items[i].items;var sameAsLastRow=compareTreePath(lastTreePath,currRow);if(!sameAsLastRow){modelIdx++;}else{continue;}for(var j=0;j<levelCount-1;j++){var attrIdx=attrIdxArray[j];var currSelectedNodeID=this.currSelectedObj[j];if(lastTreePath[attrIdx]!=currRow[attrIdx].idx){var isSubtotal=isSubTotal(currRow);var addToNodeList=treeNodeList;var lastSameNode=null;var treePath="";for(var k=1;k<=j;k++){var treeNodeIdx=addToNodeList.length-1;if(k==j){lastSameNode=addToNodeList[treeNodeIdx];}addToNodeList=addToNodeList[treeNodeIdx].childrenTreeNodeList;treePath+=treeNodeIdx;treePath+="_";}if(isSubtotal&&lastSameNode){lastSameNode.model=models[modelIdx];break;}else{var newTreeNode={};newTreeNode.es=[];newTreeNode.es.push(rowTitles[j].es[currRow[attrIdx].idx]);var elem=rowTitles[j].es[currRow[attrIdx].idx];newTreeNode.id=elem.id;newTreeNode.n=elem.n;newTreeNode.model=models[modelIdx];newTreeNode.selected=false;newTreeNode.childrenTreeNodeList=[];newTreeNode.attrElemIdx=currRow[attrIdx].idx;newTreeNode.isLeaf=(j==this.maxTreeLevel);newTreeNode.level=j;var preSiblingCount=addToNodeList.length;newTreeNode.preSiblingCount=preSiblingCount;newTreeNode.preSibling=preSiblingCount>0?addToNodeList[preSiblingCount-1]:null;treePath+=addToNodeList.length;newTreeNode.treePath=treePath;addToNodeList.push(newTreeNode);newTreeNode.needExpand=j<=expandToLevel?true:false;if(currSelectedNodeID==newTreeNode.id){this.currSelectedObj[j]=newTreeNode;}}}}for(var j=0;j<rowAttrCount;j++){lastTreePath[j]=currRow[j].idx;}}if(expandToLevel<0&&expandedEntryArray){for(var i=0;i<expandedEntryArray.length;i++){var expandedEntry=expandedEntryArray[i];var treeNode=this.tree;for(var j=0;j<expandedEntry.length;j++){var eid=expandedEntry[j].element;var idx=mstrmojo.array.find(treeNode.childrenTreeNodeList,"id",eid);if(idx<0){break;}treeNode=treeNode.childrenTreeNodeList[idx];}treeNode.needExpand=true;}}var preOrderTreeNodeQueue=[];preOrderTreeNodeQueue.push(this.tree);var treeNode=null;while(preOrderTreeNodeQueue.length>0){treeNode=preOrderTreeNodeQueue.pop();var treeNodeList=treeNode.childrenTreeNodeList;var childrenCount=treeNodeList.length;for(var i=childrenCount-1;i>=0;i--){treeNode=treeNodeList[i];preOrderTreeNodeQueue.push(treeNode);treeNode.postSiblingCount=childrenCount-treeNode.preSiblingCount;}}}var ATTR_NAME=0,METRIC_NAME=1,METRIC_VALUE=2,CHART=3,TREE_TRIANGLE=4;DROP_SHADOW=5;function scaleColumnWidthToFitWidget(colInfos,fitToWidth){var colLen=colInfos.length;var totalWidth=0;for(var i=0;i<colLen;i++){if(colInfos[i].type==TREE_TRIANGLE){fitToWidth-=TRIANGLE_WIDTH;}else{totalWidth+=colInfos[i].colWidth;}}var scaleRatio=fitToWidth/totalWidth;for(var i=0;i<colLen;i++){if(colInfos[i].type==TREE_TRIANGLE){colInfos[i].colWidth=TRIANGLE_WIDTH;}else{colInfos[i].colWidth=Math.round(colInfos[i].colWidth*scaleRatio);}}return scaleRatio;}function getContentOffsetWidth(rows,rowIdx,colIdx){var rowInfo=rows[rowIdx],curM=rowInfo.model,elms=curM.elms,treeNode=rowInfo.treeNode,colInfos=this.colInfos,rowIdx=rowInfo.rowIdx,colCount=colInfos.length,colInfo=colInfos[colIdx],colIdx=colInfo.colIdx;if(colInfo.type==ATTR_NAME||colInfo.type==METRIC_NAME){if(this.isTreeMode){var attrName="";for(var k=0;k<treeNode.es.length;k++){attrName+=treeNode.es[k].n;}if(attrName.indexOf("&lt;")>=0){attrName=attrName.replace(/&lt;/g,"<");attrName=attrName.replace(/&gt;/g,">");}return this.getTextWidth(attrName,colInfo.valueCssClass,null,null,null,treeNode.level==0?true:false);}else{attr=elms[colInfo.order];var attrName=attr?attr.n:"";if(attrName.indexOf("&lt;")>=0){attrName=attrName.replace(/&lt;/g,"<");attrName=attrName.replace(/&gt;/g,">");}return this.getTextWidth(attrName,colInfo.valueCssClass,null,null,null,false);}}if(colInfo.type==METRIC_VALUE){var metricIdx=-1;var idx=-1;if(this.isKPI){idx=parseInt(colInfo.order)%this.otherProps.mnMetricsPerKPI;var metricIdx=rowInfo.model.metricIdx+idx;}else{if(colInfo.type==METRIC_VALUE){metricIdx=parseInt(colInfo.order);idx=metricIdx;}}var innerHTML="";var cssClass="";if(curM.refv[idx].ti===undefined){if(curM.refv[idx].ts===4){innerHTML="<img src='"+curM.refv[idx].v+"'/>";}else{innerHTML=curM.refv[idx].v;}}else{try{var model=this.model;var th=model.th[""+metricIdx];var ti=curM.refv[idx].ti;if(curM.refv[idx].ty===4){var path;if(th[ti]&&th[ti].n){path=th[ti].n;}else{path=curM.refv[idx].v;}if(path.indexOf(":")>=0){}else{var baseURL;try{baseURL=mstrApp.getConfiguration().getHostUrlByProject(mstrApp.getCurrentProjectId());}catch(err){baseURL="";}path=baseURL+path;}innerHTML="<img src='"+path+"'/>";}else{if(th[ti]&&th[ti].n&&th[ti].cni!==undefined){innerHTML=th[ti].n;}else{innerHTML=curM.refv[idx].v;}}cssClass=model.css[th[ti].cni].n;}catch(err){if(!innerHTML){innerHTML=curM.refv[idx].v;}}}var className="";if(cssClass){className=colInfo.valueCssClass+" "+cssClass;}else{if(this.valueCssClass){className=colInfo.valueCssClass+" "+this.valueCssClass;}else{className=colInfo.valueCssClass;}}return this.getTextWidth(innerHTML,className,null,null,null,this.isTreeMode&&treeNode.level==0?true:false);}return 0;}var paddingForSS=[5,8,10];var colWidthForChart=[100,150,200];var maxColWidthForAttr=[120,150,180];var maxColWidthForMetric=[100,150,200];var adjustWidthForColumnValue=[20,40,80];function updateColumnWidth(){var colInfos=this.colInfos,width=this.getWidth();if(this.enableSmoothScroll){var rows=this.isTreeMode?getTreeNodeRows.call(this,true,50):this.rows;var rowCount=Math.min(rows.length,50);var mcs=this.metricColumnsSpacing;var paddingWidth=paddingForSS[mcs];for(var j=0;j<this.colInfos.length;j++){var colInfo=this.colInfos[j];if(colInfo.type==ATTR_NAME||colInfo.type==METRIC_NAME||colInfo.type==METRIC_VALUE){var maxColumnValueW=0;for(var i=0;i<rowCount;i++){var columnW=getContentOffsetWidth.call(this,rows,i,j);if(columnW>maxColumnValueW){maxColumnValueW=columnW;}}var headerStr=colInfo.title;var midPos=Math.round(headerStr.length/2);var leftHalf=headerStr.slice(0,midPos);var rightHalf=headerStr.slice(midPos);var leftW=this.getTextWidth(leftHalf,colInfo.headerCssClass,null,null,null,true,false);var rightW=this.getTextWidth(rightHalf,colInfo.headerCssClass,null,null,null,true,false);var maxColumnHeaderW=Math.max(leftW,rightW);var finalColumnW=0;if(maxColumnValueW>maxColumnHeaderW){finalColumnW=Math.min(maxColumnValueW,maxColWidthForMetric[mcs]);}else{finalColumnW=Math.min(maxColumnValueW+adjustWidthForColumnValue[mcs],maxColumnHeaderW,100);}colInfo.colWidth=Math.round(finalColumnW+paddingWidth);colInfo.padding.l=Math.floor(paddingWidth/2);colInfo.padding.r=Math.ceil(paddingWidth/2);}else{if(colInfo.type==TREE_TRIANGLE){colInfo.colWidth=Math.round(TRIANGLE_WIDTH);}else{if(colInfo.type==DROP_SHADOW){colInfo.colWidth=Math.round(this.dropShadowWidth);}else{colInfo.colWidth=Math.round(colWidthForChart[mcs]+paddingWidth);colInfo.padding.l=Math.floor(paddingWidth/2);colInfo.padding.r=Math.ceil(paddingWidth/2);}}}}this.leftWidth=0;for(var i=0;i<this.attrColumnCount;i++){this.leftWidth+=colInfos[i].colWidth;}this.rightWidth=0;var maxMetricWidth=0;for(var i=this.attrColumnCount;i<colInfos.length;i++){console.log(i+": "+colInfos[i].colWidth);this.rightWidth+=colInfos[i].colWidth;if(colInfos[i].colWidth>maxMetricWidth){maxMetricWidth=colInfos[i].colWidth;}}if(this.leftWidth+this.rightWidth<this.getWidth()){var scaleRatio=scaleColumnWidthToFitWidget(this.colInfos,this.getWidth());this.dropShadowDiv.style.display="none";this.enableSmoothScroll=false;this.scrollerConfig.hScroll=false;this.leftWidth=this.getWidth();this.rightWidth=0;this.leftChart.style.width=this.getWidth()+"px";}else{if(this.attrColumnCount>=0){var spaceCol={order:"",type:DROP_SHADOW,title:"",titleAlign:textAlign.center,colWidth:this.dropShadowWidth,padding:{},headerCssClass:this.headerCssClass,valueCssClass:"",colIdx:this.colInfos.length};this.colInfos.splice(this.attrColumnCount,0,spaceCol);this.rightWidth+=this.dropShadowWidth;}var requiredSpace=this.leftWidth+maxMetricWidth+this.dropShadowWidth;if(this.getWidth()<requiredSpace){var rightContainWidth=Math.min(maxMetricWidth+this.dropShadowWidth,0.75*this.getWidth());this.leftWidth=this.getWidth()-rightContainWidth;var attrWidth=this.treeColumnIdx>-1?(this.leftWidth-TRIANGLE_WIDTH)/(this.attrColumnCount-1):this.leftWidth/this.attrColumnCount;for(var i=0;i<this.attrColumnCount;i++){colInfos[i].colWidth=colInfos[i].type==TREE_TRIANGLE?TRIANGLE_WIDTH:attrWidth;}}this.dropShadowDiv.style.display="block";this.scrollerConfig.hScroll=true;this.leftChart.style.width=this.leftWidth+"px";this.rightChart.style.width=this.rightWidth+"px";this.itemsContainerNode.style.width=(this.getWidth()-this.leftWidth)+"px";this.itemsContainerNode.style.left=this.leftWidth+"px";}for(var i=0;i<this.colInfos.length;i++){this.colInfos[i].colIdx=i;if(this.colInfos[i].type==TREE_TRIANGLE){this.treeColumnIdx=i;}}}else{var colLen=colInfos.length;if(this.otherProps.mpColumnWidths.length>0){scaleColumnWidthToFitWidget(this.colInfos,width);}else{if(this.treeColumnIdx>-1){colLen--;width-=TRIANGLE_WIDTH;}var chWidth=Math.round(width/colLen);for(var i=0;i<colInfos.length;i++){if(colInfos[i].type==TREE_TRIANGLE){colInfos[i].colWidth=TRIANGLE_WIDTH;}else{colInfos[i].colWidth=chWidth;}}}}}function buildColInfos(metricColIdx){var m=this.model,rows=m.gts.row,cols=m.gts.col,mes=cols[metricColIdx].es,propValue=m.vp?m.vp:{},width=this.getWidth(),otherProps=this.otherProps;otherProps.mpColumnWidths=propValue.cw?propValue.cw.split(","):(propValue.tcw?propValue.tcw.split(","):[]);var columnWidths=otherProps.mpColumnWidths;if(columnWidths.length!=order.length){columnWidths=[];otherProps.mpColumnWidths=[];}this.colInfos=[];this.showGauge=false;for(var i=0;i<order.length;i++){if(order[i]=="GaugeChart"){this.showGauge=true;}}for(var i=0,colInfoIdx=0;i<order.length;i++){var orderID=order[i];var colInfo={order:orderID,colWidth:0,padding:{},headerCssClass:" ",valueCssClass:" "};if(orderID=="LineChart"){colInfo.type=CHART;colInfo.title=this.sparklineProps.mstrHeader;colInfo.titleAlign=textAlign.center;colInfo.padding.l=Math.round(3*zf);colInfo.padding.r=Math.round(3*zf);}else{if(orderID=="BarChart"){colInfo.type=CHART;colInfo.title=this.barProps.mstrHeader;colInfo.titleAlign=textAlign.center;colInfo.padding.l=Math.round(3*zf);colInfo.padding.r=Math.round(3*zf);}else{if(orderID=="GaugeChart"){colInfo.type=CHART;colInfo.title=this.bulletProps.mstrHeader;colInfo.titleAlign=textAlign.center;colInfo.padding.l=Math.round(3*zf);colInfo.padding.r=Math.round(3*zf);}else{if(orderID=="Metric"){if(otherProps.mbHideTextColumns){this.treeColumnIdx=-1;continue;}colInfo.type=METRIC_NAME;colInfo.title=mstrmojo.desc(1158,"Metrics");colInfo.titleAlign=textAlign.left;colInfo.valueCssClass+=" "+this.valueCssClass;if(cols[metricColIdx].lm&&cols[metricColIdx].lm.length>0){colInfo.lm=cols[metricColIdx];linkCount++;}}else{if(orderID!=parseInt(orderID)){if(otherProps.mbHideTextColumns){this.treeColumnIdx=-1;continue;}colInfo.associateAttr=[];if(this.isTreeMode){this.treeColumnIdx=colInfoIdx;this.colInfos[colInfoIdx]={order:orderID,type:TREE_TRIANGLE,title:"",titleAlign:textAlign.center,colWidth:0,padding:{},headerCssClass:this.headerCssClass,valueCssClass:"",colIdx:this.treeColumnIdx};colInfo.associateAttr.push(colInfoIdx);colInfoIdx++;}colInfo.type=ATTR_NAME;colInfo.title=ID_NAME[orderID];colInfo.titleAlign=textAlign.left;colInfo.valueCssClass+=" "+this.valueCssClass;for(var j=0;j<rows.length;j++){if(orderID.split(":")[0]==rows[j].id){if(otherProps.mbInheritFromGridGraph&&rows[j].cni!==undefined&&m.css.length>rows[j].cni){colInfo.titleAlign=m.css[rows[j].cni].n;}var isFirstAttrForm=(orderID==rows[j].id+":"+rows[j].fid);if(isFirstAttrForm){attrCount++;}if(rows[j].lm&&rows[j].lm.length>0&&rows[j].lm[0].links){colInfo.lm=rows[j];if(isFirstAttrForm){linkCount++;}}var fs=rows[j].fs;for(var q=0;q<fs.length;q++){var attrID=rows[j].id+":"+fs[q].id;if(attrID==orderID){continue;}else{for(var n=0;n<order.length;n++){if(order[n]==attrID){colInfo.associateAttr.push(n);break;}}}}break;}}}else{colInfo.type=METRIC_VALUE;var index=parseInt(orderID);if(index>=mes.length){continue;}if(otherProps.mbInheritFromGridGraph&&mes[index].cni!==undefined&&m.css.length>mes[index].cni){colInfo.titleAlign=m.css[mes[index].cni].n;}else{colInfo.titleAlign=textAlign.right;}if(orderID=="0"){if(this.sparklineProps.mstrAssMetric){colInfo.title=this.sparklineProps.mstrAssMetric;}else{if(this.isKPI){colInfo.title="";}else{colInfo.title=mes[index].n;}}}else{if(orderID=="2"){if(this.bulletProps.mstrAssMetric){colInfo.title=this.bulletProps.mstrAssMetric;}else{if(this.isKPI&&this.showGauge){colInfo.title="";}else{colInfo.title=mes[index].n;}}}else{colInfo.title=mes[index].n;}}if(cols[metricColIdx].lm[index].links){colInfo.lm=cols[metricColIdx];linkCount++;}}}}}}colInfo.valueCssClass+=" microchart-table-text "+colInfo.titleAlign;colInfo.headerCssClass+=" microchart-table-text "+colInfo.titleAlign+" "+this.headerCssClass;if(columnWidths.length>0){colInfo.colWidth=parseFloat(columnWidths[i]);}colInfo.colIdx=colInfoIdx;this.colInfos[colInfoIdx++]=colInfo;}if(order.length==0){colInfos[0].title=rows[0].n;for(var i=1;i<rows.length-GFL;i++){colInfos[i].title=rows[i].n;}}if(this.enableSmoothScroll){var belongToLeft=function(type){switch(type){case ATTR_NAME:return -1;case TREE_TRIANGLE:return -1;case METRIC_NAME:return -1;default:return 1;}};var sortFunc=function(colInfo1,colInfo2){if(belongToLeft(colInfo1.type)*belongToLeft(colInfo2.type)>0){return colInfo1.colIdx<colInfo2.colIdx?-1:1;}else{return belongToLeft(colInfo1.type);}};this.colInfos.sort(sortFunc);for(var i=0;i<this.colInfos.length;i++){if(belongToLeft(this.colInfos[i].type)>0){this.attrColumnCount=i;break;}}}}function convertDataToModels(){init(this);var m=this.model,cols=m.gts.col,metricL=m.gts.col[0].es.length,rows=m.gts.row,rowL=rows.length,rl=m.gvs.items.length,propValue=m.vp?m.vp:{};if(rowL===0||metricL===0||cols.length>1){var errmsg="The widget requires at least two attributes on row axis and one metrics in column axis OR exactly one attribute on row axis and at least one metric on column axis for KPI List mode.";m.err=mstrmojo.desc(8424,errmsg);return ;}if(this.isTreeMode){var row=this.model.gts.row;if(row.length<3){this.isTreeMode=false;}}var len=rows.length;var gfid=rows[len-1].id;len=len-2;while(len>=0){if(gfid==rows[len].id){GFL++;len--;}else{break;}}if(rowL<=GFL){this.isKPI=true;}for(var i=0;i<rows.length;i++){if(rows[i].otp==1){rows[i].otp=-1;while(++i<rows.length&&rows[i].otp==1){rows[i].id+=":CG";rows[i].n=" ";rows[i].otp=-1;}}}for(var i=0;i<rows.length;i++){if(rows[i].fs&&rows[i].fs.length>0){for(var q=0;q<rows[i].fs.length;q++){if(q==0){ID_NAME[rows[i].id+":"+rows[i].fs[q].id]=rows[i].n;}else{ID_NAME[rows[i].id+":"+rows[i].fs[q].id]=" ";}}}if(rows[i].fid&&rows[i].fid.length>0){var headerTitle;headerTitle=rows[i].n;ID_NAME[rows[i].id]=headerTitle;ID_NAME[rows[i].id+":"+rows[i].fid]=headerTitle;}else{ID_NAME[rows[i].id]=rows[i].n;}}var metricIdx=-1;for(var i=0;i<cols.length;i++){if(cols[i].n="Metrics"){metricIdx=i;var mes=cols[i].es;for(var j=0;j<mes.length;j++){ID_NAME[mes[j].oid]=mes[j].n;METRIC_INDEX[mes[j].n]=j;METRIC_INDEX[mes[j].oid]=j;METRICS[j]=mes[j].n;}}}var orderValid=true;if(!propValue.co&&!propValue.tco){orderValid=false;}else{order=propValue.tco?propValue.tco.split(","):propValue.co.split(",");orderValid=processAndCheckOrderValid.call(this);if(!orderValid){propValue.cw=null;propValue.tcw=null;}}if(!orderValid){order=[];if(!this.isKPI){createNonKPIDefaultCol.call(this);}else{createKPIDefaultCol.call(this);}}var otherProps=this.otherProps;if(otherProps.mpSortKey&&otherProps.mpSortKey.length>0){var tempSortKey="";for(var i=0;i<otherProps.mpSortKey.length;i++){if(otherProps.mpSortKey[i]=="_"){break;}tempSortKey+=otherProps.mpSortKey[i];}var mIdx=METRIC_INDEX[tempSortKey];if(mIdx>=0){otherProps.mpSortKey=mIdx;}else{for(var id in ID_NAME){if(ID_NAME[id]==tempSortKey){otherProps.mpSortKey=id;break;}}if(!ID_NAME[otherProps.mpSortKey]){otherProps.mpSortKey=null;}}}else{otherProps.mpSortKey=null;}if(otherProps.mbInheritFromGridGraph&&(this.theme==CUSTOM_DARK_THEME||this.theme==CUSTOM_LIGHT_THEME)){try{var headerIndex=m.headercni?m.headercni:0;var valueIndex=m.valuecni?m.valuecni:(m.css.length-1);var getCssClass=function(name){if(name){return name;}return"";};this.headerCssClass=getCssClass(m.css[headerIndex].n);this.valueCssClass=getCssClass(m.css[valueIndex].n);if(this.valueCssClass&&this.valueCssClass.length>0){var textSpan=this.textSpan;textSpan.className=this.valueCssClass;textSpan.style.font="";this.fontSize=mstrmojo.css.getStyleValue(textSpan,"fontSize");}var fontHeight=this.getTextHeight("a",this.valueCssClass,true);if(fontHeight>otherProps.mRowHeight){otherProps.mRowHeight=fontHeight;}}catch(err){}}var applyLocale=function(proOwner,proName,dftStr,hasBracket,descID){var compareStr=dftStr;var returnStr;if(hasBracket){compareStr="["+dftStr+"]";}if(proOwner[proName]===compareStr){returnStr=mstrmojo.desc(descID,dftStr);if(hasBracket){returnStr="["+returnStr+"]";}proOwner[proName]=returnStr;}};buildColInfos.call(this,metricIdx);if(!this.isKPI){convertAttributeDrivenData(this);}else{convert(this);}var kpi=otherProps.mnMetricsPerKPI;var m=this.model;if(this.isKPI&&metricL<kpi){var errmsg="Metric per KPI should be at least 1 or less than or equal to the total number of Metrics in the widget";m.err=errmsg;return ;}if(models.length==0){var errmsg="No data returned for this view, this might be because the applied filter excludes all data";m.err=errmsg;return ;}this.buildRows();updateColumnWidth.call(this);this.showMinLabel=bulletShowMinLabel.call(this);}function processAndCheckOrderValid(){for(var i=0;i<order.length;i++){if(order[i]=="LineChart"||order[i]=="BarChart"||order[i]=="GaugeChart"||order[i]=="Metric"){continue;}if(order[i].length<3){return false;}var tstStr=order[i];var len=tstStr.length;if(tstStr[len-2]=="|"){order[i]=tstStr=tstStr.substring(0,len-2);}if(!ID_NAME[tstStr]){return false;}else{if(METRIC_INDEX[tstStr]!==undefined){order[i]=METRIC_INDEX[tstStr]+"";}else{if(this.isKPI){order[i]="0";}}}}if(this.enableSmoothScroll){return false;}var m=this.model,metricES=m.gts.col[0].es;var columnIDs=[],cIDs=[];if(this.isTreeMode){columnIDs=this.otherProps.mpColumnIDsInTreeMode;if(columnIDs.length==1){return false;}for(var i=0;i<metricES.length;i++){var metricID=metricES[i].oid;cIDs.push(metricID);}}else{columnIDs=this.otherProps.mpColumnIDs;if(this.isKPI){if(columnIDs.length<=1){return false;}cIDs.push("Metric");var metricPerKPI=this.otherProps.mnMetricsPerKPI;if(metricPerKPI>2){for(var i=0;i<metricPerKPI;i++){if(i%metricPerKPI<=1){continue;}var metricID=metricES[i].oid;cIDs.push(metricID);}}}else{if(columnIDs.length==1){return false;}var rows=m.gts.row,attrCnt=rows.length-1,rowHeaderCnt=0;for(var i=0;i<attrCnt;i++){var attr=rows[i],attrFormCnt=attr.fs&&attr.fs.length;cIDs.push(attr.id);for(var j=1;j<attrFormCnt;j++){cIDs.push(attr.fs[j].id);}rowHeaderCnt+=attrFormCnt;}for(var i=0;i<metricES.length;i++){var metricID=metricES[i].oid;cIDs.push(metricID);}}}if(cIDs.length!=columnIDs.length){return false;}for(var i=0;i<cIDs.length;i++){var metricID=cIDs[i];if(mstrmojo.array.indexOf(columnIDs,metricID)==-1){return false;}}return true;}function createKPIDefaultCol(){var ind=0;var otherProps=this.otherProps,sparklineProps=this.sparklineProps,barProps=this.barProps,bulletProps=this.bulletProps;order[ind++]="Metric";var kpi=otherProps.mnMetricsPerKPI;if(isNaN(kpi)){kpi=1;}var firstChartShow=false;if(sparklineProps.mbShow){firstChartShow=true;order[ind++]="LineChart";}if(barProps.mbShow){firstChartShow=true;order[ind++]="BarChart";}if((!firstChartShow&&otherProps.mbShowForHiddenGraphs)||(firstChartShow&&sparklineProps.mbAssMetric)){order[ind++]="0";}if(kpi>=7){if(bulletProps.mbShow){if(bulletProps.mbAssMetric){order[ind++]="2";}order[ind++]="GaugeChart";}else{if(otherProps.mbShowForHiddenGraphs){for(var i=3;i<=kpi&&i<=7;i++){order[ind++]=""+(i-1);}}}for(var i=8;i<=kpi;i++){order[ind++]=""+(i-1);}}else{for(var i=3;i<=kpi;i++){order[ind++]=""+(i-1);}}}function createNonKPIDefaultCol(){var ind=0;var m=this.model,rows=m.gts.row,cols=m.gts.col;var mtrcNum=0;if(this.isTreeMode){order[ind++]=rows[0].id;}else{for(var i=0;i<rows.length-GFL;i++){if(rows[i].fs&&rows[i].fs.length>0){for(var q=0;q<rows[i].fs.length;q++){order[ind++]=rows[i].id+":"+rows[i].fs[q].id;}}else{if(rows[i].fid&&rows[i].fid.length>0){order[ind++]=rows[i].id+":"+rows[i].fid;}else{order[ind++]=rows[i].id;}}}}for(var i=0;i<cols.length;i++){if(cols[i].n="Metrics"){mtrcNum=cols[i].es.length;}}var firstChartShow=false;if(this.sparklineProps.mbShow){firstChartShow=true;order[ind++]="LineChart";}if(this.barProps.mbShow){firstChartShow=true;order[ind++]="BarChart";}if((!firstChartShow&&this.otherProps.mbShowForHiddenGraphs)||(firstChartShow&&this.sparklineProps.mbAssMetric)){order[ind++]="0";}if(mtrcNum>=7){if(this.bulletProps.mbShow){if(this.bulletProps.mbAssMetric){order[ind++]="2";}order[ind++]="GaugeChart";}else{if(this.otherProps.mbShowForHiddenGraphs){for(var i=3;i<=7&&i<=mtrcNum;i++){order[ind++]=""+(i-1);}}}for(var i=8;i<=mtrcNum;i++){order[ind++]=""+(i-1);}}else{for(var i=3;i<=mtrcNum;i++){order[ind++]=""+(i-1);}}}function convertAttributeDrivenData(w){var m=w.model,metricES=m.gts.col[0].es,rows=m.gts.row,gvsRows=m.gvs.items,rl=m.gvs.items.length,rhs=m.ghs.rhs.items;var rowsLen=rows.length;var lai=rows.length-GFL;var slai=lai-1;var idxPos=0;w.attrMapIdx=[];var attrMapIdx=w.attrMapIdx;for(var q=0;q<rowsLen;q++){attrMapIdx[q]=idxPos;if(!rows[q].fs||rows[q].fs.length==0){idxPos++;}else{idxPos+=rows[q].fs.length;}}attrMapIdx[rowsLen]=idxPos;var attrName=rows[lai].dn||rows[lai].n;var fnCopyArray=function(src,isIdx){var dest=[];for(var i=0;i<src.length;i++){dest[i]=src[i];}return dest;};w.ctlMatrix={};w.isAllAttrSelectable=true;for(var i=0;i<lai;i++){var attribute=rows[i];if(!attribute.sc||!attribute.sc.tks||attribute.sc.tks==""){w.isAllAttrSelectable=false;continue;}w.ctlMatrix[attribute.id]={es:attribute.es,sc:attribute.sc,map:[],selectedIdx:{},colIdx:w.getColIdx(attribute.id)};if(attribute.sc.all&&attribute.sc.allSelected){w.ctlMatrix[attribute.id].selectedIdx["-1"]=true;}}var AttrIndexes=[];var i=0,j=0;var template=[];var tempLen=0;for(i=0;i<rhs.length;i++){if(i===0){AttrIndexes[0]=[];for(j=0;j<rhs[i].items.length;j++){AttrIndexes[0][j]=rhs[0].items[j].idx;if(AttrIndexes[0][j]<0&&rows[j].otp==-1){AttrIndexes[0][j]=rows[j].es.length+AttrIndexes[0][j-1];}if(rhs[0].items[j].cet){var id=rhs[0].items[j].cet;if(order[j]==id+":CG"){id+=":CG";}var controlMatrix=w.ctlMatrix[id];if(controlMatrix&&!controlMatrix.selectedIdx[-1]){controlMatrix.selectedIdx[AttrIndexes[0][j]]=true;}}}template=fnCopyArray(AttrIndexes[0]);tempLen=template.length;continue;}var rhsRow=rhs[i].items;var rhsRowLen=rhsRow.length;for(j=1;j<=rhsRowLen;j++){template[tempLen-j]=rhsRow[rhsRowLen-j].idx;if(template[tempLen-j]<0){var k=0;for(;k<attrMapIdx.length;k++){if(tempLen-j<attrMapIdx[k]){break;}}template[tempLen-j]=rows[k-1].es.length+rhsRow[rhsRowLen-j-1].idx;}if(rhsRow[rhsRowLen-j].cet){var id=rhsRow[rhsRowLen-j].cet;if(order[rhsRowLen-j]==id+":CG"){id+=":CG";}var controlMatrix=w.ctlMatrix[id];if(controlMatrix){delete controlMatrix.selectedIdx[-1];controlMatrix.selectedIdx[template[tempLen-j]]=true;}}}AttrIndexes[i]=fnCopyArray(template);}var fnBEL=function(index){var elms={};var ind=0;for(var i=0;i<rows.length-GFL;i++){var fL=rows[i].fs.length;if(fL<1){fL=1;}var attId=rows[i].id;if(AttrIndexes[index][ind]<0){elms[attId]="";}else{elms[attId]=rows[i].es[AttrIndexes[index][ind]];}if(elms[attId]==undefined){elms[attId]={n:""};}var fidId=rows[i].fid;if(fidId&&fidId.length>0){elms[attId+":"+fidId]=rows[i].es[AttrIndexes[index][ind]];}for(var j=0;j<fL;j++){var formId="";if(rows[i].fs&&rows[i].fs[j]){formId=rows[i].fs[j].id;}if(formId&&formId.length>0){var afID=attId+":"+formId;elms[afID]=rows[i].es[AttrIndexes[index][ind]];}ind++;}}return elms;};var s={v:[],rv:[],thClr:[],hi:[0]};var referValue=[];var sortValue=0;var attrElems=null;var ch=[{items:[{n:metricES[0].n}]}];var c=[],baseRow=[],j=0,si=0,isTotal=false,compareResult=false;function indexChanged(baseRow,newRow){if(baseRow.length!=newRow.length){return true;}var endIndex=attrMapIdx[lai]-1;if(endIndex>=baseRow.length){endIndex=baseRow.length-1;}for(var i=endIndex;i>=0;i--){if(baseRow[i]!=newRow[i]){return true;}}return false;}for(var i=0;i<=rl;i++){if(i===0){baseRow=AttrIndexes[i];}else{if((compareResult=(i===rl||indexChanged(baseRow,AttrIndexes[i])))||isTotal){if(isTotal&&!compareResult){}else{for(var x=0;x<lai;x++){var controlMatrix=w.ctlMatrix[rows[x].id];if(controlMatrix){controlMatrix.map[si]=AttrIndexes[i-1][x];}}models[si]={sortV:sortValue,isTotal:isTotal,refv:referValue,elms:attrElems,tr:s.v[s.v.length-1],model:{categories:{items:c,tn:attrName},mtrcs:{items:METRICS},colHeaders:ch,series:[s],rowHeaders:[{n:rows[lai].n}]}};si++;if(i===rl){break;}}s={v:[],rv:[],thClr:[],hi:[0]};referValue=[];c=[];baseRow=AttrIndexes[i];j=0;isTotal=false;}}var otherProps=w.otherProps;for(var p=0;p<gvsRows[i].items.length;p++){if(!referValue[p]){referValue[p]={};}referValue[p]=gvsRows[i].items[p];}attrElems=fnBEL(i);if(otherProps.mpSortKey!=null){var sortByAttr=(otherProps.mpSortKey!=parseInt(otherProps.mpSortKey));if(sortByAttr){sortValue=attrElems[otherProps.mpSortKey].n;}else{sortValue=parseFloat(referValue[otherProps.mpSortKey].rv);}}if(!w.isTreeMode){var isSubTotal=function(attr){return(attr.id&&attr.id.substring(0,1)==="D")||(attr.id===undefined&&attr.n==="Total");};var attrSlai=rows[slai].es[AttrIndexes[i][attrMapIdx[slai]]];if(attrSlai&&isSubTotal(attrSlai)){isTotal=true;continue;}var attr=rows[lai].es[AttrIndexes[i][attrMapIdx[lai]]];if(attr&&isSubTotal(attr)){continue;}}var attrElement="";var attIdxPos=attrMapIdx[lai];var thisAtt=null;var thisAttFormLen=1;try{for(var p=0;p<GFL;p++){thisAtt=rows[lai+p];if(thisAtt.fs&&thisAtt.fs.length>0){thisAttFormLen=thisAtt.fs.length;}else{thisAttFormLen=1;}for(var pp=0;pp<thisAttFormLen;pp++){attrElement+=" "+thisAtt.es[AttrIndexes[i][attIdxPos]].n;attIdxPos++;}}}catch(err){}c[j]=attrElement;var item=gvsRows[i].items[0];s.v[j]=item.v;s.rv[j]=item.rv;var th=m.th&&m.th["0"];var ti=item.ti;if(ti!=undefined&&item.ty==2&&th[ti].cni!=undefined&&otherProps.mbInheritFromGridGraph){this.textSpan.className=m.css[th[ti].cni].n;var compStyle=mstrmojo.css.getComputedStyle(this.textSpan);s.thClr[j]=compStyle.backgroundColor;if(s.thClr[j]=="rgba(0, 0, 0, 0)"){s.thClr[j]=null;}}else{s.thClr[j]=null;}j++;}if(!w.isTreeMode&&otherProps.mpSortKey!=null){var rowCount=models.length;for(var i=0;i<rowCount;i++){for(var j=0;j<rowCount-1;j++){if((otherProps.mbSortDescend&&models[j].sortV<models[j+1].sortV)||(!otherProps.mbSortDescend&&models[j].sortV>models[j+1].sortV)){var temp=models[j];models[j]=models[j+1];models[j+1]=temp;}}}}if(w.isTreeMode){convertDataToTreeModels.call(w,AttrIndexes);}}function convert(w){var m=w.model,rows=m.gts.row,cols=m.gts.col,cs=rows[rows.length-1].es,sn=cols[0].es,idxItems=m.ghs.rhs.items,csl=idxItems.length,v=m.gvs.items,ch=[];for(var i=0;i<sn.length;i++){if(!ch[0]){ch[0]={items:[]};}ch[0].items[i]=[{n:sn[i].n}];}var vl=v[0].items.length;var series=[];var c=[];var attrName=m.gts.row[0].dn||m.gts.row[0].n;var referValue=[];var kpi=w.otherProps.mnMetricsPerKPI;if(isNaN(kpi)){kpi=1;}var sNum=0;var metrixIdxArray=[];for(var i=0;i+kpi<=vl;i=i+kpi){var fv=[];var rv=[];series[sNum]={v:fv,rv:rv,hi:[0]};var refV=[];referValue[sNum]={refv:refV};for(var j=0;j<kpi;j++){referValue[sNum].refv[j]=v[csl-1].items[i+j];}metrixIdxArray[sNum]=i;sNum++;}for(var i=0;i<csl;i++){var idxItemsItems=idxItems[i].items;var idx=idxItemsItems[idxItemsItems.length-1].idx;if(isNaN(idx)){console.log("idx is not a number!"+idx);c[i]=cs[i].n;}else{if(idx<0){c[i]="";}else{c[i]=cs[idx].n;}for(var k=2;k<=idxItemsItems.length&&k<=rows.length;k++){var anotherIdx=idxItemsItems[idxItemsItems.length-k].idx;if(!isNaN(anotherIdx)){c[i]=rows[rows.length-k].es[anotherIdx].n+" "+c[i];}}}var ind=0;for(var j=0;j+kpi<=vl;j=j+kpi){series[ind].v[i]=v[i].items[j].v;series[ind].rv[i]=v[i].items[j].rv;ind++;}}var sl=series.length;for(var i=0;i<sl;i++){var elmsValue={};elmsValue[m.gts.row[0].id]=ch[0].items[i*kpi][0];if(m.gts.row[0].fid){elmsValue[m.gts.row[0].id+":"+m.gts.row[0].fid]=ch[0].items[i*kpi][0];}elmsValue.Metric=ch[0].items[i*kpi][0];models[i]={refv:referValue[i].refv,elms:elmsValue,tr:series[i].v[series[i].v.length-1],model:{categories:{items:c,tn:attrName},mtrcs:{items:METRICS},series:[series[i]],colHeaders:[{items:ch[0].items[i]}],rowHeaders:[{n:rows[0].n}]},metricIdx:metrixIdxArray[i]};}}function bulletShowMinLabel(){var showMinLabel=false;var otherProps=this.otherProps;if(this.showGauge){var minValue=this.bulletProps.mfMinValue;var count=models.length;for(var i=0;i<count;i++){var v=models[i].refv[2];if(v&&v.rv<minValue){showMinLabel=true;otherProps.mRowHeight=otherProps.mRowHeight>36?otherProps.mRowHeight:36;break;}}}return showMinLabel;}function getFirstRowUnderDockedHeader(yPos){var scl=this.getChartWithScrollBar()._scroller;var y=yPos||scl&&scl.origin&&scl.origin.y;var rowOffsetHeight=this.rowOffsetHeight;var rowIdx=this.startCnt+parseInt(y/rowOffsetHeight)+this.dockedHeaderRows.length;var rowPast=y%rowOffsetHeight;var rowInfo=getRowAtIdx.call(this,rowIdx);return{rowInfo:rowInfo,treeNode:rowInfo.treeNode,pastOffset:rowPast,rowIdx:rowIdx};}function getRowAtIdx(rowIdx){if(rowIdx<0){rowIdx=0;}var maxRowIdx=this.rows.length-1;if(rowIdx>maxRowIdx){rowIdx=maxRowIdx;}return this.rows[rowIdx];}function getTreeNodeRows(allExpand,rowCnt){var preOrderTreeNodeQueue=[];var treeNode=null;var rows=[];var treeNodeList=this.tree.childrenTreeNodeList;var childrenCount=treeNodeList.length;for(var i=childrenCount-1;i>=0;i--){preOrderTreeNodeQueue.push(treeNodeList[i]);}var rowCount=0;while(preOrderTreeNodeQueue.length>0){treeNode=preOrderTreeNodeQueue.pop();var row={treeNode:treeNode,model:treeNode.model,rowIdx:rowCount,selected:treeNode.selected,rowRef:{}};rows.push(row);if(!allExpand){treeNode.rowIdx=rowCount++;}if(rowCnt&&rowCount>=rowCnt){break;}if(treeNode.needExpand||allExpand){treeNodeList=treeNode.childrenTreeNodeList;childrenCount=treeNodeList.length;for(var i=childrenCount-1;i>=0;i--){preOrderTreeNodeQueue.push(treeNodeList[i]);}}}return rows;}function getLowestLevelOnScreen(){var scl=this.getChartWithScrollBar()._scroller;var y=scl&&scl.origin&&scl.origin.y;var rowOffsetHeight=this.rowOffsetHeight;var firstRowIdx=this.startCnt+parseInt(y/rowOffsetHeight);var chartHeight=Math.min(this.chartTableMaxHeight,parseInt(this._leftChart.itemsContainerNode.style.height));var lastRowIdx=this.startCnt+parseInt((y+chartHeight)/rowOffsetHeight);if(firstRowIdx<0){firstRowIdx=0;}if(lastRowIdx>=this.rows.length){lastRowIdx=this.rows.length-1;}var lowestLevel=-1;for(var i=firstRowIdx;i<=lastRowIdx;i++){var currLevel=this.rows[i].treeNode.level;if(currLevel>lowestLevel){lowestLevel=currLevel;}}return lowestLevel;}function removeChildren(container){var count=container&&container.childNodes&&container.childNodes.length;for(var i=0;i<count;++i){container.removeChild(container.firstChild);}}function hasScrollDownPast(yPos){return yPos<0;}function expandOrCollapseTreeAndSetScrlPos(levelToExpand,anchorRowTreeNode,anchorRowIdxOnScrn){if(this.expandToLevel==levelToExpand){return ;}setNeedExpandToLevel(this.tree,levelToExpand);this.expandToLevel=levelToExpand;this.rowsNeedRebuild=true;this.reRenderChartWithAnchor(anchorRowTreeNode,anchorRowIdxOnScrn);setChartTableHeight.call(this);this.reBuildDH(levelToExpand);}function expandTreeNodeAndSetScrlPos(rowInfo,rowType){var treeNode=rowInfo.treeNode;treeNode.needExpand=true;this.expandToLevel=-1;var scl=this.getChartWithScrollBar()._scroller;var currRowIdx=rowInfo.rowIdx;this.reRenderChart(scl.origin);setChartTableHeight.call(this);if(currRowIdx==this.startCnt+parseInt(scl.origin.y/this.rowOffsetHeight)+this.dockedHeaderRows.length){var rowIdxList=[];var currRowTreeNode=rowInfo.treeNode;while(currRowTreeNode.needExpand){rowIdxList.push(currRowIdx);currRowTreeNode=getRowAtIdx.call(this,++currRowIdx).treeNode;}this.addRowsToDH(rowIdxList);}var rowOffsetHeight=this.rowOffsetHeight;var lastRowOnScrnIdx=this.startCnt+Math.round((scl.origin.y+this.chartTableHeight)/rowOffsetHeight)-1;if(currRowIdx==lastRowOnScrnIdx){var scroller=scl;var maxYPos=Math.min(scl.origin.y+2*rowOffsetHeight,scl.offset.y.end);scl.origin.y=maxYPos;$D.translate(scroller.scrollEl,-scroller.origin.x,-scroller.origin.y,0,scroller.transform,scroller.useTranslate3d);this.onScrollMoved({y:maxYPos});}}function getIdxByRowIdx(rows,targetIdx){var rowCount=rows.length;for(var i=0;i<rowCount;i++){var rowInfoDH=rows[i];if(rowInfoDH.rowIdx==targetIdx){return i;}}return -1;}function collapseTreeNodeAndSetScrlPos(rowInfo,rowType){var treeNode=rowInfo.treeNode;treeNode.needExpand=false;this.expandToLevel=-1;var scl=this.getChartWithScrollBar()._scroller;if(rowType==DOCKED_HEADER){var adjustOffset=0;var rowCount=this.dockedHeaderRows.length;var dockedHeaderIdx=getIdxByRowIdx(this.dockedHeaderRows,rowInfo.rowIdx);if(dockedHeaderIdx>=0){this.removeRowsFromDH(rowCount-dockedHeaderIdx);this.removeChildrenForDHReplaceTable();this.dockedHeaderStatus=NO_REPLACE;}else{dockedHeaderIdx=getIdxByRowIdx(this.dockedHeaderReplaceRows,rowInfo.rowIdx);if(dockedHeaderIdx<0){return ;}dockedHeaderIdx+=rowCount;adjustOffset=scl.origin.y%this.rowOffsetHeight;this.removeChildrenForDHReplaceTable();this.dockedHeaderStatus=NO_REPLACE;}var rowCount=this.startCnt+parseInt(scl.origin.y/this.rowOffsetHeight)+dockedHeaderIdx-rowInfo.rowIdx;this.reRenderChart(scl.origin,rowCount,adjustOffset);}else{if(rowType==OTHER_ROW){this.reRenderChart(scl.origin);}}setChartTableHeight.call(this);}var hideTooltipGlobal=function(){if(this.tooltip.style.display==="block"){var highLightCav=document.getElementById("highLightCav"+this.domNode.id);if(highLightCav){highLightCav.id="";var context=highLightCav.getContext("2d");context.clearRect(0,0,highLightCav.width,highLightCav.height);}this.tooltip.style.display="none";this.tooltipShow=false;if(this._touchListener){var touchManager=mstrmojo.touchManager;touchManager.detachEventListener(this._touchListener);delete this._touchListener;}}};function setChartTableHeight(){if(!this._leftChart){return ;}var chartTableOffsetHeight=(this.otherProps.mbHideTextColumns&&this.enableSmoothScroll)?this._rightChart.chartTableOffsetHeight:this._leftChart.chartTableOffsetHeight;var headerTableOffsetHeight=(this.otherProps.mbHideTextColumns&&this.enableSmoothScroll)?this._rightChart.headerTableOffsetHeight:this._leftChart.headerTableOffsetHeight;var chartTableHeight=0;if(chartTableOffsetHeight>=this.chartTableMaxHeight){chartTableHeight=this.chartTableMaxHeight;}else{chartTableHeight=chartTableOffsetHeight;}this._leftChart.itemsContainerNode.style.height=chartTableHeight+"px";if(this._rightChart){this._rightChart.itemsContainerNode.style.height=chartTableHeight+"px";}this.legend.style.top=(headerTableOffsetHeight+chartTableHeight)+"px";this.dropShadowDiv.style.height=(headerTableOffsetHeight+chartTableHeight)+"px";this.indicatorEl.parentNode.style.top=headerTableOffsetHeight+"px";this.indicatorEl.parentNode.style.height=chartTableHeight+"px";this.chartTableHeight=chartTableHeight;var scl=this.getChartWithScrollBar()._scroller;var yPos=scl.origin.y;var maxYPos=chartTableOffsetHeight-chartTableHeight+2;if(yPos>maxYPos){if(scl.vScroll){scl.origin.y=maxYPos;this._leftChart.scrollTo(scl.origin);if(this._rightChart){this._rightChart.scrollTo(scl.origin);}var rowOffsetHeight=this.rowOffsetHeight;while((yPos=yPos-rowOffsetHeight)>maxYPos){this.updateDockedHeadersByOneRow(yPos,true);}this.updateDockedHeadersByOneRow(maxYPos);this.firstRowIdxOnScrn=parseInt(this.startCnt+scl.origin.y/rowOffsetHeight);}else{scl.origin.y=0;this._leftChart.scrollTo(scl.origin);if(this._rightChart){this._rightChart.scrollTo(scl.origin);}this.firstRowIdxOnScrn=parseInt(this.startCnt+scl.origin.y/rowOffsetHeight);}}this.updateWindowRatio();this.updateScrollBarPosition();}function setScrollerPosition(scrollTo){var scl=this._scroller,icn=this.rightChart,offsetEnd=this.rightChart.offsetWidth-(this.getWidth()-this.leftWidth);scl.origin={x:scrollTo&&scrollTo.x||0,y:scrollTo&&scrollTo.y||0};scl.showScrollbars=true;scl.hScroll=(offsetEnd!==0&&scl.noHScroll!==true)||this.scrollPast;if(scl.hScroll){scl.offset={x:{start:0,end:offsetEnd},scrollPast:this.scrollPast};}this.utils.translateCSS(-scl.origin.x,-scl.origin.y,false,icn);}mstrmojo.VisMicroChart=mstrmojo.declare(mstrmojo.Vis,[mstrmojo._TouchGestures,mstrmojo._HasTouchScroller],{scriptClass:"mstrmojo.VisMicroChart",utils:mstrmojo.VisChartUtils,scrollerConfig:{bounces:false,showScrollbars:true,vScroll:false,hScroll:true,useTranslate3d:false},scrollPast:false,legendHeight:30,selectedStyle:"background-color:#015DE6;color:#FFFFFF;",selectedClass:"",isAllAttrSelectable:false,prevSelected:{mrow:-2,mcol:-1},rows:[],dockedHeaderRows:[],dockedHeaderReplaceRows:[],rowsReusePool:[],unselectedRemainCells:[],isTreeMode:false,isKPI:false,showMinLabel:false,rowsNeedRebuild:true,lastScrollPosition:{y:0},startCnt:-1,endCnt:-1,firstRowIdxOnScrn:0,pageSize:10,mcStatus:null,fontSize:"10pt",headerCssClass:"",valueCssClass:"",enableSmoothScroll:false,metricColumnsSpacing:NORMAL,attrColumnCount:0,dropShadowWidth:7,markupString:'<div id="{@id}-microchart" class="mstrmojo-Chart {@cssClass}" style="width:{@width};height:{@height};left:{@left};top:{@top};z-index:{@zIndex};position:absolute"  mstrAttach:mousedown,mouseup,mousemove,click ><div id="{@id}-microchart-left" style="width:{@leftWidth+"px"};height:{@height};left:0px;right:0px;position:absolute;z-index:1;" > </div><div id="{@id}-microchart-smoothscroll-container" class="mstrmojo-Chart {@cssClass}" style="width:{@rightWidth+"px"};height:{@height};left:{@leftWidth+"px"};top:0;position:absolute;overflow:hidden;"><div id="{@id}-microchart-right" style="width:{@rightWidth};position:absolute;" > </div><div id="{@id}-drop-shadow-ss" style="position:absolute;left:0px;width:{@dropShadowWidth+"px"}" > </div></div><div style="display:none;position:absolute;right:0;z-index:5;height:{@legendHeight + "px"};width:{@width};border:none;background:transparent;text-decoration:none;" class="microchart-lengend-text"><div style="position:absolute;right:0;top:0;padding-bottom:7px"><div style="float:left;padding-top:7px;"><div class="microchart-legend-band" ></div><div style="float:right;margin-right:10px;margin-left:10px;">Low</div></div><div style="float:left;padding-top:7px;"><div class="microchart-legend-band"></div><div style="float:right;margin-right:10px;margin-left:10px;">Mid</div></div><div style="float:left;padding-top:7px;"><div class="microchart-legend-band"></div><div style="float:right;margin-right:10px;margin-left:10px;">High</div></div></div></div><span id="textSpan" style="z-index:-10;visibility:hidden;-webkit-text-size-adjust: none;"></span><div id="{@id}-loading-msg" class="mstrmojo-loading-msg" style="display:none;z-index:10"></div><canvas id="textCanvas" width="900" height="500" style="z-index:-11;visibility:hidden;-webkit-text-size-adjust: none;"></canvas><div id="{@id}-tooltip" class="mstrmojo-MicroChart-tooltip" style="z-index:10;opacity: 0.9;"></div><div id="{@id}-text-tooltip" class="mstrmojo-Chart-tooltip timeseries-legend-tooltip" style="z-index:10"></div><div id="{@id}-errMsg" class="mstrmojo-message" style="width:{@width};height:{@height};top:0px;left:0px;position:absolute; display:none; z-index:30;"><div style="width:{@width};position:absolute;top:50%;text-align:center"></div></div><div id="{@id}-indicatorEl-container"  style="width:{@width};height:{@height};top:0px;left:0px;position:absolute;z-index:-5"><div></div></div></div>',markupSlots:{leftChart:function(){return this.domNode.childNodes[0];},rightChart:function(){return this.domNode.childNodes[1].firstChild;},dropShadowDiv:function(){return this.domNode.childNodes[1].childNodes[1];},itemsContainerNode:function(){return this.domNode.childNodes[1];},textSpan:function(){return this.domNode.childNodes[3];},loadingMsg:function(){return this.domNode.childNodes[4];},textCanvas:function(){return this.domNode.childNodes[5];},tooltip:function(){return this.domNode.childNodes[6];},textTooltip:function(){return this.domNode.childNodes[7];},errorMsg:function(){return this.domNode.childNodes[8];},indicatorEl:function(){return this.domNode.childNodes[9].firstChild;},legend:function(){return this.domNode.childNodes[2];},legendLow:function(){return this.domNode.childNodes[2].childNodes[0].childNodes[0];},legendLowFont:function(){return this.domNode.childNodes[2].childNodes[0].childNodes[0].childNodes[1];},legendLowBand:function(){return this.domNode.childNodes[2].childNodes[0].childNodes[0].childNodes[0];},legendMid:function(){return this.domNode.childNodes[2].childNodes[0].childNodes[1];},legendMidFont:function(){return this.domNode.childNodes[2].childNodes[0].childNodes[1].childNodes[1];},legendMidBand:function(){return this.domNode.childNodes[2].childNodes[0].childNodes[1].childNodes[0];},legendHigh:function(){return this.domNode.childNodes[2].childNodes[0].childNodes[2];},legendHighFont:function(){return this.domNode.childNodes[2].childNodes[0].childNodes[2].childNodes[1];},legendHighBand:function(){return this.domNode.childNodes[2].childNodes[0].childNodes[2].childNodes[0];}},renderErrorMessage:function renderErrorMessage(msg){var contentDiv=this.errorMsg.firstChild;contentDiv.innerHTML=msg;this.errorMsg.style.display="block";var contentHeight=contentDiv.offsetHeight;contentDiv.style.marginTop=-0.5*contentHeight;},getTextWidthByCanvas:function gtwCvs(text,elem,withPadding){var canvas=this.textCanvas;var context=canvas.getContext("2d");var computedStyle=mstrmojo.css.getComputedStyle(elem);var fontStyle=computedStyle.fontStyle+" "+computedStyle.fontWeight+" "+computedStyle.fontSize+"/"+computedStyle.fontVariant+" "+computedStyle.fontFamily;context.font=fontStyle;context.textAlign="center";context.fillStyle="blue";var metrics=context.measureText(text);var result=metrics.width;if(withPadding){var addPadding=function(padding){if(computedStyle[padding]){result+=parseInt(computedStyle[padding]);}};addPadding("paddingLeft");addPadding("paddingRight");}return result;},getTextWidth:function gtw(str,className,fontName,fontSize,fontSizeUnit,bold,withoutPadding){var selfTextSpan=this.textSpan;if(selfTextSpan.className!==className||""){selfTextSpan.className=className||"";}if(selfTextSpan.style.fontFamily!==fontName||""){selfTextSpan.style.fontFamily=fontName||"";}var fsUnit=fontSizeUnit||"pt";if(fontSize){selfTextSpan.style.fontSize=fontSize+fsUnit;}else{selfTextSpan.style.fontSize="";}if(bold){if(selfTextSpan.style.fontWeight!=="bold"){selfTextSpan.style.fontWeight="bold";}}else{if(selfTextSpan.style.fontWeight!==""){selfTextSpan.style.fontWeight="";}}if(withoutPadding){selfTextSpan.style.padding="0px 0px";}else{selfTextSpan.style.padding="";}selfTextSpan.innerHTML=str;var ret=selfTextSpan.offsetWidth;return ret;},getTextHeight:function gth(str,className,bold,fontFamily,fontSize){this.textSpan.style.fontFamily=fontFamily||"";this.textSpan.style.fontSize=fontSize||"";if(bold){this.textSpan.style.fontWeight="bold";}else{this.textSpan.style.fontWeight="";}this.textSpan.className=className;this.textSpan.innerHTML=str;return this.textSpan.offsetHeight;},removeMCStatus:function removeMCStatus(){this.mcStatus=null;if(this.controller&&this.controller.view&&this.controller.view.model){this.controller.view.model.mcStatus=null;}},restoreMCStatus:function restoreMCStatus(){if(this.isTreeMode&&this.mcStatus&&this.mcStatus.currSelectedObj&&this.mcStatus.currSelectedObj.length>0){this.lastSelectedObj=$HASH.clone(this.currSelectedObj);}if(this.mcStatus&&this.mcStatus.startCnt!=undefined&&this.mcStatus.endCnt!=undefined){this.startCnt=this.mcStatus.startCnt;this.firstRowIdxOnScrn=this.mcStatus.firstRowIdxOnScrn;var minRowCntToCoverScreen=Math.max(this.mcStatus.endCnt-this.mcStatus.firstRowIdxOnScrn,this.minPageSize);this.endCnt=Math.min(this.mcStatus.firstRowIdxOnScrn+minRowCntToCoverScreen,this.rows.length);}if(this.isTreeMode&&this.mcStatus){this.replacingStartRowIdx=this.mcStatus.replacingStartRowIdx;this.needReplaceCount=this.mcStatus.needReplaceCount;this.lastFirstRowIdxOnScrn=this.mcStatus.lastFirstRowIdxOnScrn;this.dockedHeaderStatus=this.mcStatus.dockedHeaderStatus;this.lastScrollPosition=this.mcStatus.lastScrollPosition;}},storeMCStatus:function storeMCStatus(noNeedToStoreScrollInfo){this.mcStatus={};if(this.isTreeMode){this.mcStatus.expandToLevel=this.expandToLevel||-1;this.mcStatus.expandedEntryArray=[];if(this.mcStatus.expandToLevel<0){this.addTreeNodeToExpanedEntry(this.tree.childrenTreeNodeList,[]);}this.mcStatus.currSelectedObj=[];for(var i=0;i<this.currSelectedObj.length;i++){var treeNode=this.currSelectedObj[i];this.mcStatus.currSelectedObj[i]=treeNode&&treeNode.id;}if(!noNeedToStoreScrollInfo){this.mcStatus.dHRowIdxList=[];var dHRows=this.dockedHeaderRows;for(var i=0;i<dHRows.length;i++){this.mcStatus.dHRowIdxList.push(dHRows[i].rowIdx);}this.mcStatus.dHReplaceRowIdxList=[];var dHRows=this.dockedHeaderReplaceRows;for(var i=0;i<dHRows.length;i++){this.mcStatus.dHReplaceRowIdxList.push(dHRows[i].rowIdx);}this.mcStatus.replacingStartRowIdx=this.replacingStartRowIdx;this.mcStatus.needReplaceCount=this.needReplaceCount;this.mcStatus.lastFirstRowIdxOnScrn=this.lastFirstRowIdxOnScrn;this.mcStatus.dockedHeaderStatus=this.dockedHeaderStatus;this.mcStatus.lastScrollPosition=this.lastScrollPosition;}}if(!noNeedToStoreScrollInfo){this.mcStatus.startCnt=this.startCnt;this.mcStatus.endCnt=this.endCnt;this.mcStatus.firstRowIdxOnScrn=this.firstRowIdxOnScrn;var chart=this.getChartWithScrollBar();this.mcStatus.scrollTo=chart&&chart._scroller.origin||{x:0,y:0};}if(this.enableSmoothScroll&&this._scroller&&this._scroller.origin){this.mcStatus.hScrollPos=this._scroller.origin.x/this.rightWidth;}if(this.controller&&this.controller.view&&this.controller.view.model){this.controller.view.model.mcStatus=this.mcStatus;}},addTreeNodeToExpanedEntry:function addExpanedEntry(treeNodeList,parentEntry){var expEntryArray=this.mcStatus.expandedEntryArray;var treeNodeCount=treeNodeList.length;for(var i=0;i<treeNodeCount;i++){var treeNode=treeNodeList[i];if(treeNode.needExpand){var expandedEntry=$HASH.clone(parentEntry);expandedEntry.push({element:treeNode.id});expEntryArray.push(expandedEntry);this.addTreeNodeToExpanedEntry(treeNode.childrenTreeNodeList,expandedEntry);}}},unrender:function unrender(ignoreDom,noNeedToStoreScrollInfo){console.log("in unrender");if(!this.mcStatus){this.storeMCStatus(noNeedToStoreScrollInfo);}this.destroyChartWidget();if(this._super){this._super(ignoreDom);}},refresh:function refresh(){this.unrender(null,true);this.render();},initScroller:function initScroller(scroller){if(this._super){this._super(scroller);}if(this.enableSmoothScroll){this._scrollDoneListener=this._scroller.attachEventListener("scrollDone",this.id,function(){this.updateScrollBarPosition();var scrl=this._scroller;if(scrl){scrl.toggleScrollBars(false);}});}},updateScrollBarPosition:function updateScrollBarPosition(){var scroller=this._rightChart&&this._rightChart._scroller;var scrollBar=scroller&&scroller._scrollBarEls&&scroller._scrollBarEls.y;if(scrollBar){scrollBar.style.left=(this._scroller.origin.x+this.getWidth()-this.leftWidth-9)+"px";}scroller=this._scroller;scrollBar=scroller&&scroller._scrollBarEls&&scroller._scrollBarEls.x;if(scrollBar){scrollBar.style.top=(this.chartTableHeight+this._leftChart.headerTableOffsetHeight-9)+"px";}},onScrollDone:function onScrollDone(evt){var scrl=this.getChartWithScrollBar()._scroller;scrl.toggleScrollBars(false);if(this.partialRender){this.firstRowIdxOnScrn=parseInt(this.startCnt+evt.y/this.rowOffsetHeight);if((this.firstRowIdxOnScrn-this.startCnt<=this.pageSize&&this.firstRowIdxOnScrn>=this.pageSize)||this.endCnt-1-this.firstRowIdxOnScrn<=this.pageSize&&this.endCnt!=this.rows.length){this.reRenderChartWhenScrollDone(scrl.origin);setChartTableHeight.call(this);}}},onScrollMoved:function onScrollMoved(evt){hideTooltipGlobal.call(this);if(this.isTreeMode){if(hasScrollDownPast(evt.y)){this._leftChart.hideDockedHeader();if(this._rightChart){this._rightChart.hideDockedHeader();}}else{this._leftChart.showDockedHeader();if(this._rightChart){this._rightChart.showDockedHeader();}}var rowOffsetHeight=this.rowOffsetHeight;this.firstRowIdxOnScrn=this.startCnt+parseInt(evt.y/rowOffsetHeight);var currPos=evt.y;var lastPos=this.lastScrollPosition.y;if(lastPos>currPos){while((lastPos-=rowOffsetHeight)>currPos){this.updateDockedHeadersByOneRow(lastPos,true);}this.updateDockedHeadersByOneRow(currPos);}else{while((lastPos+=rowOffsetHeight)<currPos){this.updateDockedHeadersByOneRow(lastPos,true);}this.updateDockedHeadersByOneRow(currPos);}}},initDockedHeaders:function initDockedHeaders(){this._leftChart.initDHs();if(this._rightChart){this._rightChart.initDHs();}this.clearDockedHeader();var rowIdx=0;var rowIdxList=[];var currRow=getRowAtIdx.call(this,rowIdx);while(currRow&&currRow.treeNode.needExpand){rowIdxList.push(rowIdx);currRow=getRowAtIdx.call(this,++rowIdx);}this.addRowsToDH(rowIdxList);this.lastFirstRowIdxOnScrn=rowIdx;this.lastScrollPosition={x:0,y:0};this.dockedHeaderStatus=NO_REPLACE;},clearDockedHeader:function clearDockedHeader(){this.removeRowsFromDH(this.dockedHeaderRows.length);this.removeChildrenForDHReplaceTable();},reBuildDH:function reBuildDH(level){this.clearDockedHeader();var rows=this.rows;var rowIdxToCheck=this.firstRowIdxOnScrn+level;if(rowIdxToCheck<0||rowIdxToCheck>=rows.length){return ;}var treeNodeToCheck=rows[rowIdxToCheck].treeNode;if(treeNodeToCheck.level>level){var rowIdxList=[];for(var i=0;i<=level;i++){var treeNode=getParentTreeNodeAtLevel(this.tree,treeNodeToCheck.treePath,i);rowIdxList.push(treeNode.rowIdx);}this.addRowsToDH(rowIdxList);}else{if(treeNodeToCheck.level==level){var rowIdxList=[];for(var i=0;i<level;i++){var treeNode=getParentTreeNodeAtLevel(this.tree,treeNodeToCheck.treePath,i);rowIdxList.push(treeNode.rowIdx);}rowIdxList.push(treeNodeToCheck.rowIdx);this.addRowsToDH(rowIdxList);}else{if(treeNodeToCheck.level<level){var preSiblingTreeNode=getPreSiblingTreeNode(this.tree,treeNodeToCheck.treePath);while(!preSiblingTreeNode){rowIdxToCheck--;var treeNodeToCheck=rows[rowIdxToCheck].treeNode;preSiblingTreeNode=getPreSiblingTreeNode(this.tree,treeNodeToCheck.treePath);}var rowIdxList=[];for(var i=0;i<treeNodeToCheck.level;i++){var treeNode=getParentTreeNodeAtLevel(this.tree,treeNodeToCheck.treePath,i);rowIdxList.push(treeNode.rowIdx);}rowIdxList.push(preSiblingTreeNode.rowIdx);var dHCount=treeNodeToCheck.rowIdx-this.firstRowIdxOnScrn;rowIdxToCheck--;var treeNodeToCheck=rows[rowIdxToCheck].treeNode;for(var i=rowIdxList.length;i<dHCount;i++){var treeNode=getParentTreeNodeAtLevel(this.tree,treeNodeToCheck.treePath,i);rowIdxList.push(treeNode.rowIdx);}this.addRowsToDH(rowIdxList);}}}this.dockedHeaderStatus=NO_REPLACE;},updateDockedHeadersByOneRow:function updateDHBOR(yPos,onlyUpdateStatus){var scroller=this.getChartWithScrollBar()._scroller;if(!scroller.vScroll||yPos>scroller.offset.y.end||yPos<0){return ;}var lastDockedHeaderRow;var currFirstRow=getFirstRowUnderDockedHeader.call(this,yPos);this.firstRowIdxOnScrn=currFirstRow.rowIdx-this.dockedHeaderRows.length;if(this.dockedHeaderStatus==IN_REPLACE){var hasReplacedRowCount=this.firstRowIdxOnScrn-this.replacingStartRowIdx;if(hasReplacedRowCount>=0){if(hasReplacedRowCount<this.needReplaceCount){lastDockedHeaderRow=this.dockedHeaderRows[this.dockedHeaderRows.length-1];if(this.firstRowIdxOnScrn>this.lastFirstRowIdxOnScrn){this.removeChildrenForDHReplaceTable();this.shiftDockedHeaderWithRow(0,onlyUpdateStatus);if(lastDockedHeaderRow){this.removeRowsFromDH(1,true);}}else{if(this.firstRowIdxOnScrn<this.lastFirstRowIdxOnScrn){this.dockedHeaderStatus=NO_REPLACE;this.moveRowFromDHRplcTableToDH();currFirstRow=getFirstRowUnderDockedHeader.call(this,yPos);}}this.shiftDockedHeaderWithRow(-currFirstRow.pastOffset,onlyUpdateStatus);}else{this.dockedHeaderStatus=NO_REPLACE;this.removeChildrenForDHReplaceTable();this.shiftDockedHeaderWithRow(0,onlyUpdateStatus);currFirstRow=getFirstRowUnderDockedHeader.call(this,yPos);}}else{this.dockedHeaderStatus=NO_REPLACE;this.moveRowFromDHRplcTableToDH();currFirstRow=getFirstRowUnderDockedHeader.call(this,yPos);}}if(this.dockedHeaderStatus==NO_REPLACE&&currFirstRow.treeNode){var currLevel=currFirstRow.treeNode.level;lastDockedHeaderRow=this.dockedHeaderRows[this.dockedHeaderRows.length-1];var lastLevel=lastDockedHeaderRow?lastDockedHeaderRow.treeNode.level:-1;if(yPos>this.lastScrollPosition.y){if(currLevel<=lastLevel){if(lastDockedHeaderRow){this.removeRowsFromDH(1,true);}this.replacingRowTreeNode=currFirstRow.treeNode;this.replacingStartRowIdx=this.firstRowIdxOnScrn;this.needReplaceCount=lastLevel-currLevel+1;this.dockedHeaderStatus=IN_REPLACE;this.shiftDockedHeaderWithRow(-currFirstRow.pastOffset,onlyUpdateStatus);}else{if(currLevel>lastLevel){var currRowIdx=currFirstRow.rowIdx;var rowIdxList=[];var currRowTreeNode=currFirstRow.treeNode;while(currRowTreeNode.needExpand){rowIdxList.push(currRowIdx);currRowTreeNode=getRowAtIdx.call(this,++currRowIdx).treeNode;}this.addRowsToDH(rowIdxList);}}}else{if(yPos<this.lastScrollPosition.y){if(currLevel==lastLevel){var addedTreeNode=currFirstRow.treeNode.preSibling;var currRowIdx=currFirstRow.rowIdx;var rowCount=0;while(!addedTreeNode){rowCount++;currFirstRow=getRowAtIdx.call(this,--currRowIdx);addedTreeNode=currFirstRow&&currFirstRow.treeNode.preSibling;}this.removeRowsFromDH(rowCount);lastDockedHeaderRow=this.dockedHeaderRows[this.dockedHeaderRows.length-1];if(lastDockedHeaderRow){this.removeRowsFromDH(1);}if(addedTreeNode.needExpand){var rowIdxList=[addedTreeNode.rowIdx];this.addRowsToDH(rowIdxList,true);}else{}this.replacingStartRowIdx=this.firstRowIdxOnScrn;this.replacingRowTreeNode=addedTreeNode;this.needReplaceCount=1;this.dockedHeaderStatus=IN_REPLACE;var pastOffset=yPos%this.rowOffsetHeight;this.shiftDockedHeaderWithRow(-pastOffset,onlyUpdateStatus);}else{if(currLevel>lastLevel+1){var addedTreeNode=getParentTreeNodeAtLevel(this.tree,currFirstRow.treeNode.treePath,lastLevel+1);var rowIdxList=[addedTreeNode.rowIdx];this.addRowsToDH(rowIdxList,true);this.replacingStartRowIdx=this.firstRowIdxOnScrn;this.replacingRowTreeNode=addedTreeNode;this.needReplaceCount=currLevel-lastLevel-1;this.dockedHeaderStatus=IN_REPLACE;this.shiftDockedHeaderWithRow(-currFirstRow.pastOffset,onlyUpdateStatus);}}}}}this.lastScrollPosition.y=yPos;this.lastFirstRowIdxOnScrn=this.firstRowIdxOnScrn;},checkParentBeforeAddToDH:function checkParentBeforeAddToDH(addedRowIdx){var rowInfo=this.rows[addedRowIdx];var treeNode=rowInfo&&rowInfo.treeNode;var rowCount=this.dockedHeaderRows.length;if(rowCount!=treeNode.level){}},addRowsToDH:function addRowsToDH(rowIdxList,toDHReplacingTable){var rows=this.rows;var rowCount=rowIdxList.length;if(rowCount<=0){return ;}var addTo=null;if(toDHReplacingTable){addTo=this.dockedHeaderReplaceRows;}else{addTo=this.dockedHeaderRows;}for(var i=0;i<rowCount;i++){var rowIdx=rowIdxList[i];var rowInfo=rows[rowIdx];addTo.push({rowIdx:rowIdx,treeNode:rowInfo.treeNode,rowRef:this.popFromReusePool()});}this._leftChart.addRowsToDH(rowCount,toDHReplacingTable);if(this._rightChart){this._rightChart.addRowsToDH(rowCount,toDHReplacingTable);}},removeRowsFromDH:function removeRowsFromDH(rowCount,moveToReplacingTable){if(this._leftChart){this._leftChart.removeRowsFromDH(rowCount,moveToReplacingTable);}if(this._rightChart){this._rightChart.removeRowsFromDH(rowCount,moveToReplacingTable);}if(rowCount>this.dockedHeaderRows.length){rowCount=this.dockedHeaderRows.length;}for(;rowCount>0;rowCount--){var row=this.dockedHeaderRows.pop();if(!moveToReplacingTable){this.pushRowRefToReusePool(row);}else{this.dockedHeaderReplaceRows.push(row);}}},moveRowFromDHRplcTableToDH:function moveRowFromDHRplcTableToDH(){this._leftChart.moveRowFromDHRplcTableToDH();if(this._rightChart){this._rightChart.moveRowFromDHRplcTableToDH();}this.shiftDockedHeaderWithRow(0);var row=this.dockedHeaderReplaceRows.pop();if(row){this.dockedHeaderRows.push(row);}},removeChildrenForDHReplaceTable:function removeChildrenForDHReplaceTable(){if(this._leftChart){this._leftChart.removeChildrenForDHReplaceTable();}if(this._rightChart){this._rightChart.removeChildrenForDHReplaceTable();}var rowCount=this.dockedHeaderReplaceRows.length;for(;rowCount>0;rowCount--){var row=this.dockedHeaderReplaceRows.pop();this.pushRowRefToReusePool(row);}},pushRowRefToReusePool:function pushRowRefToReusePool(row){if(!row){return ;}var rowRef=row.rowRef;this.rowsReusePool.push(rowRef);row.rowRef={};},shiftDockedHeaderWithRow:function shiftDockedHeaderWithRow(pastOffset,onlyUpdateStatus){if(onlyUpdateStatus){return ;}if(this._leftChart){this.utils.translateCSS(0,pastOffset,0,this._leftChart.dockedHeaderReplaceDiv.firstChild);}if(this._rightChart){this.utils.translateCSS(0,pastOffset,0,this._rightChart.dockedHeaderReplaceDiv.firstChild);}},init:function init(props){this._super(props);},initFromVisProps:function(vp){initProp.call(this);var propValue=vp?vp:{},sparklineProps=this.sparklineProps,barProps=this.barProps,bulletProps=this.bulletProps,otherProps=this.otherProps;this.isTreeMode=getBoolValue(propValue.itd);if(propValue.lsh){sparklineProps.mbShow=(propValue.lsh==="true");}if(propValue.lap){sparklineProps.mbAllPoints=(propValue.lap==="true");}if(propValue.lep){sparklineProps.mbEndPoints=(propValue.lep==="true");}if(propValue.lrl){sparklineProps.mbRefLine=(propValue.lrl==="true");}if(propValue.lra){sparklineProps.mbRefArea=(propValue.lra==="true");}if(propValue.lmsh){sparklineProps.mbAssMetric=(propValue.lmsh==="true");}if(propValue.let){sparklineProps.mbShowTooltip=(propValue.let==="true");}if(propValue.llsc){sparklineProps.mwSeriesLineCol=convertToColor(propValue.llsc);}if(propValue.lrlc){sparklineProps.mwRefLineCol=convertToColor(propValue.lrlc);}if(propValue.lrac){sparklineProps.mwRefAreaCol=convertToColor(propValue.lrac);}if(propValue.lh){sparklineProps.mstrHeader=propValue.lh;}if(propValue.lam){sparklineProps.mstrAssMetric=propValue.lam;}if(propValue.bsg){barProps.mbShow=(propValue.bsg==="true");}if(propValue.bl){barProps.mbShowLegend=(propValue.bl==="true");}if(propValue.brl){barProps.mbRefLine=(propValue.brl==="true");}if(propValue.bet){barProps.mbShowTooltip=(propValue.bet==="true");}if(propValue.bpv){barProps.mwPosCol=convertToColor(propValue.bpv);}if(propValue.bnv){barProps.mwNegCol=convertToColor(propValue.bnv);}if(propValue.brlc){barProps.mwRefLineCol=convertToColor(propValue.brlc);}if(propValue.bh){barProps.mstrHeader=propValue.bh;}if(propValue.gsh){bulletProps.mbShow=(propValue.gsh==="true");}if(propValue.grl){bulletProps.mbRefLine=(propValue.grl==="true");}if(propValue.gra){bulletProps.mbRefBands=(propValue.gra==="true");}if(propValue.gl){bulletProps.mbShowLegend=(propValue.gl==="true");}if(propValue.gmsh){bulletProps.mbAssMetric=(propValue.gmsh==="true");}if(propValue.gia){bulletProps.mbInvertAxis=(propValue.gia==="true");}if(propValue.get){bulletProps.mbShowTooltip=(propValue.get==="true");}if(propValue.gmm){bulletProps.mfMinValue=parseFloat(propValue.gmm);}if(propValue.ggc){bulletProps.mwPosCol=convertToColor(propValue.ggc);}if(propValue.gnv){bulletProps.mwNegCol=convertToColor(propValue.gnv);}if(propValue.grlc){bulletProps.mwRefLineCol=convertToColor(propValue.grlc);}if(propValue.gpc){bulletProps.mwBand1=convertToColor(propValue.gpc);}if(propValue.grc){bulletProps.mwBand2=convertToColor(propValue.grc);}if(propValue.gsc){bulletProps.mwBand3=convertToColor(propValue.gsc);}if(propValue.gh){bulletProps.mstrHeader=propValue.gh;}if(propValue.gtam){bulletProps.mstrAssMetric=propValue.gtam;}if(propValue.glt){bulletProps.mstrBand1=propValue.glt;}if(propValue.gmt){bulletProps.mstrBand2=propValue.gmt;}if(propValue.ght){bulletProps.mstrBand3=propValue.ght;}if(propValue.wa){var value=parseFloat(propValue.wa);if(propValue.wa.indexOf("%")){value/=100;}otherProps.mfBkgOpacity=value;}if(propValue.metkpi){otherProps.mnMetricsPerKPI=parseInt(propValue.metkpi);}if(propValue.hch){otherProps.mbHideColHeaders=(propValue.hch==="true");}if(propValue.htc){otherProps.mbHideTextColumns=(propValue.htc==="true");}if(propValue.ll){otherProps.mbLockLayout=(propValue.ll==="true");}if(propValue.gam){otherProps.mbShowForHiddenGraphs=(propValue.gam==="true");}if(propValue.igf){otherProps.mbInheritFromGridGraph=(propValue.igf==="true");}if(propValue.scm){otherProps.mbInSingleColumnMode=(propValue.scm==="true");}if(propValue.cid){otherProps.mpColumnIDs=propValue.cid.split(",");}if(propValue.tcid){otherProps.mpColumnIDsInTreeMode=propValue.tcid.split(",");}if(propValue.co){otherProps.mpColumnPositions=propValue.co.split(",");}if(propValue.sc){otherProps.mpSortKey=propValue.sc;}if(propValue.so){otherProps.mbSortDescend=(propValue.so!=="false");}if(propValue.rh){otherProps.mRowHeight=parseFloat(propValue.rh);}otherProps.mRowHeight=otherProps.mRowHeight>27?otherProps.mRowHeight:27;setDimensionWithDPI.call(this);},preBuildRendering:function preBR(){console.log("in preb in MC");if(this._super){this._super();}var m=this.model;if(!m){m.err=mstrmojo.desc(8426,"No model provided");return ;}this.isAndroidTab=$D.isAndroid?!!mstrApp.isTablet():false;this.isAndroidPhone=$D.isAndroid&&!this.isAndroidTab;var propValue=m.vp||{};var isReport=this.controller&&(this.controller instanceof mstrmojo.android.controllers.XtabController);var fullScreen=this.isFullScreenWidget||isReport;this.enableSmoothScroll=(this.isAndroidPhone&&fullScreen)?true:getBoolValue(propValue.ss);if(propValue.mcs){this.metricColumnsSpacing=parseInt(propValue.mcs);}else{this.metricColumnsSpacing=this.isAndroidPhone?(mstrApp.isLandscape()?NORMAL:COMPACT):-1;}if(this.enableSmoothScroll){this.leftWidth=this.getWidth()/3;this.rightWidth=this.getWidth()/3*2;}else{this.leftWidth=this.getWidth();this.rightWidth=0;this.scrollerConfig.hScroll=false;}},buildRendering:function(){var that=this;var backup=mstrmojo.string.apply;mstrmojo.string.apply=function(tmpl,obj){if(!tmpl){return"";}return tmpl.replace(/\{([^\}]+)\}/gm,function tokenRepl(token,prop){var s=token.replace(/@/g,"that.");var res=eval(s);return res===undefined?"":res;});};if(this._super){this._super();}mstrmojo.string.apply=backup;},buildRows:function buildRows(){if(this.rowsNeedRebuild){if(this.isTreeMode){this.rows=getTreeNodeRows.call(this);}else{buildNonTreeRows.call(this);}this.rowsNeedRebuild=false;}},pushToReusePool:function pushToReusePool(beginCnt,endCnt){var bCnt=beginCnt!=undefined?beginCnt:this.startCnt;var eCnt=endCnt!=undefined?endCnt:this.endCnt;var rowInfo=null;for(var i=bCnt;i<eCnt;i++){rowInfo=this.rows[i];this.rowsReusePool.push(rowInfo.rowRef);rowInfo.rowRef={};}},popFromReusePool:function popFromReusePool(){var rowRef=this.rowsReusePool.pop();return rowRef||{};},reRenderChart:function reRenderChart(scrollTo,rowCount,adjustOffsetY){this.pushToReusePool();this.buildRows();var rowOffsetHeight=this.rowOffsetHeight;if(!rowCount){rowCount=0;}this.firstRowIdxOnScrn=parseInt(this.startCnt+scrollTo.y/rowOffsetHeight)-rowCount;this.getCurrRenderRowCount();if(adjustOffsetY==undefined){adjustOffsetY=scrollTo.y%rowOffsetHeight;}scrollTo.y=(this.firstRowIdxOnScrn-this.startCnt)*rowOffsetHeight+adjustOffsetY;this.lastScrollPosition.y=scrollTo.y;this.lastFirstRowIdxOnScrn=this.firstRowIdxOnScrn;var rows=this.rows;for(var i=this.startCnt;i<this.endCnt;i++){rows[i].rowRef=this.popFromReusePool();}if(!this.enableSmoothScroll){this._leftChart.reRenderRows(scrollTo);}else{this._leftChart.reRenderRows(scrollTo);this._rightChart.reRenderRows(scrollTo);}},reRenderChartWhenScrollDone:function reRenderChartwsd(scrollTo){var oldStartCnt=this.startCnt;var oldEndCnt=this.endCnt;var rowOffsetHeight=this.rowOffsetHeight;this.firstRowIdxOnScrn=parseInt(this.startCnt+scrollTo.y/rowOffsetHeight);this.getCurrRenderRowCount();var firstRowToRemove,lastRowToRemove,firstRowToRender,lastRowToRender;if(this.startCnt<oldEndCnt&&this.startCnt>oldStartCnt){firstRowToRemove=oldStartCnt;lastRowToRemove=this.startCnt;firstRowRemain=this.startCnt;lastRowRemain=oldEndCnt;firstRowToRender=oldEndCnt;lastRowToRender=this.endCnt;}else{if(oldStartCnt<this.endCnt&&oldStartCnt>this.startCnt){firstRowToRemove=this.endCnt;lastRowToRemove=oldEndCnt;firstRowRemain=oldStartCnt;lastRowRemain=this.endCnt;firstRowToRender=this.startCnt;lastRowToRender=oldStartCnt;}else{firstRowToRemove=oldStartCnt;lastRowToRemove=oldEndCnt;firstRowRemain=0;lastRowRemain=0;firstRowToRender=this.startCnt;lastRowToRender=this.endCnt;}}this.pushToReusePool(firstRowToRemove,lastRowToRemove);scrollTo.y=(this.firstRowIdxOnScrn-this.startCnt)*rowOffsetHeight+scrollTo.y%rowOffsetHeight;this.lastScrollPosition.y=scrollTo.y;this.lastFirstRowIdxOnScrn=this.firstRowIdxOnScrn;var rows=this.rows;for(var i=firstRowToRender;i<lastRowToRender;i++){rows[i].rowRef=this.popFromReusePool();}if(!this.enableSmoothScroll){this._leftChart.reRenderRows(scrollTo,firstRowRemain,lastRowRemain,firstRowToRender,lastRowToRender);}else{this._leftChart.reRenderRows(scrollTo,firstRowRemain,lastRowRemain,firstRowToRender,lastRowToRender);this._rightChart.reRenderRows(scrollTo,firstRowRemain,lastRowRemain,firstRowToRender,lastRowToRender);}},reRenderChartWithAnchor:function reRenderChartWithAnchor(anchorRowTreeNode,anchorRowIdxOnScrn){this.pushToReusePool();this.buildRows();var rowOffsetHeight=this.rowOffsetHeight;var anchorRowIdx=-1;for(var i=0;i<this.rows.length;i++){if(this.rows[i].treeNode.treePath==anchorRowTreeNode.treePath){anchorRowIdx=i;break;}}this.firstRowIdxOnScrn=anchorRowIdx-anchorRowIdxOnScrn;if(this.firstRowIdxOnScrn<0){this.firstRowIdxOnScrn=0;}this.getCurrRenderRowCount();scrollTo.y=(this.firstRowIdxOnScrn-this.startCnt)*rowOffsetHeight;this.lastScrollPosition.y=scrollTo.y;this.lastFirstRowIdxOnScrn=this.firstRowIdxOnScrn;var rows=this.rows;for(var i=this.startCnt;i<this.endCnt;i++){rows[i].rowRef=this.popFromReusePool();}if(!this.enableSmoothScroll){this._leftChart.reRenderRows(scrollTo);}else{this._leftChart.reRenderRows(scrollTo);this._rightChart.reRenderRows(scrollTo);}},supportsIncFetch:false,pageSize:0,getCurrRenderRowCount:function getCRRC(){var maxRenderRowCount=this.pageSize*PAGE_COUNT;if(this.rows.length<=maxRenderRowCount){this.partialRender=false;this.startCnt=0;this.endCnt=this.rows.length;}else{this.partialRender=true;this.startCnt=Math.round(this.firstRowIdxOnScrn-this.pageSize*(PAGE_COUNT-1)/2);if(this.startCnt<0){this.startCnt=0;}this.endCnt=this.startCnt+maxRenderRowCount;if(this.endCnt>this.rows.length){this.endCnt=this.rows.length;}}},getChartWithScrollBar:function(){if(this.enableSmoothScroll){return this._rightChart;}else{return this._leftChart;}},updateWindowRatio:function updateWindowRatio(){var chart=this.getChartWithScrollBar(),scroller=chart._scroller;scroller.chartTableRenderRatio=(this.endCnt-this.startCnt)/this.rows.length;scroller.topUnRenderedRatio=this.startCnt/this.rows.length;chart.updateScroller();},initValues:function initValues(){this.prevSelected={mrow:-2,mcol:-1};if(this.isTreeMode){initTree.call(this);}this.treeColumnIdx=-1;this.minPageSize=Math.ceil((this.getHeight()/this.otherProps.mRowHeight)*3/PAGE_COUNT);this.pageSize=this.minPageSize;this.rowsNeedRebuild=true;this.rows=[];this.dockedHeaderRows=[];this.dockedHeaderReplaceRows=[];this.rowsReusePool=[];this.unselectedRemainCells=[];this.errorMsg.style.display="none";},postBuildRendering:function postBR(){var me=this,model=me.model;var err=model.err||model.eg;if(err){me.renderErrorMessage(err);return ;}if(me.controller&&me.controller.view&&me.controller.view.model){if(!me.mcStatus&&me.controller.view.model.mcStatus){me.mcStatus=me.controller.view.model.mcStatus;}}me.initValues();me.highlightEntireRow=me.isTreeMode||me.isAllAttrSelectable;getUITheme.call(me);convertDataToModels.call(me);if(me.otherProps.mbInheritFromGridGraph){me.selectedClass="sc_"+me.model.k;}else{me.selectedClass="";}err=model.err||model.eg;if(err){me.renderErrorMessage(err);return ;}if(this._super){this._super();}me.renderLegend();me.getCurrRenderRowCount();me.restoreMCStatus();if(!me.enableSmoothScroll){me.itemsContainerNode.style.display="none";var props={placeholder:me.leftChart,colInfos:me.colInfos,theme:me.theme,isTreeMode:me.isTreeMode,showMinLabel:me.showMinLabel,width:me.leftWidth+"px",height:(me.getHeight()-me.legendHeight)+"px",textSpan:me.textSpan,textCanvas:me.textCanvas,headerCssClass:me.headerCssClass,valueCssClass:me.valueCssClass,isAndroidTab:me.isAndroidTab,widget:me,treeColumnIdx:me.treeColumnIdx,backgroundColor:me.backgroundColor,domRefName:LEFT_CHART_ROW,showScrollbars:true};var w=new mstrmojo.VisMicroChartTable(props);w.render();me._leftChart=w;w.parent=me;me.replaceScrollerUpdate(w);}else{var props={placeholder:me.leftChart,colInfos:me.colInfos.slice(0,this.attrColumnCount),theme:me.theme,isTreeMode:me.isTreeMode,showMinLabel:me.showMinLabel,width:me.leftWidth+"px",height:(me.getHeight()-me.legendHeight)+"px",textSpan:me.textSpan,textCanvas:me.textCanvas,headerCssClass:me.headerCssClass,valueCssClass:me.valueCssClass,isAndroidTab:me.isAndroidTab,widget:me,treeColumnIdx:me.treeColumnIdx,backgroundColor:me.backgroundColor,domRefName:LEFT_CHART_ROW,showScrollbars:false,zIndex:1};var w=new mstrmojo.VisMicroChartTable(props);w.render();me._leftChart=w;w.parent=me;me.leftChart=w.domNode;var props={placeholder:me.rightChart,colInfos:me.colInfos.slice(this.attrColumnCount),theme:me.theme,isTreeMode:me.isTreeMode,showMinLabel:me.showMinLabel,width:me.rightWidth+"px",height:(me.getHeight()-me.legendHeight)+"px",textSpan:me.textSpan,textCanvas:me.textCanvas,headerCssClass:me.headerCssClass,valueCssClass:me.valueCssClass,isAndroidTab:me.isAndroidTab,widget:me,treeColumnIdx:me.treeColumnIdx,backgroundColor:me.backgroundColor,domRefName:RIGHT_CHART_ROW,showScrollbars:true};var w2=new mstrmojo.VisMicroChartTable(props);w2.render();me._rightChart=w2;w2.parent=me;me.rightChart=w2.domNode;me.replaceScrollerUpdate(w2);if(this.theme==DEFAULT_LIGHT_THEME||this.theme==CUSTOM_LIGHT_THEME){me.dropShadowDiv.style.backgroundImage="-webkit-gradient(linear, left top, right top, color-stop(0, rgba(0,0,0,0.25)), color-stop(1, rgba(0,0,0,0)))";}else{me.dropShadowDiv.style.backgroundImage="-webkit-gradient(linear, left top, right top, color-stop(0, rgba(0,0,0,0.5)), color-stop(1, rgba(0,0,0,0)))";}w2.addSyncScroller(w);w.addSyncScroller(w2);me.scrollerConfig.scrollEl=me.rightChart;me.updateScroller();var scrollTo=null;if(this.mcStatus&&this.mcStatus.hScrollPos!=undefined){var xPos=Math.min(this.mcStatus.hScrollPos*this.rightWidth,this.rightWidth+this.leftWidth-this.getWidth());scrollTo=this._scroller.origin={x:xPos,y:0};}setScrollerPosition.call(me,scrollTo);var headerHeight=Math.max(me._leftChart.headerTableOffsetHeight,me._rightChart.headerTableOffsetHeight);me._leftChart.headerTable.style.height=headerHeight+"px";me._rightChart.headerTable.style.height=headerHeight+"px";me._leftChart.updateHeaderTableOffsetH();me._rightChart.updateHeaderTableOffsetH();}me.rowOffsetHeight=(me.otherProps.mbHideTextColumns&&this.enableSmoothScroll)?w2.rowOffsetHeight:w.rowOffsetHeight;if(me.isTreeMode){if(me.mcStatus&&me.mcStatus.dHRowIdxList){me._leftChart.initDHs();if(me._rightChart){me._rightChart.initDHs();}me.addRowsToDH(me.mcStatus.dHRowIdxList);if(me.mcStatus.dHReplaceRowIdxList.length>0){me.addRowsToDH(me.mcStatus.dHReplaceRowIdxList,true);var pastOffset=me.mcStatus.scrollTo.y%me.rowOffsetHeight;me.shiftDockedHeaderWithRow(-pastOffset);}}else{me.initDockedHeaders();}}me.removeMCStatus();me.getDefaultHighlightRow();me.updateSelectedStatus(me.tree);me.updateHighlightForCurrRenderRows();me.chartTableMaxHeight=me.getHeight()-me._leftChart.headerTableOffsetHeight;if(me.legendDis){me.chartTableMaxHeight-=me.legendHeight;}me.pageSize=Math.max(Math.min(parseInt(me.chartTableMaxHeight/me.rowOffsetHeight)+1,20),me.minPageSize);setChartTableHeight.call(me);var xtabModel=me.xtabModel,docModel=(xtabModel&&xtabModel.docModel);if(docModel){me._infoWClosedListener=me.xtabModel.docModel.attachEventListener("infoWindowClosed",this.id,function(evt){var infoWindowK=evt.psKey;if(!me.hasNonifwTarget&&me.selectorTargets&&me.selectorTargets[infoWindowK]){window.setTimeout(function(){if(me.isTreeMode){var treeNode=me.lastSelectedObj[me.lastSelectedObj.length-1];if(treeNode&&treeNode.treePath){me.closedIfwAttr=treeNode.treePath;me.currSelectedObj=[];me.updateSelectedStatus(me.tree);me.updateHighlightForCurrRenderRows();me.lastSelectedObj=[];}}else{if(me.isAllAttrSelectable){me.closedIfwAttr=me.prevSelected.mrow;me.clearPreHighlightRowStatus();me.updateUnselectedRemainCells();me.updateSelectedStatus(me.tree);me.updateHighlightForCurrRenderRows();}else{var mcol=me.prevSelected&&me.prevSelected.mcol;var id=me.colInfos[mcol]&&me.colInfos[mcol].order;id=id.split(":")[0];me.closedIfwAttr=id;var ctlMatrix=me.ctlMatrix[id];var ctlMatrixCG=me.ctlMatrix[id+":CG"];var selectedIdxBackup=ctlMatrix.selectedIdx;var selectedIdxCGBackup=ctlMatrixCG&&ctlMatrixCG.selectedIdx;ctlMatrix.selectedIdx={};if(ctlMatrixCG){ctlMatrixCG.selectedIdx={};}me.updateSelectedStatus();me.updateHighlightForCurrRenderRows();ctlMatrix.selectedIdx=selectedIdxBackup;if(ctlMatrixCG){ctlMatrixCG.selectedIdx=selectedIdxCGBackup;}}}},10);}});}this.renderTextTooltip();},renderTextTooltip:function renderTextTooltip(){var props={placeholder:this.textTooltip,boundary:this.domNode};this._textTooltip=new mstrmojo.VisTextTooltip(props);this._textTooltip.render();this._textTooltip.toggle(false);},replaceScrollerUpdate:function replaceScrollerUpdate(chartTable){chartTable._scroller.updateScrollBars=function updateScrollBars(viewportCoords,scrollBarContainerElement){var scrollEl=this.scrollEl;if(!this.showScrollbars||!scrollEl){return ;}var bars=this._scrollBarEls;var chartTableRenderRatio=this.chartTableRenderRatio||1;var topUnRenderedRatio=this.topUnRenderedRatio||0;if(!bars){var me=this;bars=this._scrollBarEls={x:"hScroll",y:"vScroll"};$forEachHash(bars,function(scroll,axis){if(me[scroll]){var bar=document.createElement("div");bar.className="mstrmojo-touch-scrollBar "+axis+"Axis";(scrollBarContainerElement||scrollEl.parentNode).appendChild(bar);bars[axis]=bar;}else{delete bars[axis];}});}if(!viewportCoords){var parentNode=this.scrollEl.parentNode;viewportCoords={top:0,right:parentNode.clientWidth,bottom:parentNode.clientHeight,left:0};}var offset=9,scrollBarCoords={x:{left:viewportCoords.left,top:viewportCoords.bottom-offset,x:viewportCoords.right-viewportCoords.left,d:"Width"},y:{left:viewportCoords.right-offset,top:viewportCoords.top,x:viewportCoords.bottom-viewportCoords.top,d:"Height"}};var me=this;$forEachHash(bars,function(bar,axis){var barStyle=bar.style,coords=scrollBarCoords[axis],dimension=coords.d,parentNode=bar.parentNode,x=coords.x;var left=coords.left,top=coords.top+x*topUnRenderedRatio,ratio=x/scrollEl["offset"+dimension]*chartTableRenderRatio,length=Math.min(Math.round(x*ratio),x);bar.baseLeft=left;bar.baseTop=top;bar.ratio=ratio;bar.viewportSize=$M.round(x*chartTableRenderRatio);bar.length=length;barStyle.left=left+"px";barStyle.top=top+"px";barStyle[dimension.toLowerCase()]=length+"px";var isX=(axis==="x"),direction=isX?"hScroll":"vScroll";if(me[direction]){var origin=me.origin,position=origin&&origin[axis]||0,viewportSize=bar.viewportSize,minScale=6/length,minPosition=bar["base"+((isX)?"Left":"Top")],maxPosition=minPosition+viewportSize-length,newPosition=$M.round(minPosition+(ratio*position));if(newPosition<minPosition){newPosition=minPosition-position;length+=position;}else{if(newPosition>maxPosition){var delta=(position-me.offset[axis].end)*ratio;newPosition=$M.min(maxPosition+delta,viewportSize+minPosition-6)-1;length-=delta;}}var v=0,translate=[v,v,v],scale=[1,1,1],idx=(isX)?0:1;translate[idx]=(newPosition-minPosition);scale[idx]=$M.min($M.max(length/bar.length,minScale),1);$D.translate(bar,translate[0],translate[1],translate[2]," scale3d("+scale.join(",")+")");}});};},setElementDimension:function setElementDimension(e,width){var paddingWidth=0;var compStyle=mstrmojo.css.getComputedStyle(e);if(compStyle.paddingLeft){paddingWidth+=parseFloat(compStyle.paddingLeft);}if(compStyle.paddingRight){paddingWidth+=parseFloat(compStyle.paddingRight);}e.style.width=(width-paddingWidth)+"px";},setColorByTheme:function setColorByTheme(){var bulletProps=this.bulletProps;if(this.theme==DEFAULT_DARK_THEME){this.bandColor1="#494949";this.bandColor2="#595959";this.bandColor3="#727272";this.refLinePosColor="#FF781D";this.refLineNegColor="#FF781D";this.refLineWidth=2;this.blueBarPosColor="#00BDFF";this.blueBarNegColor="#00BDFF";}else{if(this.theme==DEFAULT_LIGHT_THEME){this.bandColor1="#A5A5A5";this.bandColor2="#B3B3B3";this.bandColor3="#C4C4C4";this.refLinePosColor="#FF781D";this.refLineNegColor="#FF781D";this.refLineWidth=2;this.blueBarPosColor="#00BDFF";this.blueBarNegColor="#00BDFF";}else{this.bandColor1=bulletProps.mwBand1||"#999999";this.bandColor2=bulletProps.mwBand2||"#BBBBBB";this.bandColor3=bulletProps.mwBand3||"#DEDEDE";this.refLinePosColor=bulletProps.mwRefLineCol;this.refLineNegColor=bulletProps.mwRefLineCol;this.blueBarPosColor=bulletProps.mwPosCol;this.blueBarNegColor=bulletProps.mwNegCol;}}},renderLegend:function renderLgd(){var bulletProps=this.bulletProps;this.setColorByTheme();this.legendDis=this.showGauge&&this.bulletProps.mbShowLegend;if(this.legendDis){this.legend.className+=" "+this.valueCssClass;this.legend.style.display="block";this.legend.style.fontSize=Math.round(11*zf)+"pt";this.setElementDimension(this.legend,this.getWidth());if(bulletProps.mstrBand1){this.legendLowFont.innerHTML=bulletProps.mstrBand1;}this.legendLowBand.style.backgroundColor=this.bandColor1;if(bulletProps.mstrBand2){this.legendMidFont.innerHTML=bulletProps.mstrBand2;}this.legendMidBand.style.backgroundColor=this.bandColor2;if(bulletProps.mstrBand3){this.legendHighFont.innerHTML=bulletProps.mstrBand3;}this.legendHighBand.style.backgroundColor=this.bandColor3;var lowWidth=this.legendLow.offsetWidth,midWidth=this.legendMid.offsetWidth,highWidth=this.legendHigh.offsetWidth;if(lowWidth+midWidth+highWidth>this.getWidth()){if(lowWidth+midWidth>this.getWidth()){this.legendLow.style.width=this.width;if(midWidth+highWidth>this.getWidth()){this.legendMid.style.width=this.width;this.legendHigh.style.width=this.width;}else{this.legendMid.style.width=(this.getWidth()-highWidth)+"px";}}else{this.legendLow.style.width=(this.getWidth()-midWidth)+"px";this.legendHigh.style.width=this.width;}}this.legendHeight=this.legend.firstChild.offsetHeight;this.legend.style.height=this.legendHeight+"px";}else{this.legend.style.display="none";this.legendHeight=0;}},showChartTooltip:function showChartTooltip(touchedChart,touch){var me=this;var wasNoTooltip=this.tooltip.style.display==="none"||!(this.tooltip.style.display);touchedChart.showTooltip(touch.pageX,touch.pageY);var nowHasTooltip=this.tooltip.style.display==="block";this.tooltipShow=nowHasTooltip;if(wasNoTooltip&&nowHasTooltip){var touchManager=mstrmojo.touchManager;this._touchListener=touchManager.attachEventListener("touchesBegin",this.id,function(evt){if(!isTouchedOnWidget.call(me,evt.touch)){hideTooltipGlobal.call(me,evt.touch);}});}},touchSelectBegin:function touchSelectBegin(touch){if(touch.evt.ctrlKey){this.touchMultiBegin(touch);return ;}var me=this;hideTooltipGlobal.call(me);var td=mstrmojo.dom.findAncestorByAttr(touch.target,"mcol",true,this.domNode);if(td&&td.node){var mrow=td.node.getAttribute("mrow");var mcol=td.node.getAttribute("mcol");if(mrow==-1){this.showTextTooltip(td.node,mcol,true);}else{var tr=td.node.parentNode;var rowInfo=null;if(tr.getAttribute("rowType")==DOCKED_HEADER){var dockedHeaderIdx=getIdxByRowIdx(this.dockedHeaderRows,mrow);if(dockedHeaderIdx>=0){rowInfo=this.dockedHeaderRows[dockedHeaderIdx];}else{dockedHeaderIdx=getIdxByRowIdx(this.dockedHeaderReplaceRows,mrow);rowInfo=this.dockedHeaderReplaceRows[dockedHeaderIdx];}}else{rowInfo=this.rows[mrow];}var colInfo=this.colInfos[mcol];if(colInfo.type==CHART){var touchedChart=rowInfo&&rowInfo.rowRef&&rowInfo.rowRef[mcol];if(touchedChart){this.showChartTooltip(touchedChart,touch);this.currSelectedWidget={mrow:mrow,mcol:mcol};}}else{if(colInfo.type==ATTR_NAME||colInfo.type==METRIC_VALUE||colInfo.type==METRIC_NAME){this.showTextTooltip(td.node,mcol);}}}}},showTextTooltip:function showTextTooltip(e,mcol,onHeader){if(onHeader){var colInfo=this.colInfos[mcol],text=colInfo.title;if(colInfo.titleOverflow&&this._textTooltip){this._textTooltip.updateContent(e,onHeader?"title":"content",text);}}else{var text=e.innerText;var tmpLength=this.getTextWidthByCanvas(text,e,true);if(tmpLength>e.offsetWidth&&this._textTooltip){this._textTooltip.updateContent(e,onHeader?"title":"content",text);}}},hideTextTooltip:function hideTextTooltip(){if(this._textTooltip){this._textTooltip.toggle(false);}},touchSelectEnd:function touchSelectEnd(touch){if(touch.evt.ctrlKey){this.touchMultiEnd(touch);return ;}this.currSelectedWidget=null;this.hideTextTooltip();},touchSelectMove:function touchSelectMove(touch){if(touch.evt.ctrlKey){this.touchMultiMove(touch);return ;}if(!this.currSelectedWidget){return ;}this.tooltip.style.display="none";var target=touch.target;var mcol=-1,colInfo=null;var targetFound=true;var td=mstrmojo.dom.findAncestorByAttr(target,"mcol",true,this.domNode);td=td&&td.node;if(td){mcol=td.getAttribute("mcol");colInfo=this.colInfos[mcol];if(colInfo.order=="GaugeChart"){targetFound=false;}}else{targetFound=false;}if(targetFound===false){target=document.elementFromPoint(touch.pageX,touch.pageY);td=mstrmojo.dom.findAncestorByAttr(target,"mcol",true,this.domNode);td=td&&td.node;if(!td){return ;}mcol=td.getAttribute("mcol");colInfo=this.colInfos[mcol];}var mrow=td.getAttribute("mrow");var tr=td.parentNode;var rowInfo=null;if(tr.getAttribute("rowType")==DOCKED_HEADER){var dockedHeaderIdx=getIdxByRowIdx(this.dockedHeaderRows,mrow);if(dockedHeaderIdx>=0){rowInfo=this.dockedHeaderRows[dockedHeaderIdx];}else{dockedHeaderIdx=getIdxByRowIdx(this.dockedHeaderReplaceRows,mrow);rowInfo=this.dockedHeaderReplaceRows[dockedHeaderIdx];}}else{rowInfo=this.rows[mrow];}var touchedChart=rowInfo&&rowInfo.rowRef&&rowInfo.rowRef[mcol];var tooltipShown;if(touchedChart){if(colInfo.order=="LineChart"||colInfo.order=="BarChart"){if(mrow==this.currSelectedWidget.mrow&&mcol==this.currSelectedWidget.mcol){tooltipShown=touchedChart.showTooltip(touch.pageX,touch.pageY);this.currSelectedWidget={mrow:mrow,mcol:mcol};}}else{if(mcol==this.currSelectedWidget.mcol&&mrow!=this.currSelectedWidget.mrow){tooltipShown=touchedChart.showTooltip(touch.pageX,touch.pageY);this.currSelectedWidget={mrow:mrow,mcol:mcol};}}}if(tooltipShown){this.tooltipShow=true;}console.log("tooltip show:"+this.tooltipShow);if(this.tooltipShow){this.tooltip.style.display="block";}},touchSwipeBegin:function touchSwipeBegin(touch){hideTooltipGlobal.call(this);if(isScrollableElementTouched.call(this,touch)&&this._super){this._super(touch);}else{this._touchCanceled=true;}},touchSwipeMove:function touchSwipeMove(touch){if(!this._touchCanceled&&this._super){this._super(touch);}},touchSwipeEnd:function touchSwipeEnd(touch){if(!this._touchCanceled&&this._super){this._super(touch);}},getColIdx:function getColIdx(order){var colInfos=this.colInfos,colCount=colInfos.length;for(var i=0;i<colCount;i++){var target=colInfos[i].order.split(":")[0];if(target+":CG"==colInfos[i].order){target=target+":CG";}if(order==target){return colInfos[i].colIdx||i;}}return -1;},buildLeftParent:function buildLeftParent(node,mrow,mcol){var colInfos=this.colInfos,colCount=colInfos.length;if(!this.isKPI){if(mrow==-1){var gts=this.model.gts;var metricIndex=mstrmojo.array.find(gts.col,"n","Metrics");node._e=gts.col[metricIndex].es[colInfos[mcol].order]||{id:"",n:""};node.v=node._e.n;}else{var rows=this.model.gts.row;var currNode=node;for(var i=colCount-1;i>=0;i--){var colInfo=colInfos[i];if(colInfo.type==CHART){continue;}if(colInfo.type==ATTR_NAME){var nodeLP={};var index=mstrmojo.array.find(rows,"id",colInfo.order.split(":")[0]);nodeLP.titleInfo=rows[index];nodeLP._e=this.rows[mrow].model.elms[colInfo.order]||{id:"",n:""};nodeLP.v=nodeLP._e.n;nodeLP.axis=ROW_AXIS;currNode._lp=nodeLP;currNode=nodeLP;}}}}else{if(mcol==0){var gts=this.model.gts;var metricIndex=mstrmojo.array.find(gts.col,"n","Metrics");node._e=gts.col[metricIndex].es[mrow]||{id:"",n:""};node.v=node._e.n;}else{var rows=this.model.gts.row;var currNode=node;for(var i=0;i<rows.length;i++){var nodeLP={};nodeLP.titleInfo=rows[i];var idx=rows[i].es.length;nodeLP._e=rows[i].es[idx-1]||{id:"",n:""};nodeLP.v=nodeLP._e.n;nodeLP.axis=ROW_AXIS;currNode._lp=nodeLP;currNode=nodeLP;}}}},getModelK:function getModelK(){var k=this.model&&this.model.k;return k;},addSCObjToList:function addSCObjToList(scObjList,rowH,n,id){var scObj={};scObj.sc=rowH.sc;scObj.es=n;scObj.eid=id;scObjList.push(scObj);},getSelectionObjForTreeMode:function getSelectionObjForTreeMode(touchedObj){var attrIdxArray=this.attrMapIdx;var me=this,model=me.model,gts=model.gts,rows=gts.row;var scObjList=[];var actionType=0;var selectedAll=false;var treeNode=touchedObj.treeNode;var treePath=treeNode.treePath;var treePathArray=treePath.split("_");var treeLevel=treePathArray.length-1;var isAttrSelectable=this.isAttrSelectable(treeLevel);if(this.closedIfwAttr==treePath){return null;}if(isAttrSelectable){var isTappedNodeSelected=this.lastSelectedObj&&this.lastSelectedObj[treeLevel]&&(this.lastSelectedObj[treeLevel].treePath==treePath);if(!isTappedNodeSelected){this.currSelectedObj=this.getSelectedTreeNodeListFromTreePath(treePathArray);var useFirstAttr=false;var parentTreeNode=this.currSelectedObj[treeLevel];for(var i=treeLevel+1;i<this.lastSelectedObj.length;i++){var thisLevelSelectable=this.isAttrSelectable(i);var thisLevelSelected=!!this.lastSelectedObj[i];if(!thisLevelSelectable||!thisLevelSelected){useFirstAttr=true;this.currSelectedObj[i]=null;parentTreeNode=parentTreeNode.childrenTreeNodeList[0];continue;}if(!useFirstAttr){var attrID=this.lastSelectedObj[i].id;var treeNodeList=parentTreeNode.childrenTreeNodeList;for(var j=0;j<treeNodeList.length;j++){if(attrID==treeNodeList[j].id){this.currSelectedObj[i]=treeNodeList[j];break;}}if(j==treeNodeList.length){useFirstAttr=true;}}if(useFirstAttr){this.currSelectedObj[i]=parentTreeNode.childrenTreeNodeList[0];}parentTreeNode=this.currSelectedObj[i];}selectedAll=false;for(var i=0;i<this.currSelectedObj.length;i++){var treeNode=this.currSelectedObj[i];if(treeNode){var attrIdx=attrIdxArray[i];rowH=rows[attrIdx];this.addSCObjToList(scObjList,rowH,treeNode.n,treeNode.id);}else{continue;}}}else{for(var i=treeLevel;i<this.lastSelectedObj.length;i++){var treeNode=this.currSelectedObj[i];if(!treeNode){continue;}var attrIdx=attrIdxArray[i];rowH=rows[attrIdx];var unselectable=rowH.sc&&!(rowH.sc.all==="false"||rowH.sc.all===false);if(treeNode&&!unselectable){break;}else{this.addSCObjToList(scObjList,rowH,treeNode.n,"OA:(All)");this.currSelectedObj[i]=null;}}if(i==treeLevel){return{at:0};}while(this.currSelectedObj.length>0&&!this.currSelectedObj[this.currSelectedObj.length-1]){this.currSelectedObj.pop();}for(;i<this.currSelectedObj.length;i++){var treeNode=this.currSelectedObj[i];if(treeNode){var attrIdx=attrIdxArray[i];rowH=rows[attrIdx];this.addSCObjToList(scObjList,rowH,treeNode.n,treeNode.id);}else{continue;}}selectedAll=true;}}if(scObjList.length>0){actionType=actionType|SELECTOR_ACTION;var hasInfoWOnNode=this.hasInfoWOnNode(rows[attrIdxArray[treeLevel]]);var anchorNode=selectedAll?null:hasInfoWOnNode?touchedObj.node:null;return{at:actionType,k:this.getModelK(),scObjList:scObjList,anchor:anchorNode};}return null;},hasInfoWOnNode:function hasInfoWOnNode(rowH,onlyIfW){var xtabModel=this.xtabModel,docModel=(xtabModel&&xtabModel.docModel);if(docModel){var layouts=docModel.defn&&docModel.defn.layouts,layout=null;var i;if(layouts){for(i in layouts){if(layouts[i].loaded){layout=layouts[i];break;}}}var units=layout&&layout.units;if(units&&rowH){var tksList=rowH.sc.tks.split("\x1E");for(var j=0;j<tksList.length;j++){var unit=units[tksList[j]];if(unit){if(this.isChildOfIfw(units,unit)){if(!onlyIfW){return true;}}else{if(onlyIfW){return false;}}}}}}return onlyIfW?true:false;},getSelectionObjForNonTreeMode:function getSelectionObjForNonTreeMode(touchedObj){var mcol=touchedObj.mcol,mrow=touchedObj.mrow,colInfos=this.colInfos;var attrIdxArray=this.attrMapIdx;var me=this,model=me.model,gts=model.gts,rows=gts.row;var scObjList=[];var actionType=0;var selectedAll=false;var id=colInfos[mcol].order;if(this.isAllAttrSelectable){id=id.split(":")[0];var hasTapRemainCell=this.updateUnselectedRemainCells({mrow:mrow,mcol:mcol});if(hasTapRemainCell){return null;}if(mrow==this.prevSelected.mrow){if(mrow>=0){for(var key in this.ctlMatrix){var obj=this.ctlMatrix[key];if(!obj.sc||!obj.sc.tks){continue;}if(obj.sc.all==="false"||obj.sc.all===false){var i=0;var colInfos=this.colInfos;var colCount=colInfos.length;for(;i<colCount;i++){if(key==colInfos[i].order.split(":")[0]){break;}}this.unselectedRemainCells.push({mrow:mrow,mcol:i});continue;}var selectedIdx=obj.map[mrow];var elementId=obj.es[selectedIdx].id;if(!elementId||elementId.substring(0,1)==="D"){continue;}selectedAll=true;this.addSCObjToList(scObjList,obj,"","OA:(All)");}if(scObjList.length>0){this.clearPreHighlightRowStatus();this.prevSelected={mrow:-2,mcol:-1};this.updateUnselectedRemainCells();actionType=actionType|SELECTOR_ACTION;var anchorNode=selectedAll?null:touchedObj.node;return{at:actionType,k:this.getModelK(),scObjList:scObjList,anchor:anchorNode};}else{this.unselectedRemainCells=[];}return{at:actionType};}}else{this.updateUnselectedRemainCells();this.unselectedRemainCells=[];}if(touchedObj.mrow==-1){}else{if(this.ctlMatrix){this.clearPreHighlightRowStatus();for(var key in this.ctlMatrix){var obj=this.ctlMatrix[key];if(!obj.sc){continue;}if(!obj.sc.tks||(obj.sc.tks=="")){continue;}var selectedIdx=obj.map[mrow];if(obj.es[selectedIdx]){var elementId=obj.es[selectedIdx].id;if(!elementId||elementId.substring(0,1)==="D"){continue;}this.addSCObjToList(scObjList,obj,"",elementId);}}if(scObjList.length>0){this.rows[mrow].selected[-1]=true;this.prevSelected={mrow:mrow,mcol:-1};actionType=actionType|SELECTOR_ACTION;var anchorNode=selectedAll?null:touchedObj.node;return{at:actionType,k:this.getModelK(),scObjList:scObjList,anchor:anchorNode};}}}}else{var isCG=false;if(id.indexOf(":CG")===id.length-3&&id.length>=3){isCG=true;}id=id.split(":")[0];if(this.ctlMatrix&&this.ctlMatrix[id]){var ctlMatrix=this.ctlMatrix[id];var ctlMatrixCG=this.ctlMatrix[id+":CG"];if(ctlMatrix.sc&&ctlMatrix.sc.tks!=""){var elementId="";var isAll=false;if(mrow==-1){}else{var selectedIdx=ctlMatrix.map[mrow];if(ctlMatrix.es[selectedIdx]){elementId=ctlMatrix.es[selectedIdx].id;if(!elementId||elementId.substring(0,1)==="D"){return ;}}var sameAsLastSelected=function(){var result=ctlMatrix.selectedIdx[selectedIdx];if(ctlMatrixCG){if(ctlMatrixCG.selectedIdx[-1]){return result;}else{return result&&ctlMatrixCG.selectedIdx[ctlMatrixCG.map[mrow]];}}return result;};if(sameAsLastSelected()){var canSelectAll=!(ctlMatrix.sc.all==="false"||ctlMatrix.sc.all===false);if(canSelectAll){elementId="OA:(All)";selectedAll=true;ctlMatrix.selectedIdx={};if(ctlMatrixCG){ctlMatrixCG.selectedIdx={};}this.prevSelected={mrow:-2,mcol:-1};}else{return null;}}else{ctlMatrix.selectedIdx={};ctlMatrix.selectedIdx[selectedIdx]=true;if(ctlMatrixCG){ctlMatrixCG.selectedIdx={};if(isCG){ctlMatrixCG.selectedIdx[ctlMatrixCG.map[mrow]]=true;if(ctlMatrixCG.map[mrow]<ctlMatrixCG.es.length){elementId=ctlMatrixCG.es[ctlMatrixCG.map[mrow]].id;}}else{ctlMatrixCG.selectedIdx[-1]=true;}}this.prevSelected={mrow:mrow,mcol:mcol};}}var scObj={};scObj.sc=ctlMatrix.sc;scObj.eid=elementId;scObjList.push(scObj);}}if(scObjList.length>0){actionType=actionType|SELECTOR_ACTION;var anchorNode=selectedAll?null:touchedObj.node;return{at:actionType,k:this.getModelK(),scObjList:scObjList,anchor:anchorNode};}}return null;},getLinkDrillObjForTreeMode:function getLinkDrillObjForTreeMode(touchedObj){var actionType=0;var linkDrillNode=null;var model=this.model,gts=model.gts,rowHs=gts.row;var mcol=touchedObj.mcol,mrow=touchedObj.mrow,colInfos=this.colInfos;var treeNode=touchedObj.treeNode;var treePath=treeNode.treePath;var treePathArray=treePath.split("_");var treeLevel=treePathArray.length-1;var attrIdxArray=this.attrMapIdx;var id=null;var colInfo=colInfos[mcol];var colType=colInfo&&colInfo.type;if(colType==ATTR_NAME){if(mrow==-1){}else{var rowH=rowHs[attrIdxArray[treeLevel]];if(rowH.lm&&rowH.lm[0]&&rowH.lm[0].links){linkDrillNode={};linkDrillNode.titleInfo=rowH;var treeNode=getTreeNode(this.tree,treePath);linkDrillNode._e=treeNode.es[0]||{n:"",id:""};linkDrillNode.v=linkDrillNode._e.n;}}}else{if(colType==METRIC_VALUE){if(colInfo.lm){id=colInfo.order;var mix=parseInt(id);var metricH=gts.col[0];if(metricH){linkDrillNode={};linkDrillNode.mix=mix;linkDrillNode.titleInfo=metricH;if(mrow==-1){linkDrillNode._e=metricH.es[mix]||{n:"",id:""};linkDrillNode.v=linkDrillNode._e.n;}else{var currNode=linkDrillNode;var treeNode=this.tree;for(var i=0;i<treePathArray.length;i++){var idx=treePathArray[i];treeNode=treeNode.childrenTreeNodeList[idx];var attrIdx=attrIdxArray[i];rowH=rowHs[attrIdx];var nodeLP={};nodeLP.titleInfo=rowH;nodeLP._e=treeNode.es[0]||{n:"",id:""};nodeLP.v=nodeLP._e.n;currNode._lp=nodeLP;currNode.axis=ROW_AXIS;currNode=nodeLP;}}}}}}if(linkDrillNode){this.highlightEntireRow=false;actionType=actionType|HYPERLINK_ACTION;return{at:actionType,k:this.getModelK(),node:linkDrillNode};}},getLinkDrillObjForNonTreeMode:function getLinkDrillObjForNonTreeMode(touchedObj){var actionType=0;var model=this.model,gts=model.gts,rowHs=gts.row;var mcol=touchedObj.mcol,mrow=touchedObj.mrow,colInfos=this.colInfos;var node=touchedObj.node,titleInfo;this.highlightEntireRow=false;var attrIdxArray=this.attrMapIdx;var colInfo=colInfos[mcol];if(!this.isKPI){if(linkCount===1&&attrCount===1&&mrow!=-1){for(var key in colInfos){var colInf=colInfos[key];if(colInf.lm&&colInf.type==ATTR_NAME){this.highlightEntireRow=true;var titleInfo=colInf.lm;actionType=titleInfo&&titleInfo.at||HYPERLINK_ACTION;node._e=this.rows[mrow].model.elms[colInf.order]||{id:"",n:""};node.v=node._e.n;break;}}}if(!this.highlightEntireRow){if(colInfo.type==CHART){return null;}var titleInfo=colInfo.lm;if(titleInfo){actionType=titleInfo&&titleInfo.at;if(colInfo.type==ATTR_NAME){if(mrow===-1){node._e={};node._e.onTitle=true;node._e.id=titleInfo.id;node._e.n=titleInfo.n;node.v=titleInfo.n;}else{node._e=this.rows[mrow].model.elms[colInfo.order]||{id:"",n:""};node.v=node._e.n;}}else{if(colInfo.type==METRIC_VALUE){node.mix=colInfo.order;node.axis=ROW_AXIS;this.buildLeftParent(node,mrow,mcol);actionType=this.rows[mrow==-1?0:mrow].model.refv[colInfo.order].at||HYPERLINK_ACTION;}}}}}else{if(colInfo.type==CHART){return null;}var titleInfo=colInfo.lm;var metricIdx=this.rows[mrow].model.metricIdx;if(titleInfo&&titleInfo.lm&&titleInfo.lm[metricIdx]&&titleInfo.lm[metricIdx].links){node.mix=""+metricIdx;node.axis=ROW_AXIS;this.buildLeftParent(node,metricIdx,mcol);actionType=this.rows[mrow].model.refv[0].at||HYPERLINK_ACTION;}else{titleInfo=null;}}if(titleInfo){node.titleInfo=titleInfo;actionType=actionType|HYPERLINK_ACTION;return{at:actionType,mcol:mcol,mrow:mrow,k:this.getModelK(),node:node};}return null;},getActionObj:function getActionObj(touchedObj){var actionObjList=[];if(touchedObj.mrow==-1){return null;}var actionObj=null;if(this.isTreeMode){actionObj=this.getSelectionObjForTreeMode(touchedObj);}else{actionObj=this.getSelectionObjForNonTreeMode(touchedObj);}if(actionObj){actionObjList.push(actionObj);return actionObjList;}else{if(this.isTreeMode){actionObj=this.getLinkDrillObjForTreeMode(touchedObj);}else{actionObj=this.getLinkDrillObjForNonTreeMode(touchedObj);}actionObjList.push(actionObj);}return actionObjList;},getDefaultHighlightRow:function getDHR(){var attrIdxArray=this.attrMapIdx;var rows=this.model.gts.row;if(!this.isTreeMode){if(this.isAllAttrSelectable){var isAllSelected=false;var resultSet=null,controlMatrix=null;var hasOnlyIfwTarget=true;var colInfos=this.colInfos,colCount=colInfos.length;for(var i=0;i<colCount;i++){var colInfo=colInfos[i],id=colInfo.order;var trueId=id.split(":")[0];if(id!=trueId+":CG"){id=trueId;}controlMatrix=this.ctlMatrix[id];if(controlMatrix){if(!this.hasInfoWOnNode(controlMatrix,true)){hasOnlyIfwTarget=false;}if(controlMatrix.selectedIdx[-1]){isAllSelected=true;this.prevSelected={mrow:-1,mcol:i};}else{colInfo.selected=false;}if(!isAllSelected){if(!resultSet){resultSet={};for(var j=0;j<controlMatrix.map.length;j++){if(controlMatrix.selectedIdx[controlMatrix.map[j]]){resultSet[j]=true;}}}else{for(var j in resultSet){if(!controlMatrix.selectedIdx[controlMatrix.map[j]]){delete resultSet[j];}}}}}}if(hasOnlyIfwTarget){for(key in this.ctlMatrix){var obj=this.ctlMatrix[key];obj.selectedIdx={};}}if(hasOnlyIfwTarget||isAllSelected||!resultSet||Object.keys(resultSet).length!==1){}else{console.log("xiawang: The selected row is:"+JSON.stringify(resultSet));var selectedRow=parseInt(Object.keys(resultSet)[0]);this.prevSelected={mrow:selectedRow,mcol:-1};if(this.rows[selectedRow]){this.rows[selectedRow].selected[-1]=true;}for(key in this.ctlMatrix){var obj=this.ctlMatrix[key];obj.selectedIdx={};}}}else{var hasOnlyIfwTarget=true;for(key in this.ctlMatrix){var controlMatrix=this.ctlMatrix[key];var checkThisAttr=false;for(var sIdx in controlMatrix.selectedIdx){checkThisAttr=true;}if(checkThisAttr&&!this.hasInfoWOnNode(controlMatrix,true)){hasOnlyIfwTarget=false;break;}}if(hasOnlyIfwTarget){for(key in this.ctlMatrix){var obj=this.ctlMatrix[key];obj.selectedIdx={};}}}}else{if(this.currSelectedObj&&this.currSelectedObj.length<=0){var resultSet=null,controlMatrix=null;this.currSelectedObj=[];var findTreeNodeByAttrElemIdx=function(treeNodeList,attrElemIdx){var treeNodeCount=treeNodeList.length;for(var i=0;i<treeNodeCount;i++){var treeNode=treeNodeList[i];if(treeNode.attrElemIdx==attrElemIdx){return treeNode;}}return null;};var me=this;var findCurrSelectedObjByAttrElemIdx=function(tree,level){var id=me.attrIDArray[level];controlMatrix=me.ctlMatrix[id];var treeNodeList=tree.childrenTreeNodeList;var treeNodeCount=treeNodeList.length;if(treeNodeCount<=0){return ;}var treeNode=null;if(controlMatrix){for(var key in controlMatrix.selectedIdx){treeNode=findTreeNodeByAttrElemIdx(treeNodeList,key);}if(treeNode){me.currSelectedObj[level]=treeNode;findCurrSelectedObjByAttrElemIdx(treeNode,level+1);return true;}}else{me.currSelectedObj[level]=null;for(var i=0;i<treeNodeCount;i++){var find=findCurrSelectedObjByAttrElemIdx(treeNodeList[i],level+1);if(find){return true;}}}return false;};findCurrSelectedObjByAttrElemIdx(this.tree,0);while(this.currSelectedObj.length>0&&!this.currSelectedObj[this.currSelectedObj.length-1]){this.currSelectedObj.pop();}var hasOnlyIfwTarget=true;for(var i=0;i<this.currSelectedObj.length;i++){var treeNode=this.currSelectedObj[i];if(treeNode){var attrIdx=attrIdxArray[i];rowH=rows[attrIdx];if(!this.hasInfoWOnNode(rowH,true)){hasOnlyIfwTarget=false;break;}}else{continue;}}if(hasOnlyIfwTarget){this.currSelectedObj=[];}this.lastSelectedObj=$HASH.clone(this.currSelectedObj);return ;}}},updateSelectedStatus:function updateSS(tree){if(this.isTreeMode){this.updateTreeSelection(tree);}else{if(!this.isAllAttrSelectable||this.unselectedRemainCells.length>0){if(!this.ctlMatrix){return ;}var update=function(key){var pureId=key.split(":")[0],ctlMatrix=this.ctlMatrix[pureId],ctlMatrixCG=this.ctlMatrix[pureId+":CG"];var colInfos=this.colInfos,selectedIdx=ctlMatrix.selectedIdx,colIdx=ctlMatrix.colIdx;if(ctlMatrixCG&&!ctlMatrixCG.selectedIdx[-1]){ctlMatrix=ctlMatrixCG;}var map=ctlMatrix.map,rows=this.rows,rowCount=rows.length,selectedIdx=ctlMatrix.selectedIdx,colIdx=this.ctlMatrix[key].colIdx,assAttr=colInfos[colIdx].associateAttr;for(var i=0;i<rowCount;i++){var rowInfo=rows[i];if(selectedIdx[map[i]]){rowInfo.selected[colIdx]=true;for(var idx in assAttr){rowInfo.selected[assAttr[idx]]=true;}}else{rowInfo.selected[colIdx]=false;for(var idx in assAttr){rowInfo.selected[assAttr[idx]]=false;}}}};for(var key in this.ctlMatrix){update.call(this,key);}}}},hasOnlyInfoWindowTarget:function hasOnlyInfoWindowTarget(){},performAction:function performAction(actionObjList){this.hasNonifwTarget=this.hasNoninfowindowTarget(actionObjList[0]);if(this._super){this._super(actionObjList);}},clearPreHighlightRowStatus:function clearPreHighlightRowStatus(pass){var mrow=this.prevSelected.mrow,mcol=this.prevSelected.mcol;if(mrow==-2){return ;}if(mcol==-1){this.rows[mrow].selected[-1]=false;}else{if(mrow==-1){for(var i=0;i<this.colInfos.length;i++){var colInfo=this.colInfos[i];if(colInfo.selected){colInfo.selected=false;}}}else{this.rows[mrow].selected[mcol]=false;}}},updateUnselectedRemainCells:function uurc(tappedCell){var hasTapRemainCell=false;for(var i=this.unselectedRemainCells.length-1;i>=0;i--){cell=this.unselectedRemainCells[i];var id=order[cell.mcol];var isCG=false;if(id.indexOf(":CG")===id.length-3&&id.length>=3){isCG=true;}else{id=id.split(":")[0];}var obj=this.ctlMatrix[id];var anotherObj=undefined;if(isCG){anotherObj=this.ctlMatrix[id.split(":")[0]];}else{anotherObj=this.ctlMatrix[id+":CG"];}if(obj.sc&&obj.sc.tks!=""){if(anotherObj&&!anotherObj.sc){anotherObj=undefined;}var selectedIdx=obj.map[cell.mrow];elementId=obj.es[selectedIdx].id;if(!elementId||elementId.substring(0,1)==="D"){continue;}else{if(obj.selectedIdx[selectedIdx]){if(tappedCell){if(cell.mcol==tappedCell.mcol){var tappedID=order[cell.mcol].split(":")[0];var tappedCtlMatrix=this.ctlMatrix[tappedID];var tappedIdx=tappedCtlMatrix.sc&&tappedCtlMatrix.map[tappedCell.mrow];if(tappedIdx==selectedIdx){hasTapRemainCell=true;}}continue;}obj.selectedIdx={};}else{obj.selectedIdx={};obj.selectedIdx[selectedIdx]=true;if(anotherObj){if(elementId.indexOf("BE")===0||elementId.indexOf("Z")===0){}else{anotherObj.selectedIdx={};anotherObj.selectedIdx[selectedIdx]=true;}}}}}}return hasTapRemainCell;},highlightCellsByRowInfo:function highlightCellsByRowInfo(rowInfo){var rowRef=rowInfo.rowRef;if(!rowRef){return ;}var trL=rowRef[LEFT_CHART_ROW];var trR=rowRef[RIGHT_CHART_ROW];var tdsL=trL&&trL.childNodes;var tdsR=trR&&trR.childNodes;var tdsLLen=tdsL&&tdsL.length||0,tdsRLen=tdsR&&tdsR.length||0;var colCount=tdsLLen+tdsRLen;for(var i=0;i<colCount;i++){var td=i<tdsLLen?tdsL[i]:tdsR[i-tdsLLen];if(rowInfo.selected[i]){this.highlightCell(td);}else{this.unHighlightCell(td);}}},setSelectedStyle:function setSelectedStyle(level){if(level==0){this.selectedStyle="background-color:#015DE6;color:#FFFFFF;";}else{if(level==1){this.selectedStyle="background-color:rgba(1,93,230, 0.7);color:#FFFFFF;";}else{this.selectedStyle="background-color:rgba(1,93,230, 0.5);color:#FFFFFF;";}}},highlightTreeArrow:function highlightTreeArrow(rowInfo){if(this.treeColumnIdx>-1&&this._leftChart){this._leftChart.setTreeArrow(rowInfo,"white");}},unHighlightTreeArrow:function unHighlightTreeArrow(rowInfo){if(this.treeColumnIdx>-1&&this._leftChart){this._leftChart.setTreeArrow(rowInfo);}},highlightCell:function highlightCell(td,isHeaderTable){if(isHeaderTable){setNodeCssText(td,TH_SELECTED_CSS+this.selectedStyle);}else{setNodeCssText(td,TD_SELECTED_CSS+this.selectedStyle);}if(this.selectedClass&&this.selectedClass.length>0){$CSS.addClass(td,this.selectedClass);}},unHighlightCell:function unHighlightCell(td,isHeaderTable){if(isHeaderTable){setNodeCssText(td,DEFAULT_TH_CSS);}else{setNodeCssText(td,DEFAULT_TD_CSS);}if(this.selectedClass&&this.selectedClass.length>0){$CSS.removeClass(td,this.selectedClass);}},highlightForLD:function highlightForLD(mrow,mcol,node){if(this.highlightEntireRow&&!this.isTreeMode){this.highlightRowByRowInfo(this.rows[mrow]);}else{if(node){this.highlightCell(node);}var colInfo=this.colInfos[mcol],aAttr=colInfo.associateAttr;var siblings=node.parentNode.childNodes;for(var idx in aAttr){this.highlightCell(siblings[aAttr[idx]]);if(this.treeColumnIdx==idx){this.highlightTreeArrow(this.rows[mrow]);}}}},highlightRowByRowInfo:function highlightRowByRowInfo(rowInfo){var rowRef=rowInfo.rowRef;if(!rowRef){return ;}var level=rowInfo.treeNode?rowInfo.treeNode.level:0;this.setSelectedStyle(level);if(rowRef[LEFT_CHART_ROW]){this.highlightRow(rowRef[LEFT_CHART_ROW]);}if(rowRef[RIGHT_CHART_ROW]){this.highlightRow(rowRef[RIGHT_CHART_ROW]);}this.highlightTreeArrow(rowInfo);},highlightRow:function highlightRow(tr){var tds=tr.childNodes;for(var i=0;i<tds.length;i++){setNodeCssText(tds[i],TD_SELECTED_CSS+this.selectedStyle);if(this.selectedClass&&this.selectedClass.length>0){$CSS.addClass(tds[i],this.selectedClass);}}},unHighlightRowByRowInfo:function unHighlightRowByRowInfo(rowInfo){var rowRef=rowInfo.rowRef;if(!rowRef){return ;}if(rowRef[LEFT_CHART_ROW]){this.unHighlightRow(rowRef[LEFT_CHART_ROW]);}if(rowRef[RIGHT_CHART_ROW]){this.unHighlightRow(rowRef[RIGHT_CHART_ROW]);}this.unHighlightTreeArrow(rowInfo);},unHighlightRow:function unHighlightRow(tr){var tds=tr.childNodes;for(var i=0;i<tds.length;i++){setNodeCssText(tds[i],DEFAULT_TD_CSS);if(this.selectedClass&&this.selectedClass.length>0){$CSS.removeClass(tds[i],this.selectedClass);}}},isAttrSelectable:function isAttrSelectable(treeLevel){var attrID=this.attrIDArray[treeLevel];var ctlMatrix=this.ctlMatrix[attrID];if(ctlMatrix){return true;}return false;},updateTreeSelection:function updateTreeSelection(tree){this.selectOrClearTreeNodes(tree,true,0);this.selectOrClearTreeNodes(tree,false,0);},findTheTreeNodeWithSameID:function findTheTreeNodeWithSameID(treeNodeList,id){var treeNodeCount=treeNodeList.length;for(var i=0;i<treeNodeCount;i++){var treeNode=treeNodeList[i];if(treeNode.id==id){return treeNode;}}return null;},selectOrClearTreeNodes:function selectOrClearTreeNodes(treeNode,clear,treeLevel){if(!treeNode){return ;}if(clear&&this.lastSelectedObj.length<=treeLevel){return ;}if(!clear&&this.currSelectedObj.length<=treeLevel){return ;}var tappedTreeNode=null;if(clear){tappedTreeNode=this.lastSelectedObj[treeLevel];}else{tappedTreeNode=this.currSelectedObj[treeLevel];}var treeNodeList=treeNode.childrenTreeNodeList,treeNodeCount=treeNodeList.length;if(tappedTreeNode){treeNode=this.findTheTreeNodeWithSameID(treeNodeList,tappedTreeNode.id);if(treeNode){treeNode.selected=clear?false:true;this.selectOrClearTreeNodes(treeNode,clear,treeLevel+1);}}else{for(var i=0;i<treeNodeCount;i++){this.selectOrClearTreeNodes(treeNodeList[i],clear,treeLevel+1);}}},updateHighlightForCurrRenderRows:function updateHighlightForCurrRenderRows(){var rows=this.rows;var rowCount=rows.length,rowInfo=null;for(var i=this.startCnt;i<this.endCnt;i++){rowInfo=rows[i];if(this.isTreeMode){if(rowInfo.treeNode.selected){this.highlightRowByRowInfo(rowInfo);}else{this.unHighlightRowByRowInfo(rowInfo);}}else{if(this.isAllAttrSelectable){if(rowInfo.selected[-1]){this.highlightRowByRowInfo(rowInfo);}else{this.unHighlightRowByRowInfo(rowInfo);}}else{this.highlightCellsByRowInfo(rowInfo);}if(this.unselectedRemainCells.length>0){this.highlightCellsByRowInfo(rowInfo);}}}if(this.isTreeMode){rows=this.dockedHeaderRows;rowCount=rows.length;for(var i=0;i<rowCount;i++){rowInfo=rows[i];if(rowInfo.treeNode.selected){this.highlightRowByRowInfo(rowInfo);}else{this.unHighlightRowByRowInfo(rowInfo);}}rows=this.dockedHeaderReplaceRows;rowCount=rows.length;for(var i=0;i<rowCount;i++){rowInfo=rows[i];if(rowInfo.treeNode.selected){this.highlightRowByRowInfo(rowInfo);}else{this.unHighlightRowByRowInfo(rowInfo);}}}},getSelectedTreeNodeListFromTreePath:function getSelectedTreeNodeListFromTreePath(treePathArray){if(!treePathArray){return[];}var treeNodeList=[];var treeNode=this.tree;for(var i=0;i<treePathArray.length;i++){var treeNodeIdx=treePathArray[i];treeNode=treeNode.childrenTreeNodeList[treeNodeIdx];if(!treeNode){break;}if(this.isAttrSelectable(i)){treeNodeList[i]=treeNode;}else{treeNodeList[i]=null;}}return treeNodeList;},multiTap:true,touchTap:function(touch){var widget=this;if(widget.tooltip.style.display==="block"){hideTooltipGlobal.call(this);return ;}var td=mstrmojo.dom.findAncestorByAttr(touch.target,"mcol",true,this.domNode);if(!td){this._leftChart.dockedHeaderReplaceDiv.style.display="none";touch.target=document.elementFromPoint(touch.pageX,touch.pageY);td=mstrmojo.dom.findAncestorByAttr(touch.target,"mcol",true,this.domNode);this._leftChart.dockedHeaderReplaceDiv.style.display="";}if(td&&td.node){var mrow=parseInt(td.node.getAttribute("mrow"));var mcol=parseInt(td.node.getAttribute("mcol"));if(mrow==-1){return ;}if(this.isTreeMode){if(mrow>=0){var rowInfo=this.rows[mrow];var treeNode=rowInfo&&rowInfo.treeNode;if(touch.count==2||(touch.count==1&&mcol==this.treeColumnIdx)){if(!treeNode.isLeaf){this.rowsNeedRebuild=true;var rowType=td.node.parentNode.getAttribute("rowType");if(treeNode.needExpand){collapseTreeNodeAndSetScrlPos.call(this,rowInfo,rowType);}else{expandTreeNodeAndSetScrlPos.call(this,rowInfo,rowType);}}return ;}}var touchedObj={node:td.node,treeNode:treeNode,mcol:mcol,mrow:mrow};var actionObjList=this.getActionObj(touchedObj);var actionObj=actionObjList&&actionObjList[0];if(actionObj){if(actionObj.at&SELECTOR_ACTION){var doHighlight=!(this.isAndroidPhone&&actionObj.anchor);if(doHighlight){this.updateSelectedStatus(this.tree);this.updateHighlightForCurrRenderRows();this.lastSelectedObj=$HASH.clone(this.currSelectedObj);}}else{if(actionObj.at&HYPERLINK_ACTION){this.highlightForLD(mrow,mcol,td.node);}}this.performAction(actionObjList);return ;}}else{var actionObjList=this.getActionObj({mcol:mcol,mrow:mrow,node:td.node});var actionObj=actionObjList&&actionObjList[0];if(actionObj){if(actionObj.at&SELECTOR_ACTION){var doHighlight=!(this.isAndroidPhone&&actionObj.anchor);if(doHighlight){this.updateSelectedStatus();this.updateHighlightForCurrRenderRows();}}else{if(actionObj.at&HYPERLINK_ACTION){this.highlightForLD(mrow,mcol,td.node);}}this.performAction(actionObjList);return ;}}var me=this;var tr=td.node.parentNode;var rowInfo=null;if(tr.getAttribute("rowType")==DOCKED_HEADER){var dockedHeaderIdx=getIdxByRowIdx(this.dockedHeaderRows,mrow);if(dockedHeaderIdx>=0){rowInfo=this.dockedHeaderRows[dockedHeaderIdx];}else{dockedHeaderIdx=getIdxByRowIdx(this.dockedHeaderReplaceRows,mrow);rowInfo=this.dockedHeaderReplaceRows[dockedHeaderIdx];}}else{rowInfo=this.rows[mrow];}var touchedChart=rowInfo&&rowInfo.rowRef&&rowInfo.rowRef[mcol];if(touchedChart){this.showChartTooltip(touchedChart,touch);}}},shouldTouchBubble:function shouldTouchBubble(touch){var isVertical=touch.isVertical;return isVertical?this._super(touch):this.enableSmoothScroll&&isScrollableElementTouched.call(this,touch)?false:true;},multiTouch:true,touchMultiBegin:function(touch){hideTooltipGlobal.call(this);this.initTouchObj=touch;var touch1;var touch2;if(touch.evt.touches&&touch.evt.touches.length==2){touch1=touch.evt.touches[0];touch2=touch.evt.touches[1];}else{touch1=touch;touch2={pageX:100,pageY:100,target:touch.target};}var xDiff=touch1.pageX-touch2.pageX;var yDiff=touch1.pageY-touch2.pageY;this.initDiffDiff=xDiff*xDiff+yDiff*yDiff;this.relScaleFactor=1;var td1=mstrmojo.dom.findAncestorByAttr(touch1.target,"mrow",true,this.domNode);var td2=mstrmojo.dom.findAncestorByAttr(touch2.target,"mrow",true,this.domNode);if(td1&&td1.value&&td2&&td2.value){this.centerRowIdx=Math.round((parseInt(td1.value)+parseInt(td2.value))/2);}else{this.centerRowIdx=this.firstRowIdxOnScrn;}},touchMultiMove:function(touch){var touch1;var touch2;if(touch.evt.touches&&touch.evt.touches.length==2){touch1=touch.evt.touches[0];touch2=touch.evt.touches[1];}else{touch1=touch;touch2={pageX:100,pageY:100};}var xDiff=touch1.pageX-touch2.pageX;var yDiff=touch1.pageY-touch2.pageY;this.curDiffDiff=xDiff*xDiff+yDiff*yDiff;},touchMultiEnd:function(touch){if(this.isTreeMode){if(this.curDiffDiff>this.initDiffDiff){this.onPinchOpen();}else{if(this.curDiffDiff<this.initDiffDiff){this.onPinchClose();}}}},onPinchOpen:function onPinchOpen(){var currLowestLevel=getLowestLevelOnScreen.call(this);var levelToExpand=currLowestLevel;if(levelToExpand>=this.maxTreeLevel){levelToExpand=this.maxTreeLevel-1;}var anchorRowTreeNode=this.rows[this.centerRowIdx].treeNode;var anchorRowIdxOnScrn=this.centerRowIdx-this.firstRowIdxOnScrn;expandOrCollapseTreeAndSetScrlPos.call(this,levelToExpand,anchorRowTreeNode,anchorRowIdxOnScrn);},onPinchClose:function onPinchClose(){var currLowestLevel=getLowestLevelOnScreen.call(this);var levelToExpand=currLowestLevel-2;if(levelToExpand<-1){levelToExpand=-1;}var anchorRowTreeNode=this.rows[this.centerRowIdx].treeNode;if(anchorRowTreeNode.level>levelToExpand+1){anchorRowTreeNode=getParentTreeNodeAtLevel(this.tree,anchorRowTreeNode.treePath,levelToExpand+1);}var anchorRowIdxOnScrn=this.centerRowIdx-this.firstRowIdxOnScrn;expandOrCollapseTreeAndSetScrlPos.call(this,levelToExpand,anchorRowTreeNode,anchorRowIdxOnScrn);},destroyChartWidget:function destroyChartWidget(){if(this.rows&&this.rows.length>0&&this.rowsReusePool){this.pushToReusePool();}if(this.dockedHeaderRows&&this.dockedHeaderReplaceRows){this.clearDockedHeader();}if(this.rowsReusePool&&this.rowsReusePool.length>0){var rows=this.rowsReusePool,rowCount=rows.length,colInfos=this.colInfos,colCount=colInfos.length;for(var i=0;i<rowCount;i++){var rowRef=rows[i];if(rowRef[LEFT_CHART_ROW]){delete rowRef[LEFT_CHART_ROW];}if(rowRef[RIGHT_CHART_ROW]){delete rowRef[RIGHT_CHART_ROW];}for(var j=0;j<colCount;j++){var w=rowRef[colInfos[j].colIdx];if(w&&w.destroy){w.destroy();delete rowRef[colInfos[j].colIdx];}}}this.rowsReusePool=[];}},destroy:function destroy(){console.log("in destroy");var listener=this._touchListener;if(listener){mstrmojo.touchManager.detachEventListener(listener);delete this._touchListener;}if(this._infoWClosedListener){mstrmojo.touchManager.detachEventListener(this._infoWClosedListener);delete this._infoWClosedListener;}this.destroyChartWidget();if(this._leftChart){this._leftChart.destroy();delete this._leftChart;}if(this._rightChart){this._rightChart.destroy();delete this._rightChart;}if(this.rows){delete this.rows;}if(this.rowsReusePool){delete this.rowsReusePool;}if(this.selectorTargets){delete this.selectorTargets;}this._super();}});})();