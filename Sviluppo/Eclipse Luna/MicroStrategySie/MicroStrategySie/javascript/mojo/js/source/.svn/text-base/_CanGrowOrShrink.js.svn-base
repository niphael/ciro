(function(){mstrmojo.requiresCls("mstrmojo.dom");var $DOM=mstrmojo.dom;var CGS_HEIGHT=1,CGS_WIDTH=2;function canGrowOrShrink(children){var defn=this.defn,verticalConfig=defn.vc,horizontalConfig=defn.hc;if(!children||children.length===0||(!verticalConfig&&!horizontalConfig)){return{};}return{v:!!verticalConfig,h:!!horizontalConfig};}function getInitialSize(mode){return parseInt(this.getFormats()[(mode===CGS_HEIGHT)?"height":"width"],10);}function getMaxSize(mode){var maxProperty=this.getFormats()["max-"+((mode===CGS_HEIGHT)?"height":"width")];return maxProperty&&parseInt(maxProperty,10);}function getDynamicChildDomNode(child,mode){var defn=this.defn,childDomNode=child&&(child.dimNode||child.domNode),dynamicChild=defn.ck&&defn.ck[child&&(child.k||child.content.k)];if(childDomNode&&dynamicChild&&(dynamicChild&mode)){return childDomNode;}return null;}function getChildEndPoint(child,mode,domNode,size){var start=parseInt(domNode.style[(mode===CGS_HEIGHT)?"top":"left"],10);if(!!size){return start+size;}var fx=(child.fmts&&child.fmts.fx)||{},rotatedMode=(!$DOM.isIE7&&(fx.rt===1||fx.rt===3))?((mode===CGS_HEIGHT)?CGS_WIDTH:CGS_HEIGHT):mode,rotatedUCProperty=(rotatedMode===CGS_HEIGHT)?"Height":"Width";size=domNode["offset"+rotatedUCProperty]+(fx.ds||0);var endPoint=start+size;if($DOM.isIE7&&rotatedUCProperty==="Width"&&child instanceof mstrmojo.XtabBase){var childWidth=child.contentNode.offsetWidth;if(endPoint<childWidth){endPoint+=childWidth;}}return endPoint;}function updateCalculatedSize(endPoint,calculatedSize,maxSize){if(endPoint>calculatedSize){if(maxSize){endPoint=Math.min(endPoint,maxSize);}return endPoint;}return calculatedSize;}function updateContainerSize(mode,calculatedSize,dontShrink){var containerNode=this.getCanGrowShrinkNode(),propertyName=(mode===CGS_HEIGHT)?"Height":"Width",lcPropertyName=propertyName.toLowerCase(),currentValue=parseInt(containerNode.style[lcPropertyName],10);if(calculatedSize&&calculatedSize!==currentValue&&!(calculatedSize<currentValue&&!!dontShrink)){currentValue=calculatedSize;containerNode.style[lcPropertyName]=currentValue+"px";this.afterCanGrowShrink();}this["_fixed"+propertyName]=currentValue;}function calculateSize(ctrls,mode,dontShrink){var maxSize=getMaxSize.call(this,mode),calculatedSize=getInitialSize.call(this,mode),len=ctrls.length,i;for(i=0;i<len;i++){var child=ctrls[i],childDomNode=getDynamicChildDomNode.call(this,child,mode);if(!childDomNode){continue;}calculatedSize=updateCalculatedSize(getChildEndPoint.call(this,child,mode,childDomNode),calculatedSize,maxSize);if(calculatedSize===maxSize){break;}}updateContainerSize.call(this,mode,calculatedSize,dontShrink);}function calculateFixedSize(child,mode,size,dontShrink){var childDomNode=getDynamicChildDomNode.call(this,child,mode);if(!childDomNode){return ;}var endPoint=getChildEndPoint.call(this,child,mode,childDomNode,size);updateContainerSize.call(this,mode,updateCalculatedSize(endPoint,getInitialSize.call(this,mode),getMaxSize.call(this,mode)),dontShrink);}mstrmojo._CanGrowOrShrink=mstrmojo.provide("mstrmojo._CanGrowOrShrink",{getCanGrowShrinkNode:function getCanGrowShrinkNode(){return this.domNode;},performCanGrowCanShrink:function performCanGrowCanShrink(ch,dontShrink){var config=canGrowOrShrink.call(this,ch);if(config.v){calculateSize.call(this,ch,CGS_HEIGHT,dontShrink);}if(config.h){calculateSize.call(this,ch,CGS_WIDTH,dontShrink);}},fixedSizeCanGrowShrink:function fixedSizeCanGrowShrink(child,height,width,dontShrink){var config=canGrowOrShrink.call(this,child&&[child]);height=parseInt(height,10);width=parseInt(width,10);if(config.v&&!isNaN(height)){calculateFixedSize.call(this,child,CGS_HEIGHT,height,dontShrink);}if(config.h&&!isNaN(width)){calculateFixedSize.call(this,child,CGS_WIDTH,width,dontShrink);}},afterCanGrowShrink:mstrmojo.emptyFn});}());