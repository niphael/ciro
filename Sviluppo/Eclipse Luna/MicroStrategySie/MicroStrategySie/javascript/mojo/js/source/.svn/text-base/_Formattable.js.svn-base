(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var commonProps={T:["top","left"],D:["height","width"],B:["border","border-color","border-style","border-width"],F:["font","color","text-decoration"],P:["padding"]};commonProps.RW=["z-index"].concat(commonProps.T.concat(commonProps.D));var $D=mstrmojo.dom;function pushFxProperty(fx,n,v){var p=fx[n]||[];p.push(v);fx[n]=p;}mstrmojo._Formattable={_mixinName:"mstrmojo._Formattable",formatHandlers:null,getCacheKey:function getCacheKey(w){return"csscache"+(w.thresholdId||"");},update:function update(node){this.invisible=!!(node&&node.data&&node.data.invisible);if(this._super){this._super(node);}},preBuildRendering:function preBuildRendering(){if(this._super){this._super();}var defn=this.defn;if(!defn){defn=this.defn={};}var cacheKey=this.getCacheKey(this),cache=defn[cacheKey];if(!cache){cache=defn[cacheKey]={};var fmts=this.getFormats();if(fmts){var fhs=this.formatHandlers;for(var slot in fhs){var handle=fhs[slot];var src=handle.src?fmts[handle.src]:fmts;if(!src){return ;}var css=[];var x=-1;var slotCss=slot+"CssText";var props=handle.props||handle;if(!props){continue;}for(var bp=props.length-1;bp>=0;bp--){var p=props[bp];var c=commonProps[p]||[p];for(var z=c.length-1;z>=0;z--){p=c[z];if(p in src){if(p==="fx"){var f=src[p],fx={};if("gd" in f){this.formatGradient(f.gd,fx);}if("rt" in f){if(f.rt==1||f.rt==3){this.formatTextRotation(f.rt,fx);}}if("ds" in f){this.formatDropShadow(f,fx);}for(var fp in fx){css[++x]=fp+":"+fx[fp].join(" ");}}else{css[++x]=p+":"+src[p];}}}}if(this.invisible){css.push("visibility:hidden");}this[slotCss]=cache[slotCss]=css.join(";")+";";}}}else{for(var n in cache){this[n]=cache[n];}}return true;},formatGradient:function formatGradient(gp,fx){var gd=mstrmojo.css.buildGradient(gp.t,gp.sc,gp.ec);if(gd){pushFxProperty(fx,gd.n,gd.v);}},formatDropShadow:function formatDropShadow(f,fx){if($D.supports($D.cssFeatures.DROP_SHADOW)){var ds=f.ds;if($D.isDXIE){pushFxProperty(fx,"filter","progid:DXImageTransform.Microsoft.DropShadow(Color='#66000000',Positive='true',OffX="+ds+",OffY="+ds+")");}else{var v=[ds,ds];if(f.rt==1||f.rt==3){v[((f.rt===1)?1:0)]=-ds;}pushFxProperty(fx,($D.isWK?"-webkit-":"")+"box-shadow",v.join("px ")+"px 3px 0px #888");}}},formatTextRotation:function formatTextRotation(tr,fx){if($D.supports($D.cssFeatures.TEXT_ROTATION)){if($D.isDXIE){pushFxProperty(fx,"filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+tr+")");}else{var degrees=(tr===1)?90:-90;pushFxProperty(fx,$D.CSS3_PREFIX+"transform-origin","top left");pushFxProperty(fx,$D.CSS3_PREFIX+"transform","rotate("+degrees+"deg)");}}},getFormats:function getFormats(){if(!this.fmts){this.fmts=this.formatResolver.getFormat(this.defn,this.thresholdId);}return this.fmts;},clearCache:function clearCache(){delete this.defn[this.getCacheKey(this)];},unrender:function unrender(ignoreDom){if(this.thresholdId){this.fmts=null;}this._super(ignoreDom);}};mstrmojo._Formattable.getBorderWidths=function(w){var f=w.getFormats(),b=("border" in f)?f.border.match(/(\d*|\d*\.\d*)pt/)[0]:f["border-width"],dpi=w.model.docModel?w.model.docModel.dpi:w.model.dpi;return mstrmojo.css.getBorderWidths(b,dpi);};})();