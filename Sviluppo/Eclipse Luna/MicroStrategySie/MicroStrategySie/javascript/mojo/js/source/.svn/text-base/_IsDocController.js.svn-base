(function(){mstrmojo.requiresCls("mstrmojo.EnumReadystate");var $RS=mstrmojo.EnumReadystate;function getViewKey(view){return(view.getKey&&view.getKey())||view.k;}mstrmojo._IsDocController={_mixinName:"mstrmojo._IsDocController",_getXtabCallback:function(xtab){var targetDefinitions={},defn=targetDefinitions[getViewKey(xtab)]=xtab.defn,me=this,model=me.model;return model.newCallback({submission:function(){if(defn.set){defn.set("readyState",$RS.WAITING);}},success:function(res){if(res.pukeys){targetDefinitions=model.getUnitDefinitions(res.pukeys);}model.partialUpdate(res.data,targetDefinitions);},failure:function(details){mstrmojo.alert(details.code+": "+details.message);},complete:function(){if(defn.set){defn.set("readyState",$RS.IDLE);}me.docRequestComplete();}});},_addNodeKeyToAction:function(view,action){action.nodeKey=getViewKey(view);return action;},onGridSelector:function(view,action){var m=this.model,ifws=m.getTargetInfoWin(action.tks);if(ifws&&ifws.length){for(var i=0;i<ifws.length;i++){m.showInfoWin(ifws[i],action.anchor,"h",true);}}action.sid=view.sid;m.slice(action);},onVisSelector:function(view,action){if(action.anchor){var m=this.model,ifws=m.getTargetInfoWin(action.tks);if(ifws&&ifws.length){m.showInfoWin(ifws[0],action.anchor,"h",true);}}if(view.xtabModel&&view.xtabModel.docModel&&view.xtabModel.docModel.slice){view.xtabModel.docModel.slice(action);}},isInRequest:function isInRequest(){var inProcess=!!this._inProcess;if(!inProcess){this._inProcess=true;}return inProcess;},docRequestComplete:function docRequestComplete(){this._inProcess=false;},nudgeWidget:mstrmojo.emptyFn,getGroupByElements:function getGroupByElements(w){var gbelems=[],keys;while(w){var keys=w.node&&w.node.data&&w.node.data.pbes;if(keys){break;}w=w.parent;}if(keys){var dataElems=this.model.data.elems;for(var i=0,len=keys.length;i<len;i++){var idx=keys[i];gbelems.push(isNaN(idx)?idx:dataElems&&dataElems[idx]);}}return gbelems;}};}());