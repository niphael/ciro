(function(){mstrmojo.requiresCls("mstrmojo.Model");var _D=mstrmojo.dom;var DRILLING_ACTION=1,SELECTOR_ACTION=2,HYPERLINK_ACTION=4,SORT_ACTION=8,PIVOT_ACTION=16;function _toolTipText(xtab,td){var cell=xtab.getCellForNode(td),at=cell&&cell.at,defAction=0;if(at){defAction=(at&SELECTOR_ACTION)||(at&HYPERLINK_ACTION)||(at&DRILLING_ACTION);}if(defAction===HYPERLINK_ACTION){var lInf=xtab.model.getCellLinksInfo(cell);if(isNaN(lInf.di)){return"";}var item=lInf.links[lInf.di];return item.n;}if(defAction===DRILLING_ACTION){return(mstrmojo.desc(183,"Drill to")+" "+xtab.model.getCellDrillsInfo(cell).n);}if(cell){var e=("mix" in cell)?cell._e:cell;if(e&&e.desc){return e.desc;}}return xtab.tooltip||"";}function _shouldShowPopupInner(xtab,td){var cell=xtab.getCellForNode(td),at=cell&&cell.at;if(at&SORT_ACTION||at&PIVOT_ACTION){return true;}var actCount=0;if(at&DRILLING_ACTION){actCount++;}if(at&HYPERLINK_ACTION){actCount++;}if(at&SELECTOR_ACTION){actCount++;}if(actCount>1){return true;}if(at&HYPERLINK_ACTION){var lInf=xtab.model.getCellLinksInfo(cell),links=lInf&&lInf.links;var len=(links&&links.length)||0;if(lInf&&!isNaN(lInf.di)){len--;}if(len>0){return true;}}else{return false;}}function _shouldShowPopup(xtab,td){var b=td.mstrShowPopup;if(b!==undefined){return b;}b=_shouldShowPopupInner(xtab,td);td.mstrShowPopup=b;return b;}function _canShowPopup(xtab,td){if(td&&_shouldShowPopup(xtab,td)){if(!xtab.openPopup){xtab.requiresCls(["mstrmojo._HasPopup"]);}return true;}return false;}function _targetTd(e,hWin,xtab,target){var t=target||_D.eventTarget(hWin,e);return t&&_D.findAncestorByName(t,"td",true,xtab.viewport);}function _getPageLimit(xtab){return xtab.lockHeadersCase<2?xtab.viewport.clientWidth-(xtab.scrollboxNode.offsetWidth-xtab.scrollboxNode.clientWidth):(parseInt(xtab.getFormats().width,10)||xtab.viewport.clientWidth);}mstrmojo._XtabCellHoverMgr=mstrmojo.declare(mstrmojo.Model,null,{scriptClass:"mstrmojo._XtabCellHoverMgr",parent:null,td:null,audibles:{"*":false},startup:function startup(){var xtab=this.parent;if(xtab&&xtab.getCellForNode){var id=this.id,fCtxMenu=this.fCtxMenu=function(e){mstrmojo.all[id].oncontextmenu(e,self);},fOver=this.fOver=function(e){mstrmojo.all[id].onhover(e,self);},fOut=this.fOut=function(e){mstrmojo.all[id].onunhover(e,self);},zs=xtab.zones,z;for(z in zs){var el=zs[z].tableNode;if(el){_D.attachEvent(el,"mouseover",fOver);_D.attachEvent(el,"mouseout",fOut);_D.attachEvent(el,"contextmenu",fCtxMenu);}}if(!this._sub_ihc){this._sub_ihc=xtab.attachEventListener("ignoreHoverChange",this.id,"onChangeIgnoreHover");}window.setTimeout(function(){xtab._pl=_getPageLimit(xtab);},0);}},shutdown:function shtdwn(){var zs=this.parent&&this.parent.zones,z;for(z in zs){var el=zs[z].tableNode;if(el){_D.detachEvent(el,"mouseover",this.fOver);_D.detachEvent(el,"mouseout",this.fOut);_D.detachEvent(el,"contextmenu",this.fCtxMenu);}}},onXtabWidthChanged:function(){var xtab=this.parent;xtab._pl=_getPageLimit(xtab);},onChangeIgnoreHover:function(){var xtab=this.parent;if(!xtab.ignoreHover&&this._ignored){this.onhover(null,null,this._ignored);}},onhover:function hvr(e,hWin,target){if(this.parent.ignoreHover){this._ignored=_D.eventTarget(hWin,e);return ;}var xtab=this.parent,td=_targetTd(e,hWin,xtab,target);if(td&&xtab){td.title=_toolTipText(xtab,td);}if(_canShowPopup(xtab,td)){this.td=td;if(!xtab._pl){xtab._pl=_getPageLimit(xtab);}xtab.openPopup("cellHoverPopupRef",{xtab:xtab,td:td});}else{this.onunhover(e,hWin,target);}},onunhover:function unhvr(e,hWin,target){if(this.parent.ignoreHover){return ;}var xtab=this.parent,p=xtab._lastOpened;if(!p){return ;}if(p.autoCloses){p.autoClose();}else{xtab.closePopup();}},oncontextmenu:function hvr(e,hWin,target){var xtab=this.parent,td=_targetTd(e,hWin,xtab,target);if(_canShowPopup(xtab,td)){xtab.openPopup("cellHoverPopupRef",{xtab:xtab,td:td,cmPos:_D.getMousePosition(e,hWin)});xtab.cellHoverPopupRef.btn.openPopup();xtab.closePopup();_D.preventDefault(hWin,e);}}});}());