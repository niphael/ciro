(function(){mstrmojo.requiresCls("mstrmojo.DocLayoutViewer","mstrmojo.DocGroupBy","mstrmojo.Xtab","mstrmojo.IncFetch","mstrmojo.DocPanelStack","mstrmojo.express.ui.DocButton","mstrmojo.ExpressDocPanel","mstrmojo._IsEditableXtab","mstrmojo._CanSupportTransaction","mstrmojo.ExpressVisList","mstrmojo.OIVMDICConfig","mstrmojo.OIVMDocSelectorViewFactory","mstrmojo.OIVMDocXtabGraph","mstrmojo.MenuButton","mstrmojo.ToolBar");mstrmojo.requiresDescs(5212,5213);var $EN=mstrmojo.EnumRWUnitType,$CFC=mstrmojo.DynamicClassFactory.newComponent,$DESCRIPTOR=mstrmojo.desc;mstrmojo.DocXtab=$CFC(mstrmojo.Xtab,[mstrmojo._Formattable,mstrmojo._IsDocXtab],{scriptClass:"mstrmojo.DocXtab"});var EXP_PDF=3,EXP_EXCEL=4;var getPopupDelegate=function(widget,openMenu){var w=widget;while(w){if(w.requiresMethod){w.requiresMethod(openMenu);}if(w[openMenu]){return w;}w=w.parent;}return null;};mstrmojo.ExpressDocBuilder=mstrmojo.declare(mstrmojo.DocBuilder,null,{scriptClass:"mstrmojo.ExpressDocBuilder",visList:mstrmojo.ExpressVisList,init:function init(props){this._super(props);var clsMap=this.classMap;this.selectorFactory=new mstrmojo.OIVMDocSelectorViewFactory();clsMap[$EN.GRAPH]={n:"OIVMDocXtabGraph",scriptClass:"mstrmojo.OIVMDocXtabGraph"};clsMap[$EN.PANELSTACK]={n:"PanelStack",scriptClass:"mstrmojo.DocPanelStack"};clsMap[$EN.PANEL]={n:"Panel",scriptClass:"mstrmojo.ExpressDocPanel"};clsMap[$EN.TEXTFIELD+"B"]={n:"Button",scriptClass:"mstrmojo.express.ui.DocButton"};},newLayout:function newLayout(model,node){var dlv=this._super(model,node);var gb=node.data.gbys;if(gb){dlv.addChildren(new mstrmojo.DocGroupBy({id:gb.k,slot:"groupBy",title:gb.title,model:model,node:node,data:gb.groupbys,controller:this.parent.controller}));}if(node.data.ifs){var ifs=new mstrmojo.IncFetch(mstrmojo.hash.copy(node.data.ifs,{slot:"incFetchNode",model:model}));ifs.attachEventListener("fetch",dlv.id,function(evt){var fnWait=function(v){if(evt.iWait){evt.iWait.set("visible",v);}};model.getDataService().fetchDocPage((evt.v-1)*ifs.ps+1,{submission:function(){fnWait(true);},success:function(res){model.loadLayout(res);},complete:function(){fnWait(false);}});});dlv.addChildren(ifs);}return dlv;},newXtab:function newXtab(model,node){var txi=node.defn.txi,XtabCls=mstrmojo.DocXtab;if(txi){mstrmojo.EditableXtab=mstrmojo.DynamicClassFactory.newComponent(mstrmojo.Xtab,[mstrmojo._CanSupportTransaction,mstrmojo._IsEditableXtab],{scriptClass:"mstrmojo.EditableXtab"});XtabCls=mstrmojo.EditableXtab;}var xtab=mstrmojo.all[node.id];if(!xtab){xtab=new XtabCls({id:node.id,node:node,controller:this.parent.controller});xtab.model=new mstrmojo.DocXtabModel({xtab:xtab,docModel:model});}else{xtab.set("node",node);xtab.model.set("docModel",model);}return xtab;},getPortletExportGridToolbar:function getPortletExportGridToolbar(key){return{css:"grid-menu",node:{scriptClass:"mstrmojo.ToolBar",slot:"toolbarNode",alias:"rightToolbar",children:[{scriptClass:"mstrmojo.MenuButton",iconClass:"mstrmojo-oivmSprite tbDown",itemIdField:"did",itemField:"n",itemChildrenField:"subItms",executeCommand:function(item){var dl=getPopupDelegate(this,"exportCmd");if(dl){dl.exportCmd(item.did,key);}},cm:[{n:$DESCRIPTOR(5212,"Export to PDF"),did:EXP_PDF},{n:$DESCRIPTOR(5213,"Export to Excel"),did:EXP_EXCEL}]}]}};}});}());