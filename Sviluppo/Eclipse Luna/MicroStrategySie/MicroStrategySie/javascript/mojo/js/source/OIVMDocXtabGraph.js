(function(){mstrmojo.requiresCls("mstrmojo.DocXtabGraph");var $D=mstrmojo.dom;mstrmojo.OIVMDocXtabGraph=mstrmojo.declare(mstrmojo.DocXtabGraph,null,{scriptClass:"mstrmojo.OIVMDocXtabGraph",postBuildRendering:function postBuildRendering(){if(!this.preLoader){this.preLoader=document.createElement("img");}return this._super();},retrieveGraphSrc:function retrieveGraphSrc(h,w){var src=mstrConfig.taskURL+"?taskId=getRWGraphImage&taskEnv=xhr&__ts__="+(new Date().getTime())+"&messageID="+this.model.mid+"&nodeKey="+this.k+"&sliceID="+parseInt(this.node.data.sid,10)+"&imgType=4&width="+parseInt(w,10)+"&height="+parseInt(h,10)+"&sessionState="+escape(mstrApp.sessionState),preLoader=this.preLoader,imgNode=this.imgNode,id=this.id;src=mstrmojo.addCSRFTokenToURL(src);if(preLoader.src!==src){mstrApp.addLoadingGraph(id);var fnComplete=function(){mstrApp.removeLoadingGraph(id);},load="load",err="error",fnPreFail,fnPreLoad,fnMainFail,fnMainLoad;fnPreLoad=$D.attachOneTimeEvent(preLoader,load,function(){fnMainLoad=$D.attachOneTimeEvent(imgNode,load,function(){fnComplete();imgNode.style.background="none";mstrmojo.all[id].defn.set("readyState",mstrmojo.EnumReadystate.IDLE);$D.detachEvent(imgNode,err,fnMainFail);});fnMainFail=$D.attachOneTimeEvent(imgNode,err,function(){fnComplete();$D.detachEvent(imgNode,load,fnMainLoad);});$D.detachEvent(preLoader,err,fnPreFail);imgNode.src=preLoader.src;});fnPreFail=$D.attachOneTimeEvent(preLoader,"error",function(){fnComplete();$D.detachEvent(preLoader,load,fnPreLoad);});preLoader.src=src;}}});}());