(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom");var _S=mstrmojo.string,_D=mstrmojo.dom;var _elCreate=mstrmojo.useFrames?null:document.createElement("span");var _REG_EXP_EVTS=/\mstrAttach\:([\w\,]+)/g;var isTouchEnabled;function _replEvts(s){if(isTouchEnabled===undefined){isTouchEnabled=(mstrApp!==undefined&&mstrApp.isTouchApp&&mstrApp.isTouchApp())||false;}return s.replace(_REG_EXP_EVTS,function hRepl(token,es){var arr=es.split(","),out=[],len=arr.length,i;for(i=0;i<len;i++){var e=arr[i];if(e){if(isTouchEnabled){if(e.indexOf("mouse")>-1){continue;}else{if(e==="click"){e="touchend";}}}out.push("on"+e+"=\"mstrmojo.dom.captureDomEvent('{@id}','"+e+"', self, event)\"");}}return out.join(" ");});}var PRE="preBuildRendering",BUILD="buildRendering",POST="postBuildRendering";function _build(widget){var s=widget.markupString;if(s.match(/mstrAttach:/)){s=_replEvts(s);if(widget.markupString===widget.constructor.prototype.markupString){widget.constructor.prototype.markupString=s;}}var html=_S.apply(s,widget);if(html){if(mstrmojo.useFrames){var doc=(widget.domNode&&widget.domNode.ownerDocument)||self.document;if(!_elCreate||_elCreate.ownerDocument!==doc){_elCreate=doc.createElement("span");}}_elCreate.innerHTML=html;var d=_elCreate.firstChild;d.mstrmojoId=widget.id;return d;}return null;}function _callSlots(widget){var ms=widget.markupSlots,nodes,n;if(ms){nodes={};for(n in ms){nodes[n]=ms[n].apply(widget,[]);}}return nodes;}mstrmojo._HasMarkup=mstrmojo.provide("mstrmojo._HasMarkup",{onRender:mstrmojo.emptyFn,onUnRender:mstrmojo.emptyFn,render:function rnd(){if((this[PRE]&&this[PRE]()===false)||(this[BUILD]()===false)||(this[POST]&&this[POST]()===false)){return false;}this.hasRendered=!!this.domNode;this.onRender();var evtName="renderComplete";if(mstrmojo.publisher.hasSubs(this.id,evtName)){this.raiseEvent({name:evtName});}return true;},buildDom:function buildDom(){return _build(this);},preBuildRendering:mstrmojo.emptyFn,buildRendering:function bldRnd(){var dnWas=this.domNode,dn=this.buildDom();this.domNode=dn;if(this.postBuildDom){this.postBuildDom();}if(this.slotNames){this.removeSlots(this.slotNames);}this.addSlots(_callSlots(this));this.paint();if(dn){var ph=dnWas;if(!ph){ph=this.placeholder;if(ph){if(typeof ph==="string"){ph=document.getElementById(ph);}delete this.placeholder;}}if(ph){_D.replace(ph,dn);}}var fn="onchildRenderingChange",p=this.parent;if(p&&p[fn]){p[fn](this);}return true;},postBuildRendering:mstrmojo.emptyFn,unrender:function unrn(ignoreDom){if(this.hasRendered){if(!ignoreDom){try{var dn=this.domNode;if(dn.parentNode){dn.parentNode.removeChild(dn);}if(mstrmojo.dom.isIE&&dn.outerHTML!=="undefined"){dn.outerHTML="";}}catch(ex){}}this.domNode=null;this.removeSlots(this.slotNames);this.hasRendered=false;this.onUnRender();}},paint:function pnt(){var ms=this.markupMethods;if(!ms){return ;}var me=this,callM=function(n){var f=ms[n];if(f){try{f.apply(me,[true]);}catch(localerr){throw new Error(["Error in markup method.","Widget id: "+me.id,"Method name: "+n,"Err: "+localerr.message].join("\n\n"));}}};var s=ms.sequence,len,i,n;if(s){len=s.length||0;for(i=0;i<len;i++){callM(s[i]);}}else{for(n in ms){callM(n);}}},refresh:function refresh(postUnrender){if(this.hasRendered){var ph=this.domNode;this.unrender(true);this.placeholder=ph;if(postUnrender){postUnrender();}this.render();}},set:function set(n,v){this._super(n,v);if(this.domNode){var ms=this.markupMethods,f=ms&&ms["on"+n+"Change"];if(f){f.apply(this);}}return this;},slotNames:null,addSlots:function addSlots(slots){var ns=this.slotNames,n;if(!ns){ns={};this.slotNames=ns;}for(n in slots){this[n]=slots[n];ns[n]=true;}},removeSlots:function rmvSlts(slots){if(slots){var sns=this.slotNames,n;for(n in slots){delete this[n];if(sns){delete sns[n];}}}},captureDomEvent:function cap(type,hWin,e,config){if(this.enabled!==false){this.raiseEvent({name:type,hWin:hWin,e:e||hWin.event,config:config});}},playEffect:function playEffect(n){var fx=this[n];if(fx&&fx.constructor===Object){fx=mstrmojo.insert(mstrmojo.hash.clone(fx));fx.widget=this;this[n]=fx;}if(fx){fx.play();}}});}());