(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.QB.QContextMenu");function _makeTable(txt,ind,tp,s,display,h,w){var sh=h?"height:"+h+"px;":"";var sw=w?"width:"+w+"px;":"";var bcolor;if(ind===1){bcolor="background-color:white;";}var table='<div style="display:'+display+sh+sw+";"+bcolor+'"> <table style="width: 100%; border-collapse:collapse;border-spacing=0px;table-layout: fixed;"> <tr>';for(i=0;i<ind;i++){table+='<td width="13px"></td>';}table+='<td width="20px"><span class="mstrmojo-ArchitectListIconBlock t'+tp+'" ></span></td>';table+='<td  style="overflow:hidden;text-overflow:ellipsis;">'+txt+"</td>";table+="</tr> </table> </div>";return table;}var _D=mstrmojo.dom,_doc=mstrmojo.global.document;var _av,_avin,_avs;var _pos;function _updateAvatar(pos,allowDrop,html){if(html!=null){_avin.innerHTML=html;}_avs.left=pos.x+"px";_avs.top=pos.y+"px";}function _showAvatar(html,pos){if(!_av){_av=_doc.createElement("div");_avs=_av.style;_avs.position="absolute";_avs["z-index"]=9999;_av.className="mstrmojo-Architect-TableRow-avatar";_av.innerHTML="<div></div>";_avin=_av.firstChild;_doc.body.appendChild(_av);}_updateAvatar(pos,true,html);_avs.display="block";}function _hideAvatar(){if(_av){_avs.display="none";}}function _isOver(w,x,y){if(!w.domNode){return false;}var pos=_D.position(w.domNode,true);return((pos.y<=y)&&(pos.x<=x)&&(pos.x+pos.w>=x)&&(pos.y+pos.h>=y));}function _findTouchDroppable(t,x,y){var el=document.elementFromPoint(x,y);var w=_D.findWidget(el);while(w){if(w.dropZone){if(w.allowDrop&&w.allowDrop(t)){return w;}}w=w.parent;}return null;}mstrmojo.Architect.DBTableRow=mstrmojo.declare(mstrmojo.Container,[mstrmojo._TouchGestures],{scriptClass:"mstrmojo.Architect.DBTableRow",indent:0,text:"",checkBox:false,draggable:true,ownAvatar:true,_leftPos:0,_topPos:0,movable:false,dropTarget:null,markupString:'<div id="{@id}" class="mstrmojo-qb-DBTableRow {@cssClass}" style="{@cssText}"></div>',markupMethods:{ontextChange:function(){this.domNode.innerHTML=_makeTable(this.text,this.indent,this.tp,this.selected,this.display);}},getDragData:function(c){return this;},ondragstart:function(c){var n=c.src.node,tn=this.domNode;if(_D.contains(tn,n,true,document.body)){if(_D.isWK){document.onselectstart=function(e){e.preventDefault();return false;};}this.domNode.style.cssText="opacity:0.3; filter: alpha(opacity=30);";_pos=_D.position(this.domNode);_showAvatar(_makeTable(this.text,this.indent,this.tp,this.selected,this.display,this.domNode.offsetHeight,this.domNode.offsetWidth),_pos);return true;}else{return false;}},ondragmove:function(c){var e=c.tgt.pos,s=c.src.pos,dx=e.x-s.x,dy=e.y-s.y;_updateAvatar({x:e.x+5,y:e.y+5},true);},ondragend:function(c){if(_D.isWK){document.onselectstart=function(e){return true;};}if(this.domNode){this.domNode.style.cssText="opacity:1; filter: alpha(opacity=100);";}_hideAvatar();}});})();