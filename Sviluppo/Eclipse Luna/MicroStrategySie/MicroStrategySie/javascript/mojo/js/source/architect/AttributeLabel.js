(function(){mstrmojo.requiresCls("mstrmojo.Editor");var _C=mstrmojo.css,$D=mstrmojo.dom;mstrmojo.Architect.AttributeLabel=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.Architect.AttributeLabel",cssClass:"mstrmojo-Architect-rAttr",modal:false,pids:[],cids:[],markupString:'<div id="{@id}"><div class="mstrmojo-Editor {@cssClass}" style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown>{@titlebarHTML}<div></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div></div>',titleMarkupString:'<div style="position:absolute;width:100%;"><table cellspacing="0" cellpadding="0" class="mstrmojo-Editor-titlebar" style="height:10px;"><tr><td class="mstrmojo-Editor-titleCell"><div class="mstrmojo-Editor-title" style="height:8px;"></div></td><td></td><td><div></div></td></tr></table></div><div style="height:10px;"></div>',markupMethods:{ontitleChange:function(){if(this.showTitle){this.titleNode.innerHTML=this.title;}},onzIndexChange:function(){this.editorNode.style.zIndex=this.zIndex;this.curtainNode.style.zIndex=this.zIndex-1;},onvisibleChange:function(init){if(init){return ;}var v=this.visible,fx=v?"openEffect":"closeEffect",d=v?"block":"none";if(this[fx]){this.playEffect(fx);}else{this.editorNode.style.display=d;if(this.modal){this.curtainNode.style.display=d;}}},onleftChange:function(){this.editorNode.style.left=(this.left!=null)?this.left:"";},ontopChange:function(){this.editorNode.style.top=(this.top!=null)?this.top:"";}},dropZone:true,allowDrop:function allowDrop(ctxt){return true;},ondragover:function onDrg(c){if(c.src&&c.src.data){var d=c.src.data;if(d.did===this.did){return ;}var n=this.editorNode,st=n.style,html="",pos_c=$D.position(this.parent.domNode),pos=$D.position(n),linker=this.parent.parent.linker,dy=c.tgt.pos.y-pos.y,x=pos.x-pos_c.x,y=pos.y-pos_c.y;st.width="100px";if(dy<10){d.type=2;d.caid=this.did;st["border-top-style"]="solid";st["border-top-color"]="red";st["border-top-width"]="2px";st["border-bottom-color"]="#CCC";html="<div>Add as parent</div>";linker.renderTooltip(html,x,y-15);}else{if(dy>20){d.type=1;d.paid=this.did;st["border-top"]="none";st["border-bottom-color"]="red";html="<div>Add as Child</div>";linker.renderTooltip(html,x,y+n.clientHeight);}}}},ondragmove:function ondragmove(c){var e=c.tgt.pos,s=c.src.pos,dx=e.x-s.x,dy=e.y-s.y,st=this.getMovingTarget().style,vl=this._leftPos+dx,vt=this._topPos+dy,ele=this.parent,elest=ele.domNode.style,ml=ele.maxw,mh=ele.maxh,p=ele.parent,pn=p.domNode,ph=pn.clientHeight,pw=pn.clientWidth,linker=p.linker;if(vl<0){vl=0;}if(vl+20>ml){linker.width=vl+20;ele.maxw=vl+20;linker.NeedRender=true;}if(vt<0){vt=0;}if(vt+20>mh){linker.height=vt+20;ele.maxh=vt+20;linker.NeedRender=true;}if(vt+20>ph&&!ele.isheight){pn.style["overflow-y"]="auto";}if(vl+20>pw&&!ele.iswidth){pn.style["overflow-x"]="auto";}st.left=vl+"px";this.left=vl+"px";st.top=vt+"px";this.top=vt+"px";p.linker.drawLinks();},ondrop:function(c){if(c.src&&c.src.data){var d=c.src.data,st=this.editorNode.style,tp=d.type,paid=d.paid,caid=d.caid,aid=d.did,tbl=d.tbl,mdl=mstrmojo.all.ArchModel,p=this.parent,lst=p.parent.linker.tooltip.style;if(lst.display==="block"){lst.display="none";}if(p.attrs[aid]&&!d.images){mstrmojo.alert("This attribute is already on the panel!!");st["border-top"]="none";st["border-bottom-color"]="#CCC";return ;}if(d.did===c.tgt.widget.did){return ;}var cb={success:function(res){var cb1={success:function(res){p.removeChildren();p.attrs[aid]=d;p.parent.refresh();},failure:function(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));}};switch(tp){case 1:mdl.addrmvRelation(paid,aid,16,tbl,cb1);break;case 2:mdl.addrmvRelation(aid,caid,16,tbl,cb1);break;default:break;}},failure:function(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));}};var att=p.attrs[aid];if(!att||!att.pids){cb.success();}else{var pids=[],cids=[];d.pids=att.pids;d.cids=att.cids;p.findConflictAttrs(d,pids,cids,tp);if(pids.length===0){cb.success();}else{mdl.removeRelations(aid,pids,cids,cb);}}}},ondragleave:function(c){if(c.src&&c.src.data){var d=c.src.data,st=this.editorNode.style;d.type=d.caid=d.paid=null;st["border-top"]="none";st["border-bottom-color"]="#CCC";}},addRow:function AddRow(attr,level,icons){var row={scriptClass:"mstrmojo.Architect.DBTableRow",images:icons,indent:level,text:attr.n,tbls:attr.tbls,did:this.did};this.addChildren([row]);}});})();