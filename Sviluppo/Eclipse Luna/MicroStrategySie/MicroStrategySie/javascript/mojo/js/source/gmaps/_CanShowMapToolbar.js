(function(){var MESSAGE_BOX_HEIGHT=115,LAYER_TITLE_HEIGHT=30,TRIANGLE_HEIGHT=10,EMPTY_SPACE_BETWEEN_TRIANGLE_AND_TOOLBAR=5,SLIDING_ANIMATION_DURATION=500,MESSAGE_BOX_SLIDING_ANIMATION_DURATION=300,TOOLBAR_STATE={NORMAL_STATE:0,SINGLE_SELECT_STATE:1,RECTANGLE_SELECT_STATE:2,ZOOM_STATE:3,AFFINITY_STATE:4,FREE_SELECT_STATE:5,CIRCLE_SELECT:6,CLEAR_ALL_STATE:7,GRIDS_SELECT_STATE:8},EnumMarkerType={MARKER:"1",BUBBLE:"2",POLYGON:"3",DENSITY:"4"},$D=mstrmojo.dom,$CSS=mstrmojo.css,buttonsToCreateFlag;mstrmojo.gmaps._CanShowMapToolbar={_mixinName:"mstrmojo.gmaps._CanShowMapToolbar",callback:null,mixinParentMapObj:null,EnumToolbarButtonType:{DRILL:1,SINGLE_SELECT:2,RECTANGLE_SELECT:4,EDIT_INFO_WINDOW:8,CLEAR_ALL:16,AFFINITY:32,FREE_SELECT:64,CIRCLE_SELECT:128,ZOOM:256,GRIDS_SELECT:512},TOOLBAR_BUTTON_COUNT:10,layerChosen:[],formatPopupRef:null,googlemap:null,toolBarActive:false,layersRendered:0,timer:null,clearAllPopup:null,singleSelectPopup:null,metricSelectBox:null,buttonsBox:null,toolbar:null,$MSM:null,metricsString:"",metricData:[],createMessagePopup:function createMessagePopup(popupName,messagePlaceHolder,message,okBtnText,okCallbackFunc,cancelCallbackFunc){var me=this;var messagePopup=mstrmojo.insert({alias:"messagePopup",scriptClass:"mstrmojo.Popup",cssClass:"messagePopupWindow",placeholder:messagePlaceHolder,children:[{alias:"popupLabel",scriptClass:"mstrmojo.Label",cssClass:"messageLabel",text:message},{alias:"popupVBox",scriptClass:"mstrmojo.HBox",children:[{alias:"okButton",scriptClass:"mstrmojo.Button",cssClass:"messageBoxOkButton",text:okBtnText,onclick:function onclick(){okCallbackFunc.call(this);}},{alias:"cancelButton",scriptClass:"mstrmojo.Button",cssClass:"messageBoxCancelButton",text:mstrmojo.desc(221,"Cancel"),onclick:function onclick(){if(cancelCallbackFunc!=undefined){cancelCallbackFunc.call(this);}else{me.buttonsBox.set("state",TOOLBAR_STATE.NORMAL_STATE);}}}]},{alias:"confirmationWindowTriangle",scriptClass:"mstrmojo.Label",cssClass:"confirmationWindowTriangle "+popupName}]});return messagePopup;},initMapToolbar:function initMapToolbar(mapObj,gridInfo,flags,toolBarId,layersDivId,clearAllIdPopupId,singleSelectPopupId){this.googlemap=mapObj;this.metricData=gridInfo;buttonsToCreateFlag=flags;this.placeholder=toolBarId;this.merticSelectPlaceholder=layersDivId;this.clearAllPopupPlaceholder=clearAllIdPopupId;this.singleSelectPopupPlaceholder=singleSelectPopupId;this.metricsString=mstrmojo.desc(1158,"Metrics");this.layerChosen=[];for(var i=0;i<this.metricData.length;i++){this.layerChosen.push(i);}},positionLayout:function(){var tb=this.toolbar,mb=this.metricSelectBox,cap=this.clearAllPopup,ssp=this.singleSelectPopup,mapHeight=this.height;var movableBoxCssObject=$CSS.getComputedStyle(tb.movableBox.domNode),movableRightPos=Math.abs(this.getPropertyValue(movableBoxCssObject,"right")),movableBoxWidth=tb.barLength;if(tb.buttonCount!=tb.defaultButtonCount){movableBoxWidth=movableBoxWidth-(movableBoxWidth-movableRightPos)/tb.defaultButtonCount*(tb.defaultButtonCount-tb.buttonCount);}var metricBoxWidth=this.getPropertyValue($CSS.getComputedStyle(mb.domNode),"width");var toolBarBoxObject=$CSS.getComputedStyle(tb.domNode);var rightPos=this.getPropertyValue(toolBarBoxObject,"right");mb.domNode.style.right=rightPos+movableBoxWidth-metricBoxWidth-24+"px";var clearAllPopWidth=this.getPropertyValue($CSS.getComputedStyle(cap.domNode),"width");var bias=tb.buttonCount<8?-5:0;ssp.domNode.style.right=parseInt(rightPos,10)-20+movableRightPos+(movableBoxWidth-movableRightPos)/tb.buttonCount-38+bias+"px";if((buttonsToCreateFlag&this.EnumToolbarButtonType.EDIT_INFO_WINDOW)!=0){bias=tb.buttonCount<6?-5:0;$CSS.removeClass(cap.confirmationWindowTriangle.domNode,"clearAllPopup");cap.domNode.style.right=140+bias+"px";}else{cap.domNode.style.right=parseInt(rightPos,10)-20+movableRightPos+(movableBoxWidth-movableRightPos)/tb.buttonCount*5-clearAllPopWidth+bias+"px";}},getPropertyValue:function getPropertyValue(mapCssObj,property){var propertyValue;if(mapCssObj&&property){if(!window.getComputedStyle){propertyValue=parseInt(mapCssObj[property],10);}else{propertyValue=parseInt(mapCssObj.getPropertyValue(property),10);}}return propertyValue;},renderMultiGridLayersBox:function renderMultiGridLayersBox(){var me=this;this.metricSelectBox=mstrmojo.insert({alias:"metricSelectBox",scriptClass:"mstrmojo.Box",cssClass:"metricSelectBox",visible:false,height:null,placeholder:me.merticSelectPlaceholder,children:[{alias:"metricContentWrapper",scriptClass:"mstrmojo.Box",cssClass:"metricContentWrapper",children:[{scriptClass:"mstrmojo.Label",cssClass:"layerTitle",text:mstrmojo.desc(11142,"Layers")},{alias:"metricContentBox",scriptClass:"mstrmojo.Box",cssClass:"metricContentBox",children:[{alias:"metricSelectVBox",scriptClass:"mstrmojo.VBox",cssClass:"metricSelectVBox",cssText:"",closeMe:function closeMe(e){var elTarget=$D.eventTarget(self,e);var t=$D.contains(me.metricSelList.parent.domNode,elTarget,true,me.metricSelList.parent.domNode);if(!t){$D.detachEvent(document,"click",me.$MSM);var metricBoxHeight=me.metricSelectBox.height;var startPos=metricBoxHeight,stopPos=0;new mstrmojo.fx.AnimateProp({target:me.metricSelectBox.domNode,props:{height:{ease:mstrmojo.ease.sin,start:startPos,stop:stopPos,suffix:"px"}},duration:SLIDING_ANIMATION_DURATION}).play();me.buttonsBox.set("state",TOOLBAR_STATE.NORMAL_STATE);}},postCreate:function postCreate(evt){me.layersRendered=me.metricData.length;var childs=[];var allCheckBox=mstrmojo.insert({scriptClass:"mstrmojo.CheckBox",cssClass:"allLayer",label:mstrmojo.desc(10371,"All Layers"),alias:"allLayers",cssDisplay:"block",align:"left",postCreate:function(){this.set("checked",true);},onclick:function(evt){var layer;for(i=0;i<me.metricData.length;i++){layer=this.parent.children[i+1].children[0];if(this.checked!=layer.checked){layer.processMe(this.checked);}}}});if(me.metricData.length>1){childs.push(allCheckBox);}for(i=0;i<me.metricData.length;i++){var gridMetricSel=mstrmojo.insert({scriptClass:"mstrmojo.VBox",alias:"layersbox"+i,halign:"left",cssText:"margin-top:3px;margin-bottom:5px;width:100%;",children:[{scriptClass:"mstrmojo.CheckBox",cssClass:"gridLayerNames",label:me.metricData[i].gridName,tooltip:me.metricData[i].gridName,align:"left",cssDisplay:"block",layerIndex:i,processMe:function processMe(checked){me.layersRendered+=(checked?1:-1);if(checked){me.layerChosen.push(this.layerIndex);me.googlemap.addGridLayer(this.layerIndex);}else{var ind=mstrmojo.array.indexOf(me.layerChosen,this.layerIndex);if(ind!=-1){me.layerChosen.splice(ind,1);}me.googlemap.removeGridLayer(this.layerIndex);if(me.googlemap.noMarkerSelected()){me.googlemap.markerSelected=false;}if(me.buttonsBox.drillButton){me.buttonsBox.drillButton.set("enabled",me.googlemap.isDrillable()&&me.buttonsBox.state==TOOLBAR_STATE.NORMAL_STATE);}}this.set("checked",checked);this.parent["metricSelector_"+this.layerIndex].set("enabled",checked);},postCreate:function(){this.set("checked",true);},onclick:function(evt){this.processMe(this.checked);if(this.parent.parent.allLayers){this.parent.parent.allLayers.set("checked",(me.layersRendered==me.metricData.length));}}},{scriptClass:"mstrmojo.RadioList",alias:"metricSelector_"+i,layerIndex:i,cssClass:"layerMetrics",itemTitleField:"n",labelCssText:"text-overflow:ellipsis;overflow:hidden;width:100px;white-space:nowrap;display:inline-block;font-size:13px",items:(function getRadioContents(){if(me.googlemap.gridDataViewer[i].wpMarkerType==EnumMarkerType.DENSITY){return[{n:"Marker density",gIdx:-1}];}else{return me.metricData[i].metrics;}})(),postCreate:function postCreate(evt){this.selectedIndex=0;},postselectionChange:function(evt){if(this.parent.children[0].checked){var item=this.items[evt.added[0]];if(item.gIdx!=-1){me.googlemap.onselectedMetricIndexChange(item.gIdx,evt.added[0],item.id);}}}}]});childs.push(gridMetricSel);}this.set("children",childs);}}]}]},{alias:"multipleGridWindowTriangle",scriptClass:"mstrmojo.Label",cssClass:"multipleGridWindowTriangle"}]});this.metricSelectBox.render();},renderSingleSelectPopup:function renderSingleSelectPopup(){var me=this;var okHandler=function(){this.parent.parent.set("visible",false);me.googlemap.handleSingleSelection(true);me.buttonsBox.set("state",TOOLBAR_STATE.NORMAL_STATE);me.googlemap.set("enablePopup",true);};var cancelHandler=function(){this.parent.parent.set("visible",false);me.googlemap.handleSingleSelection(false);me.buttonsBox.set("state",TOOLBAR_STATE.NORMAL_STATE);me.googlemap.set("enablePopup",true);};this.singleSelectPopup=this.createMessagePopup("singleSelectPopup",me.singleSelectPopupPlaceholder,mstrmojo.desc(9877,"Please click on markers you want to select."),mstrmojo.desc(8473,"Done"),okHandler,cancelHandler);this.singleSelectPopup.render();},renderClearAllPopup:function renderClearAllPopup(){var me=this;var okHandler=function(){me.googlemap.clearSelections();me.googlemap.doClearRectangle(true);me.googlemap.set("markerSelected",false);me.buttonsBox.set("state",TOOLBAR_STATE.NORMAL_STATE);};this.clearAllPopup=this.createMessagePopup("clearAllPopup",me.clearAllPopupPlaceholder,mstrmojo.desc(9876,"Are you sure you wish to remove all selections?"),mstrmojo.desc(1442,"OK"),okHandler);this.clearAllPopup.render();},renderEditInfoWindow:function renderEditInfoWindow(){var ssp=this.singleSelectPopup,tb=this.toolbar;this.formatPopupRef={scriptClass:"mstrmojo.Editor",contentNodeCssClass:"mstrmojo-balloon",alias:"infoWindowEditor",title:mstrmojo.desc(8218,"Edit custom infoWindow"),left:"100px",top:"100px",width:"200px",locksHover:true,onOpen:function(){var openerDom=this.opener.domNode;var position=mstrmojo.dom.position(openerDom);var top=position.y+50;var left=parseInt(tb.domNode.style.left)+100;console.log("opener's offset"+openerDom.offsetLeft+":"+openerDom.offsetTop);this.set("top",top+"px");this.set("left",left+"px");this.editorNode.style.width="258px";this.editorNode.style.zIndex=9999;this.gridSelectorHBox.gridSelector.previousSelection=0;},children:[{alias:"gridSelectorHBox",scriptClass:"mstrmojo.HBox",halign:"left",cssText:"margin:3px",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(10372,"Select a Grid: "),align:"left"},{alias:"gridSelector",scriptClass:"mstrmojo.SelectBox",bindings:{items:"this.parent.parent.opener.gridNamesSelectorItems"},size:1,selectedIndex:0,previousSelection:0,cssText:"white-space: nowrap; width: 200px",onchange:function onchange(){if(!this.selectedItem){return ;}this.parent.parent.opener.getGridViewer(this.previousSelection).setInfoWindowHTML(this.parent.parent.desc.value);var ind=parseInt(this.selectedItem.v);this.parent.parent.desc.set("value",this.parent.parent.opener.getGridViewer(ind).getInfoWindowHTML());this.previousSelection=ind;}}]},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-SaveAsEditor-descInput",alias:"desc",bindings:{value:function(){if(!this.parent.opener){return"";}else{var viewer=this.parent.opener.getPrimaryGridViewer();return viewer.getInfoWindowHTML();}}},cols:80,rows:7},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.HTMLButton",alias:"ok",text:mstrmojo.desc(1442,"OK"),cssClass:"mstrmojo-Editor-button",onclick:function(){var val=this.parent.parent.desc.value;this.parent.parent.opener.getGridViewer(this.parent.parent.gridSelectorHBox.gridSelector.previousSelection).setInfoWindowHTML(val);this.parent.parent.opener.saveCustomInfo();}},{scriptClass:"mstrmojo.HTMLButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-Editor-button",onclick:function(){this.parent.parent.close();}}]},{alias:"editInfoWindowTriangle",scriptClass:"mstrmojo.Label",cssClass:"editInfoWindowTriangle"}]};},renderToolBarButtons:function renderToolBarButtons(){var me=this;this.toolbar=mstrmojo.insert({alias:"toolBarBox",scriptClass:"mstrmojo.Box",cssClass:"mstrMapToolBarBox",placeholder:me.placeholder,buttonCount:me.TOOLBAR_BUTTON_COUNT,defaultButtonCount:me.TOOLBAR_BUTTON_COUNT,barLength:440,markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout ></div>',onmouseout:function(e){var targetDom=$D.eventTarget(self,e.e);var toElement=e.e.toElement||e.e.relatedTarget;if(!!toElement&&$D.contains(this.domNode,toElement,false)){return ;}if(me.buttonsBox.state==TOOLBAR_STATE.NORMAL_STATE&&me.toolBarActive){me.timer=window.setTimeout(function(){me.toolbar.openCloseToolbar(false);},1000);}},onmouseover:function(e){if(me.timer!==undefined){window.clearTimeout(me.timer);}var targetDom=$D.eventTarget(self,e.e);var fromElement=e.e.fromElement||e.e.relatedTarget;if($D.contains(this.domNode,fromElement,true)||me.toolBarActive){return ;}this.openCloseToolbar(true);},openCloseToolbar:function(openToolbar){var startPos,stopPos,barLength=me.toolbar.barLength;var movableBoxCssObject=$CSS.getComputedStyle(me.toolbar.movableBox.domNode),movableRightPos=me.getPropertyValue(movableBoxCssObject,"right");if(me.toolbar.buttonCount!=me.toolbar.defaultButtonCount){barLength=barLength-(barLength-movableRightPos)/me.toolbar.defaultButtonCount*(me.toolbar.defaultButtonCount-me.toolbar.buttonCount);}startPos=openToolbar?0:barLength;stopPos=openToolbar?barLength:0;new mstrmojo.fx.AnimateProp({target:this.movableBox.domNode,props:{width:{ease:mstrmojo.ease.sin,start:startPos,stop:stopPos,suffix:"px"}},duration:SLIDING_ANIMATION_DURATION}).play();me.toolBarActive=openToolbar;},children:[{alias:"mainButton",scriptClass:"mstrmojo.Button",cssClass:"mstrMapButton",iconClass:"mstrtbMapMainButton",onmousedown:function onmousedown(){this.set("selected",true);},onmouseup:function onmouseup(){this.set("selected",false);if(me.toolBarActive){window.clearTimeout(me.timer);me.timer=me.toolbar.openCloseToolbar(false);me.buttonsBox.set("state",TOOLBAR_STATE.NORMAL_STATE);}}},{alias:"movableBox",scriptClass:"mstrmojo.Box",cssClass:"mstrMapToolBarMovableBox",children:[{alias:"innerBox",scriptClass:"mstrmojo.Box",cssClass:"mstrMapToolBarInnerBox",children:[{alias:"buttonsBox",scriptClass:"mstrmojo.HBox",cssClass:"mstrMapToolbar mstrMapButton",state:TOOLBAR_STATE.NORMAL_STATE,onstateChange:function(){this.clickSelect.set("enabled",(this.state==TOOLBAR_STATE.NORMAL_STATE||this.state==TOOLBAR_STATE.SINGLE_SELECT_STATE)&&!me.googlemap.isSelectedDensity(me.googlemap.layerChosen));this.rectangleSelect.set("enabled",this.state==TOOLBAR_STATE.NORMAL_STATE||this.state==TOOLBAR_STATE.RECTANGLE_SELECT_STATE);this.clearAll.set("enabled",(!me.googlemap.noPolygonsPresentOnMap()||me.googlemap.markerSelected)&&(this.state==TOOLBAR_STATE.CLEAR_ALL_STATE||this.state==TOOLBAR_STATE.NORMAL_STATE));this.showMetricSelectorList.set("enabled",this.state==TOOLBAR_STATE.NORMAL_STATE||this.state==TOOLBAR_STATE.GRIDS_SELECT_STATE);this.clickSelect.set("selected",this.state==TOOLBAR_STATE.SINGLE_SELECT_STATE);this.rectangleSelect.set("selected",this.state==TOOLBAR_STATE.RECTANGLE_SELECT_STATE);this.clearAll.set("selected",this.state==TOOLBAR_STATE.CLEAR_ALL_STATE);this.showMetricSelectorList.set("selected",this.state==TOOLBAR_STATE.GRIDS_SELECT_STATE);if((buttonsToCreateFlag&me.EnumToolbarButtonType.ZOOM)!=0){this.zoomButton.set("enabled",this.state==TOOLBAR_STATE.NORMAL_STATE||this.state==TOOLBAR_STATE.ZOOM_STATE);this.zoomButton.set("selected",this.state==TOOLBAR_STATE.ZOOM_STATE);me.googlemap.set("enableZoom",this.state==TOOLBAR_STATE.ZOOM_STATE);}if((buttonsToCreateFlag&me.EnumToolbarButtonType.FREE_SELECT)!=0){this.freeSelect.set("enabled",this.state==TOOLBAR_STATE.NORMAL_STATE||this.state==TOOLBAR_STATE.FREE_SELECT_STATE);this.freeSelect.set("selected",this.state==TOOLBAR_STATE.FREE_SELECT_STATE);me.googlemap.set("enableFreeFormSelect",this.state==TOOLBAR_STATE.FREE_SELECT_STATE);}if((buttonsToCreateFlag&me.EnumToolbarButtonType.CIRCLE_SELECT)!=0){this.circleSelect.set("enabled",this.state==TOOLBAR_STATE.NORMAL_STATE||this.state==TOOLBAR_STATE.CIRCLE_SELECT_STATE);this.circleSelect.set("selected",this.state==TOOLBAR_STATE.CIRCLE_SELECT_STATE);me.googlemap.set("enableCircleSelect",this.state==TOOLBAR_STATE.CIRCLE_SELECT_STATE);}if(me.googlemap.drillable){this.drillButton.set("enabled",me.googlemap.isDrillable()&&this.state==TOOLBAR_STATE.NORMAL_STATE);}if(me.googlemap.affinityEnabled){this.affinityLines.set("selected",this.state==TOOLBAR_STATE.AFFINITY_STATE);this.affinityLines.set("enabled",this.state==TOOLBAR_STATE.NORMAL_STATE||this.state==TOOLBAR_STATE.AFFINITY_STATE);}me.googlemap.set("enableClickSelect",this.state==TOOLBAR_STATE.SINGLE_SELECT_STATE);me.googlemap.set("enableRectangleSelect",this.state==TOOLBAR_STATE.RECTANGLE_SELECT_STATE);me.googlemap.set("enablePopup",this.state==TOOLBAR_STATE.NORMAL_STATE||this.state==TOOLBAR_STATE.ZOOM_STATE);me.metricSelectBox.set("visible",this.state==TOOLBAR_STATE.GRIDS_SELECT_STATE);me.clearAllPopup.set("visible",this.state==TOOLBAR_STATE.CLEAR_ALL_STATE);me.singleSelectPopup.set("visible",this.state==TOOLBAR_STATE.SINGLE_SELECT_STATE);if(this.state==TOOLBAR_STATE.NORMAL_STATE&&me.toolBarActive){me.timer=window.setTimeout(function(){me.toolbar.openCloseToolbar(false);},3000);}},postCreate:function postCreate(){if((buttonsToCreateFlag&me.EnumToolbarButtonType.CIRCLE_SELECT)==0){this.parent.parent.parent.buttonCount--;this.children.splice(7,1);}if((buttonsToCreateFlag&me.EnumToolbarButtonType.FREE_SELECT)==0){this.parent.parent.parent.buttonCount--;this.children.splice(6,1);}if(!me.googlemap.isMapEnabledAffinityLine()){me.googlemap.affinityEnabled=false;this.parent.parent.parent.buttonCount--;this.children.splice(4,1);}if((buttonsToCreateFlag&me.EnumToolbarButtonType.ZOOM)==0){this.parent.parent.parent.buttonCount--;this.children.splice(3,1);}if((buttonsToCreateFlag&me.EnumToolbarButtonType.EDIT_INFO_WINDOW)==0){this.parent.parent.parent.buttonCount--;this.children.splice(2,1);}if(!me.googlemap.isMapDrillEnabled()){me.googlemap.drillable=false;this.parent.parent.parent.buttonCount--;this.children.splice(1,1);}},children:[{alias:"showMetricSelectorList",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapGridSelector",title:mstrmojo.desc(9881,"Multiple grids"),enabled:true,onclick:function onclick(event){me.googlemap.hideInfoWindow();me.metricSelList=me.metricSelectBox.metricContentWrapper.metricContentBox.metricSelectVBox;this.set("selected",!this.selected);this.parent.set("state",this.selected?TOOLBAR_STATE.GRIDS_SELECT_STATE:TOOLBAR_STATE.NORMAL_STATE);me.metricSelectBox.set("visible",true);me.$MSM=me.metricSelList.closeMe;$D.stopPropogation(window,event.e);if(me.metricSelectBox.visible&&this.selected){$D.attachEvent(document,"click",me.$MSM);}else{$D.detachEvent(document,"click",me.$MSM);}var tbDomNode=$CSS.getComputedStyle(me.toolbar.domNode);var toolbarTop=me.getPropertyValue(tbDomNode,"bottom")+me.getPropertyValue(tbDomNode,"height");me.metricSelectBox.domNode.style.maxHeight=((parseInt(me.height)-toolbarTop)*0.9)+"px";var metricBoxHeight,metricContentBoxOffsetHeight,wrapperHeight;metricContentBoxOffsetHeight=parseInt(me.metricSelectBox.metricContentWrapper.metricContentBox.domNode.offsetHeight);metricBoxHeight=LAYER_TITLE_HEIGHT+TRIANGLE_HEIGHT+EMPTY_SPACE_BETWEEN_TRIANGLE_AND_TOOLBAR+metricContentBoxOffsetHeight;metricBoxHeight=Math.min(metricBoxHeight,parseInt(me.metricSelectBox.domNode.style.maxHeight));me.metricSelectBox.domNode.style.height=metricBoxHeight+"px";wrapperHeight=metricBoxHeight-TRIANGLE_HEIGHT-EMPTY_SPACE_BETWEEN_TRIANGLE_AND_TOOLBAR;me.metricSelectBox.metricContentWrapper.metricContentBox.domNode.style.maxHeight=(wrapperHeight-LAYER_TITLE_HEIGHT)+"px";me.metricSelectBox.metricContentWrapper.metricContentBox.domNode.style.height=metricContentBoxOffsetHeight+"px";me.metricSelectBox.metricContentWrapper.domNode.style.height=wrapperHeight+"px";me.metricSelectBox.multipleGridWindowTriangle.domNode.style.top=(metricBoxHeight-14)+"px";var startPos=0,stopPos=metricBoxHeight;if(!this.selected){stopPos=startPos;startPos=metricBoxHeight;}new mstrmojo.fx.AnimateProp({target:me.metricSelectBox.domNode,props:{height:{ease:mstrmojo.ease.sin,start:startPos,stop:stopPos,suffix:"px"}},duration:MESSAGE_BOX_SLIDING_ANIMATION_DURATION}).play();window.clearTimeout(me.timer);}},{alias:"drillButton",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapDrill",title:mstrmojo.desc(145,"Drill"),enabled:false,onmousedown:function onmousedown(){me.googlemap.hideInfoWindow();this.set("selected",true);},onmouseup:function onmouseup(){this.set("selected",false);me.googlemap.processDrill();}},{alias:"customInfoWindow",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapCustomizeInfoWindow",title:mstrmojo.desc(8218,"Edit custom infoWindow"),onclick:function onclick(){me.googlemap.hideInfoWindow();me.openPopup("formatPopupRef");}},{alias:"zoomButton",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapZoom",title:mstrmojo.desc(11141,"Zoom"),enabled:true,onclick:function onclick(){this.set("selected",!this.selected);if(this.selected){me.googlemap.set("enablePopup",false);me.googlemap.set("infoWindowVisible",false);}this.parent.set("state",this.selected?TOOLBAR_STATE.ZOOM_STATE:TOOLBAR_STATE.NORMAL_STATE);me.googlemap.hideInfoWindow();window.clearTimeout(me.timer);}},{alias:"affinityLines",scriptClass:"mstrmojo.Button",enabled:true,iconClass:"mstrtbMapAffinity",title:mstrmojo.desc(9880,"Filter affinity lines/arcs"),onclick:function onclick(){me.googlemap.hideInfoWindow();this.set("selected",!this.selected);me.googlemap._affinityGlow=!me.googlemap._affinityGlow;me.googlemap.onAffinityAnimationModeChange();this.parent.set("state",this.selected?TOOLBAR_STATE.AFFINITY_STATE:TOOLBAR_STATE.NORMAL_STATE);window.clearTimeout(me.timer);}},{alias:"clearAll",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapClearAll",title:mstrmojo.desc(9879,"Remove selections"),enabled:false,onclick:function onclick(){me.googlemap.hideInfoWindow();this.set("selected",!this.selected);this.parent.set("state",this.selected?TOOLBAR_STATE.CLEAR_ALL_STATE:TOOLBAR_STATE.NORMAL_STATE);me.clearAllPopup.set("visible",true);var clearAllBoxHeight=MESSAGE_BOX_HEIGHT;var startPos=0,stopPos=clearAllBoxHeight;if(!this.selected){stopPos=startPos;startPos=clearAllBoxHeight;}new mstrmojo.fx.AnimateProp({target:me.clearAllPopup.domNode,props:{height:{ease:mstrmojo.ease.sin,start:startPos,stop:stopPos,suffix:"px"}},duration:MESSAGE_BOX_SLIDING_ANIMATION_DURATION}).play();window.clearTimeout(me.timer);}},{alias:"freeSelect",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapFreeSelectButton",title:mstrmojo.desc(10981,"Freeform selection tool"),enabled:true,onclick:function onclick(){this.set("selected",!this.selected);if(this.selected){me.googlemap.set("enablePopup",false);me.googlemap.set("infoWindowVisible",false);}this.parent.set("state",this.selected?TOOLBAR_STATE.FREE_SELECT_STATE:TOOLBAR_STATE.NORMAL_STATE);me.googlemap.hideInfoWindow();window.clearTimeout(me.timer);}},{alias:"circleSelect",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapCircleSelectButton",title:mstrmojo.desc(10980,"Circular selection tool"),enabled:true,onclick:function onclick(){this.set("selected",!this.selected);if(this.selected){me.googlemap.set("enablePopup",false);me.googlemap.set("infoWindowVisible",false);}this.parent.set("state",this.selected?TOOLBAR_STATE.CIRCLE_SELECT_STATE:TOOLBAR_STATE.NORMAL_STATE);me.googlemap.hideInfoWindow();window.clearTimeout(me.timer);}},{alias:"rectangleSelect",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapRectangleSearch",title:mstrmojo.desc(10979,"Rectangular selection tool"),enabled:true,onclick:function onclick(){this.set("selected",!this.selected);if(this.selected){me.googlemap.set("enablePopup",false);me.googlemap.set("infoWindowVisible",false);}this.parent.set("state",this.selected?TOOLBAR_STATE.RECTANGLE_SELECT_STATE:TOOLBAR_STATE.NORMAL_STATE);me.googlemap.hideInfoWindow();window.clearTimeout(me.timer);}},{alias:"clickSelect",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapSelection",title:mstrmojo.desc(10978,"Multiple marker selection tool"),enabled:!me.googlemap.isSelectedDensity(me.googlemap.layerChosen),onclick:function onclick(){me.googlemap.set("infoWindowVisible",false);this.set("selected",!this.selected);me.googlemap.set("enablePopup",false);this.parent.set("state",this.selected?TOOLBAR_STATE.SINGLE_SELECT_STATE:TOOLBAR_STATE.NORMAL_STATE);me.googlemap.hideInfoWindow();me.singleSelectPopup.set("visible",true);var singleSelectBoxHeight=MESSAGE_BOX_HEIGHT;var startPos=0,stopPos=singleSelectBoxHeight;if(!this.selected){stopPos=startPos;startPos=singleSelectBoxHeight;}new mstrmojo.fx.AnimateProp({target:me.singleSelectPopup.domNode,props:{height:{ease:mstrmojo.ease.sin,start:startPos,stop:stopPos,suffix:"px"}},duration:MESSAGE_BOX_SLIDING_ANIMATION_DURATION}).play();window.clearTimeout(me.timer);}}]}]}]}]});this.toolbar.render();},renderToolbar:function renderToolbar(){this.renderToolBarButtons();this.renderMultiGridLayersBox();this.renderClearAllPopup();this.renderSingleSelectPopup();this.renderEditInfoWindow();this.buttonsBox=this.toolbar.movableBox.innerBox.buttonsBox;this.positionLayout();},getToolbar:function getToolbar(){return this.toolbar;},setToolbarState:function setToolbarState(value){this.buttonsBox.set("state",value);},setToolbarButtonState:function setToolbarButtonState(buttonName,stateName,value){switch(buttonName){case this.EnumToolbarButtonType.DRILL:if(this.buttonsBox.drillButton){this.buttonsBox.drillButton.set(stateName,value);}break;case this.EnumToolbarButtonType.SINGLE_SELECT:this.buttonsBox.clickSelect.set(stateName,value);break;case this.EnumToolbarButtonType.RECTANGLE_SELECT:this.buttonsBox.rectangleSelect.set(stateName,value);break;case this.EnumToolbarButtonType.FREE_SELECT:if((buttonsToCreateFlag&this.EnumToolbarButtonType.FREE_SELECT)!=0){this.buttonsBox.freeSelect.set(stateName,value);}break;case this.EnumToolbarButtonType.CIRCLE_SELECT:if((buttonsToCreateFlag&this.EnumToolbarButtonType.CIRCLE_SELECT)!=0){this.buttonsBox.circleSelect.set(stateName,value);}break;case this.EnumToolbarButtonType.ZOOM:if((buttonsToCreateFlag&this.EnumToolbarButtonType.ZOOM)!=0){this.buttonsBox.zoomButton.set(stateName,value);}break;case this.EnumToolbarButtonType.EDIT_INFO_WINDOW:break;case this.EnumToolbarButtonType.CLEAR_ALL:this.buttonsBox.clearAll.set(stateName,value);break;case this.EnumToolbarButtonType.AFFINITY:if(this.buttonsBox.affinityLines){this.buttonsBox.affinityLines.set(stateName,value);}break;default:}}};})();