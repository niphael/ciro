(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.qb.QBuilderPage","mstrmojo.qb.QBuilderModel","mstrmojo.qb.RootController");var WAIT_BOX_ID="waitBox",waitBoxConfig={scriptClass:"mstrmojo.Editor",id:WAIT_BOX_ID,cssClass:"mstrmojo-Architect-WaitBox",draggable:false,showTitle:false,zIndex:99999,counter:0,displayMsg:null,ondisplayMsgChange:function ondisplayMsgChange(){this.msgfield.set("text",this.displayMsg);},oncounterChange:function oncounterChange(){var counter=this.counter,visible=this.visible;if(counter===0&&visible){this.close();}else{if(counter>0&&!visible){this.open();}}},children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-Architect-Wait"},{scriptClass:"mstrmojo.Label",alias:"msgfield",cssClass:"mstrmojo-Architect-Message",text:this.parent.displayMsg}]};mstrmojo.qb.QBApp=mstrmojo.declare(mstrmojo.Obj,null,{start:function start(){var controller=this.rootController=new mstrmojo.qb.RootController({model:new mstrmojo.qb.QBuilderModel({id:"QBuilderModel"}),rootView:new mstrmojo.qb.QBuilderPage({placeholder:this.placeholder})});controller.start();},getRootController:function getRootController(){return this.rootController;},showWait:function showWait(displayMsg){var waitBox=mstrmojo.all[WAIT_BOX_ID]||mstrmojo.insert(waitBoxConfig);waitBox.set("counter",waitBox.counter+1);waitBox.set("displayMsg",displayMsg||mstrmojo.desc(889,"Please wait..."));},hideWait:function hideWait(isForce){var waitBox=mstrmojo.all[WAIT_BOX_ID];if(waitBox){waitBox.set("counter",isForce?0:Math.max(0,waitBox.counter-1));}},redirectToPage:function redirectToPage(url){this.showWait();mstrmojo.form.send(url,mstrApp.name,"POST",null,null,false);},serverRequest:function serverRequest(callback,params,showWait,suppressError,displayMsg){if(showWait){this.showWait(displayMsg);}if(this.sessionState){params.sessionState=this.sessionState;}params.msgid=mstrApp.msgid;mstrmojo.xhr.request("POST",mstrConfig.taskURL,mstrmojo.func.wrapMethods(callback,{complete:function complete(res){if(showWait){mstrApp.hideWait();}},failure:function failure(res){if(!suppressError){var msg=res.getResponseHeader("X-MSTR-TaskFailureMsg");msg=(msg.length>2000)?msg.substring(0,2000)+"...":msg;mstrmojo.alert(msg.replace(/com\.microstrategy(\.\w+)*: \(?/,"").replace(/\)$/,""));}}}),params);}});}());