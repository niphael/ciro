(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Container","mstrmojo._IsPopup","mstrmojo.boxmodel","mstrmojo.css");var _B=mstrmojo.boxmodel,_D=mstrmojo.dom,_CURSOR_HEGIHT=20;function attScrll(o,me){var p=o&&o.parent;while(p){if(p.connectScrollbox){p.connectScrollbox(me);}p=p.parent;}}function detScrll(o,me){var p=o&&o.parent;while(p){if(p.disconnectScrollbox){p.disconnectScrollbox(me);}p=p.parent;}}var _position=function(me){if(me.visible){var ref=me.refNode,offset=ref?_B.offset(ref,document.body):{left:_D.getHorizontalScroll(),top:_D.getVerticalScroll()},s=me.domNode.style,c=me.containerNode,l=me.left,t=me.top,p=me.posType,T=mstrmojo.tooltip,p_r=(p===T.POS_TOPRIGHT)||(p===T.POS_BOTTOMRIGHT),p_b=(p===T.POS_BOTTOMLEFT)||(p===T.POS_BOTTOMRIGHT)||(p===T.POS_BOTTOMCENTER),offLeft=offset.left,offTop=offset.top,containerOffWidth=c.offsetWidth;if(l!==null){s.left=Math.max(parseInt(l,10)+offLeft-(p_r?(containerOffWidth):((p===T.POS_BOTTOMCENTER)?(containerOffWidth/2):0)),0)+"px";}if(t!==null){s.top=Math.max(parseInt(t,10)+offTop-((p_b)?(c.offsetHeight):0),0)+"px";}}};var _repaint=function(me){me.containerNode.className=("mstrmojo-Tooltip-content "+me.contentNodeCssClass);me.containerNode.style.cssText=me.contentNodeCssText;me.containerNode.innerHTML=me.content;if(!me.content){me.set("_tempVis",false);}else{me.set("_tempVis",true);}_position(me);if(me.optimizePos){me.optimizePos();}};function _dlyPaint(me){if(!me._dp){me._dp=window.setTimeout(function(){me._dp=null;_repaint(me);},50);}}var _update=function(me,w,e,win){var r=w&&(w.richTooltip||w.tooltip),mp=e?_D.getMousePosition(e,win||self):null,isStr=r&&(typeof (r)==="string"),l=isStr?null:(r&&r.left||0),t=isStr?null:(r&&r.top||0);me.set("contentNodeCssClass",isStr?"":(r&&r.contentNodeCssClass||""));me.set("contentNodeCssText",isStr?"":(r&&r.contentNodeCssText||""));me.set("content",(isStr)?r:(r&&r.content||""));me.set("refNode",isStr?null:r&&r.refNode||null);me.set("posType",isStr?1:r&&r.posType||1);me.set("left",(isStr||l===undefined||l===null)?(mp&&mp.x||me.left):l);me.set("top",(isStr||r===undefined||r===null)?(mp&&(mp.y+_CURSOR_HEGIHT)||me.top):t);};mstrmojo.Tooltip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup],{scriptClass:"mstrmojo.Tooltip",content:null,top:null,left:null,refNode:null,posType:1,markupString:'<div id="{@id}" class="mstrmojo-Tooltip {@cssClass}" style="{@cssText}"><div class="mstrmojo-Tooltip-shadow {@shadowNodeCssClass}"></div><div class="mstrmojo-Tooltip-content {@contentNodeCssClass}" style="{@contentNodeCssText}"></div></div>',markupSlots:{containerNode:function(){return this.domNode.lastChild;},shadowNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:function(){if(this.visible){var s=this.domNode.style;s.visibility="hidden";s.display="block";_position(this);s.visibility=this.content?"visible":"hidden";}else{this.domNode.style.display="none";}},on_tempVisChange:function(){this.domNode.style.visibility=this._tempVis?"visible":"hidden";},onleftChange:function(){_dlyPaint(this);},ontopChange:function(){_dlyPaint(this);},onrefNodeChange:function(){_dlyPaint(this);},onposTypeChange:function(){_dlyPaint(this);},oncontentNodeCssClassChange:function(){_dlyPaint(this);},oncontentNodeCssTextChange:function(){_dlyPaint(this);},oncontentChange:function(){_dlyPaint(this);}},preBuildRendering:function(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}if(this._super){this._super();}},_on_tooltip_change:function(evt){_update(this,evt&&evt.src);},_set_opener:function(n,v){var ov=this.opener;if((v!==ov)){if(v){attScrll(v,this);}if(ov){detScrll(ov,this);}if(ov&&ov.detachEventListener){ov.detachEventListener(this._richSubs);ov.detachEventListener(this._ttpSubs);}if(v&&v.attachEventListener){this._richSubs=v.attachEventListener("richTooltipChange",this.id,"_on_tooltip_change");this._ttpSubs=v.attachEventListener("tooltipChange",this.id,"_on_tooltip_change");}this.opener=v;return true;}return false;},updatePopupConfig:function(config,opener){_update(this,opener,config&&config.e,config&&config.win);},onscroll:function(){if(this.visible&&this.nudge){this.nudge();}}});var ttpInst=null;mstrmojo.tooltip={POS_TOPLEFT:1,POS_BOTTOMLEFT:2,POS_TOPRIGHT:3,POS_BOTTOMRIGHT:4,POS_BOTTOMCENTER:5,open:function(opener,e,win,config){if(!ttpInst||!mstrmojo.all[ttpInst.id]){ttpInst=new mstrmojo.Tooltip();}if(!config){config={};}config.e=e;config.win=win;ttpInst.open(opener,config);},close:function(){if(ttpInst){ttpInst.close();}}};})();