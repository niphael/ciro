mstrDECalculationImplScript=true;mstrDECalculationImpl.prototype=new mstrBoneImpl();mstrDECalculationImpl.prototype.srcShoppingCart=null;mstrDECalculationImpl.prototype.desShoppingCart=null;mstrDECalculationImpl.prototype.src=null;mstrDECalculationImpl.prototype.srcElmt=null;mstrDECalculationImpl.prototype.srcGroup=null;mstrDECalculationImpl.prototype.srcConstant=null;mstrDECalculationImpl.prototype.buttonAdd=null;mstrDECalculationImpl.prototype.buttonAddAll=null;mstrDECalculationImpl.prototype.buttonRemove=null;mstrDECalculationImpl.prototype.buttonRemoveAll=null;mstrDECalculationImpl.prototype.buttonUp=null;mstrDECalculationImpl.prototype.buttonDown=null;mstrDECalculationImpl.prototype.operator=null;mstrDECalculationImpl.prototype.srcTypePicker=null;mstrDECalculationImpl.prototype.previewContent=null;mstrDECalculationImpl.prototype.constantOperandsCount=false;mstrDECalculationImpl.SRC_ElEMENTS_SHOPPING_CART_ID="deElementSrc";mstrDECalculationImpl.SRC_GROUPS_SHOPPING_CART_ID="deGroupSrc";mstrDECalculationImpl.DES_SHOPPING_CART_ID="elementKeys";mstrDECalculationImpl.BUTTON_ADD_ID="de_tbAdd";mstrDECalculationImpl.BUTTON_ADDALL_ID="de_tbAddAll";mstrDECalculationImpl.BUTTON_REMOVE_ID="de_tbRemove";mstrDECalculationImpl.BUTTON_REMOVEALL_ID="de_tbRemoveAll";mstrDECalculationImpl.BUTTON_UP_ID="de_tbUp";mstrDECalculationImpl.BUTTON_DOWN_ID="de_tbDown";mstrDECalculationImpl.CONSTANT_FIELD_ID="de_cf";mstrDECalculationImpl.OPERATOR="operator";mstrDECalculationImpl.SRC_TYPE_ID="srcType";mstrDECalculationImpl.PREVIEW_CONTENT_ID="dePreviewContent";mstrDECalculationImpl.CONSTANT_OID="-1";mstrDECalculationImpl.SEPARATOR="~";mstrDECalculationImpl.prototype.currentOpType=null;mstrDECalculationImpl.ATTR_OPERATOR_TYPE="ty";mstrDECalculationImpl.OPERATOR_TYPE_BINARY="bi";mstrDECalculationImpl.OPERATOR_TYPE_FUNCTION="func";mstrDECalculationImpl.TYPE_CONSTANT="-1";mstrDECalculationImpl.TYPE_ELMT="1048576";mstrDECalculationImpl.TYPE_GROUP="48";mstrDECalculationImpl.TYPE_MAPPING={"1":mstrDECalculationImpl.TYPE_ELMT,"2":mstrDECalculationImpl.TYPE_GROUP,"-1":mstrDECalculationImpl.TYPE_CONSTANT};mstrDECalculationImpl.prototype.onpostload=function(e){try{this.initialized=false;this.initGuiComponents();this.initialized=true;mstrBoneImpl.prototype.onpostload.call(this,e);}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.initGuiComponents=function(){try{this.initOperator(microstrategy.findChildWithAtt(this.elem,"select","id",mstrDECalculationImpl.OPERATOR),(this.getSrcType()==mstrDECalculationImpl.TYPE_CONSTANT),(this.constantOperandsCount>0));if(!this.operator){return ;}this.srcTypePicker=new deSrcTypePicker(microstrategy.findChildWithAtt(this.elem,"div","id",mstrDECalculationImpl.SRC_TYPE_ID));this.initSrc();this.initDesShoppingCart(this,microstrategy.findChildWithAtt(this.elem,"select","id",mstrDECalculationImpl.DES_SHOPPING_CART_ID),this.operator.getCurrentOperatorType());var buttonImages=this.elem.getElementsByTagName("img");var addButtonElem=null;var removeButtonElem=null;var cfButtonElem=null;var addAllButtonElem=null;var removeAllButtonElem=null;for(var i=0;i<buttonImages.length;i++){if(buttonImages[i].className.indexOf("Right")>0){addButtonElem=buttonImages[i].parentNode;}else{if(buttonImages[i].className.indexOf("Left")>0){removeButtonElem=buttonImages[i].parentNode;}else{if(buttonImages[i].className.indexOf("AddAll")>0){addAllButtonElem=buttonImages[i].parentNode;}else{if(buttonImages[i].className.indexOf("RemoveAll")>0){removeAllButtonElem=buttonImages[i].parentNode;}}}}}this.buttonAdd=new deButton(addButtonElem,deButton.TYPE_ADD,mstrDECalculationImpl.BUTTON_ADD_ID,this.src,this.desShoppingCart,new Function("e","return microstrategy.bone('"+this.id+"').onAddButtonClick(e);"));this.buttonAddAll=new deButton(addAllButtonElem,deButton.TYPE_ADD_ALL,mstrDECalculationImpl.BUTTON_ADDALL_ID,this.src,this.desShoppingCart,new Function("e","return microstrategy.bone('"+this.id+"').onAddAllButtonClick(e);"));this.buttonRemove=new deButton(removeButtonElem,deButton.TYPE_REMOVE,mstrDECalculationImpl.BUTTON_REMOVE_ID,this.src,this.desShoppingCart,new Function("e","return microstrategy.bone('"+this.id+"').onRemoveButtonClick(e);"));this.buttonRemoveAll=new deButton(removeAllButtonElem,deButton.TYPE_REMOVE_ALL,mstrDECalculationImpl.BUTTON_REMOVEALL_ID,this.src,this.desShoppingCart,new Function("e","return microstrategy.bone('"+this.id+"').onRemoveAllButtonClick(e);"));this.buttonUp=new deButton(document.getElementById("de_tbUp"),deButton.TYPE_UP,mstrDECalculationImpl.BUTTON_UP_ID,this.src,this.desShoppingCart,new Function("e","return microstrategy.bone('"+this.id+"').onUpButtonClick(e);"));this.buttonDown=new deButton(document.getElementById("de_tbDown"),deButton.TYPE_DOWN,mstrDECalculationImpl.BUTTON_DOWN_ID,this.src,this.desShoppingCart,new Function("e","return microstrategy.bone('"+this.id+"').onDownButtonClick(e);"));this.previewContent=new dePreviewContent(this,microstrategy.findChildWithAtt(this.elem,"span","id",mstrDECalculationImpl.PREVIEW_CONTENT_ID));this.previewContent.onChange();if(this.operator&&this.operator.observer){this.operator.observer.register(mstrDECalculationImpl.DES_SHOPPING_CART_ID,this.desShoppingCart);this.operator.observer.register(mstrDECalculationImpl.SRC_TYPE_ID,this.srcTypePicker);this.operator.observer.register(mstrDECalculationImpl.PREVIEW_CONTENT_ID,this.previewContent);}if(this.src&&this.src.observer){this.src.observer.register(mstrDECalculationImpl.BUTTON_ADD_ID,this.buttonAdd);this.src.observer.register(mstrDECalculationImpl.BUTTON_ADDALL_ID,this.buttonAddAll);}if(this.desShoppingCart&&this.desShoppingCart.observer){this.desShoppingCart.observer.register(mstrDECalculationImpl.BUTTON_ADD_ID,this.buttonAdd);this.desShoppingCart.observer.register(mstrDECalculationImpl.BUTTON_ADDALL_ID,this.buttonAddAll);this.desShoppingCart.observer.register(mstrDECalculationImpl.BUTTON_REMOVE_ID,this.buttonRemove);this.desShoppingCart.observer.register(mstrDECalculationImpl.BUTTON_REMOVEALL_ID,this.buttonRemoveAll);this.desShoppingCart.observer.register(mstrDECalculationImpl.PREVIEW_CONTENT_ID,this.previewContent);this.desShoppingCart.observer.register(mstrDECalculationImpl.OPERATOR,this.operator);}if(this.srcTypePicker&&this.srcTypePicker.observer){this.srcTypePicker.observer.register(mstrDECalculationImpl.OPERATOR,this.operator);}}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.initDesShoppingCart=function(parent,elem,operatorType){try{var firstOption=elem.options[0];if(firstOption&&firstOption.value=="-none-"){elem.remove(0);}this.desShoppingCart=new deDesCart(parent,elem);this.desShoppingCart.setCartLimit(operatorType);elem.ondblclick=new Function("e","return microstrategy.bone('"+this.id+"').onRemoveButtonClick(e);");}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.initOperator=function(elem,isSrcTypeConstant,hasConstantOperands){try{if(!elem){this.operator=null;return ;}this.operator=new deOperator(elem,isSrcTypeConstant,hasConstantOperands);this.operator.update();this.operator.elem.onchange=new Function("e","return microstrategy.bone('"+this.id+"').changeOperator();");}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.onUpButtonClick=function(e){try{MoveItemInSelectedList("elementKeys","Up","elementList");BuildFilterSelections("elementList","elementKeys");this.desShoppingCart.observer.notifyAll("ondeschange");}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.onDownButtonClick=function(e){try{MoveItemInSelectedList("elementKeys","Down","elementList");BuildFilterSelections("elementList","elementKeys");this.desShoppingCart.observer.notifyAll("ondeschange");}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.onAddButtonClick=function(e){try{if(this.desShoppingCart.cartLimit!=deCart.CART_NO_LIMIT&&this.desShoppingCart.getSize()>=this.desShoppingCart.cartLimit){return ;}if(this.getSrcType()==mstrDECalculationImpl.TYPE_CONSTANT){var outerEditor=microstrategy.findAncestorWithAtt(this.elem,microstrategy.HTMLATTR_OBJTYPE,"dialog");if(outerEditor){var editor=microstrategy.findBone(outerEditor);if(!editor.validateSingleInput(this.srcConstant.elem)){return true;}}}var selectedItem=this.src.remove();if(selectedItem!=null){this.desShoppingCart.add(selectedItem,true);}}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.onAddAllButtonClick=function(e){try{var srcSize=(this.src&&this.src.getSize()>0&&this.src.elem.options)?this.src.getSize():0;if(this.desShoppingCart.cartLimit!=deCart.CART_NO_LIMIT){return ;}for(var i=0;i<srcSize-1;i++){var selectedItem=this.src.remove();this.desShoppingCart.add(selectedItem,false);}this.onAddButtonClick();}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.addItemToSrc=function(item){try{var itemType=this.srcElmt.getItemType(item);if(itemType==mstrDECalculationImpl.TYPE_CONSTANT){return ;}if(itemType==mstrDECalculationImpl.TYPE_ELMT){this.srcElmt.add(item,true);}else{if(itemType==mstrDECalculationImpl.TYPE_GROUP){this.srcGroup.add(item,true);}}}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.onRemoveButtonClick=function(e){try{var selectedItem=this.desShoppingCart.remove();this.addItemToSrc(selectedItem);}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.onRemoveAllButtonClick=function(e){try{while(this.desShoppingCart&&this.desShoppingCart.getSize()>0){this.onRemoveButtonClick(e);}}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.changeOperator=function(){try{var oldType=this.currentOpType;this.currentOpType=this.operator.getCurrentOperatorType();this.operator.observer.notifyAll("onOperatorChange","'"+this.currentOpType+"', '"+oldType+"'");if(oldType!=this.currentOpType){if(oldType==mstrDECalculationImpl.OPERATOR_TYPE_FUNCTION&&this.currentOpType==mstrDECalculationImpl.OPERATOR_TYPE_BINARY){this.onRemoveAllButtonClick();}}}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.getSrcType=function(){try{if(this.srcType){return mstrDECalculationImpl.TYPE_MAPPING[this.srcType];}return null;}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.getOperator=function(){try{return(this.operator)?this.operator.getOperatorAsString():null;}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.getOperand=function(index){try{return(this.desShoppingCart)?this.desShoppingCart.getItemAsString(index):"";}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.getFuncArgs=function(){try{return(this.desShoppingCart)?this.desShoppingCart.getAllItemNames():null;}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.initSrc=function(){try{var cartElem=microstrategy.findChildWithAtt(this.elem,"select","id",mstrDECalculationImpl.SRC_ElEMENTS_SHOPPING_CART_ID);cartElem.ondblclick=new Function("e","return microstrategy.bone('"+this.id+"').onAddButtonClick(e);");this.srcElmt=new deSrcElmtCart(this,cartElem);var cartGroup=microstrategy.findChildWithAtt(this.elem,"select","id",mstrDECalculationImpl.SRC_GROUPS_SHOPPING_CART_ID);cartGroup.ondblclick=new Function("e","return microstrategy.bone('"+this.id+"').onAddButtonClick(e);");this.srcGroup=new deSrcGroupCart(this,cartGroup);this.srcConstant=new deConstantField(microstrategy.findChildWithAtt(this.elem,"input","id",mstrDECalculationImpl.CONSTANT_FIELD_ID));this.srcConstant.elem.onkeyup=new Function("e","return microstrategy.bone('"+this.id+"').onConstantChange(e);");this.srcConstant.elem.setAttribute(mstrHTMLAttributes.ATTR_DTY,"2");this.srcConstant.elem.setAttribute(mstrHTMLAttributes.ATTR_FLD,microstrategy.descriptors.getDescriptor("1012"));switch(this.getSrcType()){case mstrDECalculationImpl.TYPE_ELMT:this.src=this.srcElmt;break;case mstrDECalculationImpl.TYPE_GROUP:this.src=this.srcGroup;break;case mstrDECalculationImpl.TYPE_CONSTANT:this.src=this.srcConstant;break;}}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.onConstantChange=function(){try{if(this.src&&this.src.onfieldchange){this.src.onfieldchange();}}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.changeSrcType=function(srcType){try{if(srcType==this.srcType){return false;}var oldSrcType=this.srcType;this.srcType=srcType;this.srcTypePicker.update(oldSrcType,this.srcType);var otype=this.getSrcType();this.hideAll();switch(otype){case mstrDECalculationImpl.TYPE_ELMT:displayObj(document.getElementById("desearch"));displayObj(document.getElementById("deElmt"));break;case mstrDECalculationImpl.TYPE_GROUP:displayObj(this.srcGroup.elem);break;case mstrDECalculationImpl.TYPE_CONSTANT:displayObj(this.srcConstant.elem);break;}if(this.src&&this.src.observer){this.src.observer.unregisterAll();switch(mstrDECalculationImpl.TYPE_MAPPING[srcType]){case mstrDECalculationImpl.TYPE_ELMT:this.src=this.srcElmt;this.buttonAdd.srcCart=this.src;this.buttonAddAll.srcCart=this.src;this.buttonRemove.srcCart=this.src;this.buttonRemoveAll.srcCart=this.src;break;case mstrDECalculationImpl.TYPE_GROUP:this.src=this.srcGroup;this.buttonAdd.srcCart=this.src;this.buttonAddAll.srcCart=this.src;this.buttonRemove.srcCart=this.src;this.buttonRemoveAll.srcCart=this.src;break;case mstrDECalculationImpl.TYPE_CONSTANT:this.src=this.srcConstant;this.buttonAdd.srcCart=this.src;break;}this.src.observer.register(mstrDECalculationImpl.BUTTON_ADD_ID,this.buttonAdd);this.src.observer.register(mstrDECalculationImpl.BUTTON_ADDALL_ID,this.buttonAddAll);if(this.src&&this.src.observer){this.src.observer.notifyAll("onsrcchange",this.src.getSize());}}}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.hideAll=function(){try{var desearch=document.getElementById("desearch");if(desearch){removeObj(desearch);}var deElmtSrc=document.getElementById("deElmt");if(deElmtSrc){removeObj(deElmtSrc);}removeObj(this.srcGroup.elem);removeObj(this.srcConstant.elem);}catch(err){microstrategy.errors.log(err);return false;}};mstrDECalculationImpl.prototype.updateOperator=function(){if(this.operator){this.operator.update((this.getSrcType()==mstrDECalculationImpl.TYPE_CONSTANT),this.constantOperandsCount>0);}};function mstrDECalculationImpl(id){this.inherits=mstrBoneImpl;this.inherits(id);delete this.inherits;return this;}deCart.prototype=new Object();deCart.prototype.observer=null;deCart.prototype.cartLimit=-1;deCart.CART_NO_LIMIT=-1;deCart.prototype.getItemType=function(item){var itemTypeInfo=item.value;var itemType=null;if(itemTypeInfo!=null&&itemTypeInfo.length>0){var infos=itemTypeInfo.split("~");itemType=infos[1];}return itemType;};deCart.prototype.getItemAsString=function(index){if(this.elem&&this.elem.options&&this.elem.options.length>0&&this.elem.options[index]){return this.elem.options[index].text;}return"";};deCart.prototype.getAllItemNames=function(){if(this.elem&&this.elem.options&&this.elem.options.length>0){var oNames=new Array();var options=this.elem.options;for(var i=0;i<options.length;i++){oNames.push(options[i].text);}return oNames;}return null;};deCart.prototype.getSize=function(){return(this.elem.options)?this.elem.options.length:0;};deCart.prototype.addOperandsPlaceHolder=function(){if(this.placeholders==null){this.placeholders=new Array();for(var i=0;i<2;i++){var option=new Option("*Add Value "+(i+1),"",false,false);this.placeholders.push(option);}}if(this.type==deCart.CART_TYPE_DES){for(var j=0;j<this.placeholders.length;j++){this.elem.options.add(this.placeholders[j]);}}this.elem.className="emptyBinary";};deCart.prototype.removeOperandsPlaceHolder=function(){this.elem.className="";if(this.placeholders==null||(this.elem.options==null||this.elem.options.length==0)){return ;}if(this.type==deCart.CART_TYPE_DES){for(var j=0;j<this.placeholders.length;j++){this.elem.removeChild(this.placeholders[j]);}}};deCart.prototype.remove=function(){var item=null;var availableOptions=this.elem.options;if(availableOptions&&availableOptions.length>0){var itemIndex=(this.elem.selectedIndex>-1)?this.elem.selectedIndex:0;item=availableOptions[itemIndex];var nextIndex=(itemIndex<availableOptions.length-1)?(itemIndex+1):0;if(availableOptions.length>1){availableOptions[nextIndex].selected=true;}item.selected=false;this.elem.remove(itemIndex);if(this.observer){this.observer.notifyAll("onsrcchange",availableOptions.length);}}return item;};function deCart(parent,elem){if(elem){this.elemDiv=elem.parentNode;}this.elem=elem;this.observer=new mstrDeObserverImpl();this.parentBone=parent;return this;}mstrDeObserverImpl.prototype=new mstrObserverImpl();mstrDeObserverImpl.prototype.register=function(id,obj){if(typeof (this.items[id])=="undefined"){this.items[id]=obj;}return true;};mstrDeObserverImpl.prototype.unregisterAll=function(){for(var id in this.items){this.unregister(id);}return true;};mstrDeObserverImpl.prototype.notifyAll=function(eventName,arga){try{for(var member in this.items){var obj=this.items[member];if(eval("obj."+eventName)){eval("obj."+eventName+"("+arga+")");}}return true;}catch(err){microstrategy.errors.log(err);return false;}};function mstrDeObserverImpl(){this.items=new Object();return this;}deButton.prototype=new Object();deButton.prototype.onclickevent=null;deButton.TYPE_ADD="add";deButton.TYPE_ADD_ALL="addall";deButton.TYPE_REMOVE="remove";deButton.TYPE_REMOVE_ALL="removeall";deButton.TYPE_UP="up";deButton.TYPE_DOWN="down";deButton.prototype.disableButton=function(){if(this.onclickevent==null){this.onclickevent=this.elem.onclick;}this.elem.onclick=null;var newClassName=this.elem.firstChild.className;if(newClassName&&newClassName.indexOf("Disabled")<0){this.elem.firstChild.className=newClassName+"Disabled";}};deButton.prototype.enableButton=function(){if(this.onclickevent){this.elem.onclick=this.onclickevent;}var newClassName=this.elem.firstChild.className;if(newClassName&&newClassName.indexOf("Disabled")>=0){this.elem.firstChild.className=newClassName.substring(0,newClassName.indexOf("Disabled"));}};deButton.prototype.updateButtonState=function(){switch(this.type){case deButton.TYPE_ADD:if(this.srcCart.getSize()>0&&(this.desCart.getSize()<this.desCart.cartLimit||this.desCart.cartLimit==-1)){this.enableButton();}else{this.disableButton();}break;case deButton.TYPE_ADD_ALL:if(this.srcCart.getSize()>0&&this.desCart.cartLimit==-1){this.enableButton();}else{this.disableButton();}break;case deButton.TYPE_REMOVE:case deButton.TYPE_REMOVE_ALL:if(this.desCart.getSize()<=0){this.disableButton();}else{this.enableButton();}break;}};deButton.prototype.onsrcchange=function(cartOptionLength){this.updateButtonState();};deButton.prototype.onDesCartLimitchange=function(cartOptionLength,desLimit){this.updateButtonState();};deButton.prototype.ondeschange=function(cartOptionLength){this.updateButtonState();};function deButton(elem,type,id,srcCart,desCart,onclickEvent){this.elem=elem;this.type=type;this.srcCart=srcCart;this.desCart=desCart;if(id){this.elem.setAttribute("id",id);}this.onclickevent=onclickEvent;this.ondeschange();}deOperator.prototype=new Object();deOperator.prototype.observer=null;deOperator.prototype.isSrcTypeConstant=false;deOperator.prototype.hasConstantOperand=false;deOperator.prototype.getCurrentOperatorType=function(){var selectedOption=this.elem.options[this.elem.selectedIndex];if(selectedOption){return selectedOption.getAttribute(mstrDECalculationImpl.ATTR_OPERATOR_TYPE);}return null;};deOperator.prototype.getOperatorAsString=function(i){var selectedOption=this.elem.options[this.elem.selectedIndex];if(selectedOption){return selectedOption.text;}return null;};deOperator.prototype.displayOptions=function(optionType,show){return ;var allOptions=this.elem.options;for(var i=0;i<allOptions.length;i++){if(allOptions[i]){var otype=allOptions[i].getAttribute("ty");if(otype==optionType||optionType=="all"){allOptions[i].style.display=(show)?"":"none";}}}};deOperator.prototype.update=function(){return ;};deOperator.prototype.onSrcTypeChange=function(isSrcTypeConstant){this.isSrcTypeConstant=isSrcTypeConstant;this.update();};deOperator.prototype.ondesoperandchange=function(hasConstantOperand){this.hasConstantOperand=hasConstantOperand;this.update();};function deOperator(elem,isSrcTypeConstant,hasConstantOperand){this.elem=elem;this.observer=new mstrDeObserverImpl();this.isSrcTypeConstant=isSrcTypeConstant;this.hasConstantOperand=hasConstantOperand;return this;}deSrcTypePicker.prototype=new Object();deSrcTypePicker.TYPE_ELEMENT="1";deSrcTypePicker.TYPE_GROUP="2";deSrcTypePicker.TYPE_CONSTANT="-1";deSrcTypePicker.TYPE_MAPPING={"1":mstrDECalculationImpl.TYPE_ELMT,"2":mstrDECalculationImpl.TYPE_GROUP,"-1":mstrDECalculationImpl.TYPE_CONSTANT};deSrcTypePicker.prototype.displayLink=function(srcType,on){var olink=microstrategy.findChildWithAtt(this.elem,"span","type",srcType);if(olink){olink.style.visibility=(on)?"visible":"hidden";}};deSrcTypePicker.prototype.onOperatorChange=function(operatorType){return ;};deSrcTypePicker.prototype.update=function(prevSrcType,srcType){var selectedLink=microstrategy.findChildWithAtt(this.elem,"span","type",srcType);if(selectedLink){selectedLink.className="selected";}var prevLink=microstrategy.findChildWithAtt(this.elem,"span","type",prevSrcType);if(prevLink){prevLink.className="";}if(this.observer){this.observer.notifyAll("onSrcTypeChange",(srcType==mstrDECalculationImpl.TYPE_CONSTANT));}};function deSrcTypePicker(elem){this.elem=elem;this.observer=new mstrDeObserverImpl();return this;}dePreviewContent.prototype=new Object();dePreviewContent.prototype.operator="";dePreviewContent.prototype.operand1="";dePreviewContent.prototype.operand2="";dePreviewContent.prototype.funcArgs=null;dePreviewContent.prototype.parentBone=null;dePreviewContent.BINARY_OPERATORS="+,-,*,/";dePreviewContent.prototype.onChange=function(){this.operator=this.parentBone.getOperator();if(dePreviewContent.BINARY_OPERATORS.indexOf(this.operator)>=0){this.operand1=this.parentBone.getOperand(0);this.operand2=this.parentBone.getOperand(1);}else{this.funcArgs=this.parentBone.getFuncArgs();}this.buildPreview();};dePreviewContent.prototype.buildPreview=function(){var fmr="";if(dePreviewContent.BINARY_OPERATORS.indexOf(this.operator)>=0){fmr=this.operand1+" "+this.operator+" "+this.operand2;}else{var args=(this.funcArgs&&this.funcArgs.length>0)?this.funcArgs.join(",  "):"";fmr=this.operator+" ("+args+")";}this.elem.innerHTML=fmr;};dePreviewContent.prototype.onOperatorChange=function(){this.onChange();};dePreviewContent.prototype.ondeschange=function(){this.onChange();};function dePreviewContent(parent,elem){this.elem=elem;this.parentBone=parent;}deSrcElmtCart.prototype=new deCart;deSrcElmtCart.prototype.add=function(item,notify){if(item.tagName.toLowerCase()=="option"){if(item&&item.value=="-none-"){return ;}this.elem.options.add(item);if(notify){if(this.observer){this.observer.notifyAll("onsrcchange",this.elem.options.length);}}}};function deSrcElmtCart(parent,elem){this.inherits=deCart;this.inherits(parent,elem);delete this.inherits;this.orgSrcCart=this.elemDiv.innerHTML;return this;}deSrcGroupCart.prototype=new deCart;deSrcGroupCart.prototype.remove=function(){var item=deCart.prototype.remove.call(this);if(item){this.orgSrcCart=this.elemDiv.innerHTML;}return item;};deSrcGroupCart.prototype.add=function(item,notify){if(item.tagName.toLowerCase()=="option"){if(item&&item.value=="-none-"){return ;}for(var i=0;i<this.elem.options.length;i++){if(this.elem.options[i].text==item.text){return ;}}this.elem.options.add(item);if(notify){if(this.observer){this.observer.notifyAll("onsrcchange",this.elem.options.length);}}this.orgSrcCart=this.elemDiv.innerHTML;}};function deSrcGroupCart(parent,elem){this.inherits=deCart;this.inherits(parent,elem);delete this.inherits;return this;}deConstantField.prototype=new Object();deConstantField.prototype.observer=null;deConstantField.prototype.getValue=function(){return this.elem.value;};deConstantField.prototype.clear=function(){this.elem.value="";};deConstantField.prototype.show=function(){this.elem.parentNode.style.visibility="visible";};deConstantField.prototype.hide=function(){this.elem.parentNode.style.visibility="hidden";};deConstantField.prototype.getSize=function(){return(isNaN(parseFloat(this.getValue())))?0:1;};deConstantField.prototype.ondesremove=function(){};deConstantField.prototype.remove=function(){if(!this.getValue()){return null;}var oValue=mstrDECalculationImpl.CONSTANT_OID+mstrDECalculationImpl.SEPARATOR+mstrDECalculationImpl.TYPE_CONSTANT+mstrDECalculationImpl.SEPARATOR+this.getValue();var oOption=new Option(this.getValue(),oValue,false,false);this.clear();return oOption;};deConstantField.prototype.onfieldchange=function(){if(this.observer){this.observer.notifyAll("onsrcchange",this.getSize());}};function deConstantField(elem){this.elem=elem;this.observer=new mstrDeObserverImpl();return this;}deDesCart.prototype=new deCart;deDesCart.prototype.onOperatorChange=function(operatorType,prevOpType){if(operatorType!=prevOpType){this.setCartLimit(operatorType);}};deDesCart.prototype.add=function(item,notify){if(item.tagName.toLowerCase()=="option"){if(item&&item.value=="-none-"){return ;}this.elem.options.add(item);if(this.getItemType(item)==mstrDECalculationImpl.TYPE_CONSTANT){this.parentBone.constantOperandsCount++;}if(notify){if(this.observer){this.observer.notifyAll("ondeschange",this.elem.options.length);this.observer.notifyAll("ondesoperandchange",(this.parentBone.constantOperandsCount>0));}BuildFilterSelections("elementList","elementKeys");}}};deDesCart.prototype.remove=function(){var item=null;var availableOptions=this.elem.options;if(availableOptions&&availableOptions.length>0){var itemIndex=(this.elem.selectedIndex>-1)?this.elem.selectedIndex:0;item=availableOptions[itemIndex];if(this.getItemType(item)==mstrDECalculationImpl.TYPE_CONSTANT){this.parentBone.constantOperandsCount--;}var nextIndex=(itemIndex<availableOptions.length-1)?(itemIndex+1):0;if(availableOptions.length>1){availableOptions[nextIndex].selected=true;}item.selected=false;this.elem.remove(itemIndex);if(this.observer){this.observer.notifyAll("ondeschange",availableOptions.length);this.observer.notifyAll("ondesoperandchange",(this.parentBone.constantOperandsCount>0));}BuildFilterSelections("elementList","elementKeys");}return item;};deDesCart.prototype.setCartLimit=function(operatorType){switch(operatorType){case mstrDECalculationImpl.OPERATOR_TYPE_BINARY:this.changeCartLimit(2);break;case mstrDECalculationImpl.OPERATOR_TYPE_FUNCTION:this.changeCartLimit(deCart.CART_NO_LIMIT);break;default:break;}};deDesCart.prototype.changeCartLimit=function(limit){this.cartLimit=limit;if(this.observer){this.observer.notifyAll("onDesCartLimitchange",this.elem.options.length+","+limit);}};function deDesCart(parent,elem){this.inherits=deCart;this.inherits(parent,elem);delete this.inherits;return this;}