(function(){mstrmojo.StringBuffer=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.StringBuffer",append:function A(C){if(!this.buf){this.reset();}this.buf[++this.len]=C;return this;},reset:function B(){this.buf=[];this.len=-1;}});mstrmojo.StringBuffer.prototype.toString=function(D){var C=this.buf;return(C&&C.join(D||""))||"";};})();mstrmojo.mstr.EnumWebAPIErrorCodes={MSI_INBOX_MSG_NOT_FOUND:-2147468986,E_MSI_USERMGR_USER_NOTFOUND:-2147209051,AUTHEN_E_LOGIN_FAIL_EXPIRED_PWD:-2147216963,AUTHEN_E_LOGIN_FAILED_NEW_PASSWORD_REQD:-2147216960,AUTHEN_E_LOGIN_FAIL:-2147216959,E_UNUSED:4294967295};(function(){mstrmojo.requiresCls("mstrmojo.StringBuffer","mstrmojo.hash");var B="AndroidServerTransport";mstrmojo.android.AndroidServerTransport={serverRequest:function A(I,H,F){var E=new mstrmojo.StringBuffer(),G,D;mstrmojo.hash.forEach(F.params,function(J,K){E.append(K+"="+encodeURIComponent(J));});G=F.taskURL+"?"+E.toString("&");F.params.hostUrl=F.taskURL;if(mstrApp.useBinaryFormat){D=JSON.stringify({params:F.params,url:G});}else{D=G;}$MAPF(true,B,"transportRequest");mstrMobileTransport.serverRequest(I,H,D,"response","progress");},cancelRequest:function C(D){$MAPF(false,B,"transportRequest");return mstrMobileTransport.cancelRequest(D);}};})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.func","mstrmojo.Obj");var D=mstrmojo.hash;var E=0;var M=[];var P={};var B=false;function H(R){var S=R.callback;if(S.submission){S.submission(this.userInteractionRequired(R));}this.submitRequest(R);}function K(){if(M.length&&!B){H.call(this,M.shift());}}mstrmojo.ServerProxy=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ServerProxy",transport:null,cnt:0,request:function I(b,Y,S,T){if(S){this.cancelRequests();}var V=this.id,W=this.transport,R=mstrmojo.now()+Y.taskId+E++,U=b.canceled||mstrmojo.emptyFn;b.canceled=function(c){U();b.complete(true);return W.cancelRequest(c);};b=mstrmojo.func.wrapMethods(b,{complete:function(c){mstrmojo.all[V].deleteRequest(c);}});var X=!D.isEmpty(this._requests),Z=this.createRequest(R,b,Y,T),a=(B||X)&&!T.doNotHold;if(a){M.push(Z);}else{H.call(this,Z);}},createRequest:function C(U,W,V,R){var S=this._requests;if(!S){S=this._requests={};}var T=S[U]={id:U,callback:W,params:V,config:R};return T;},submitRequest:function F(R){this.transport.serverRequest(this.id,R.id,R);},cancelRequests:function O(){var R=false;D.forEach(this._requests,function(S){if(typeof S.gotResponse==="undefined"){R|=S.callback.canceled(S.id);}});this._requests={};M=[];return R;},response:function G(V,R,T){$MAPF(false,"AndroidServerTransport","transportRequest");var U=this.getRequest(V);if(U){U.gotResponse=true;var W=U.callback,S=(R&&!T.mstrerr)?"success":"failure";try{if(W[S]){W[S](T,U);}}finally{W.complete(V);}}K.call(this);},deleteRequest:function Q(S){var R=this._requests;delete R[S];},getRequest:function A(S){var R=this._requests;return R&&R[S];},userInteractionRequired:function L(R){return false;},addLoadingGraph:function J(R){P[R]=true;B=true;},removeLoadingGraph:function N(R){delete P[R];if(D.isEmpty(P)){B=false;K.call(this);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var G=mstrmojo.dom;function C(I){if(I.hasChildNodes()){while(I.childNodes.length>=1){I.removeChild(I.firstChild);}}}function F(S,L){var K=this.getPages.call(this),N=K.current,O=K.next,Q=this;var J=0,M=0,P=0,I=0,R=O.offsetWidth;if(S.an===this.ANIMATION_FORWARD){I=-R;M=R;}else{P=-R;J=R;}G.translate(N,J,0,0);G.translate(O,M,0,0);B(P,I,L,{target:Q.sliderNode,duration:L,onEnd:function(){Q.finishTurn.call(Q);},preStart:function(){this.target.style.overflowY="hidden";}});}function B(M,J,L,K){var I=mstrmojo.hash.copy(K,{props:{left:{isStyle:true,start:M,stop:J,suffix:"px",ease:mstrmojo.ease.linear}},duration:L});(new mstrmojo.fx.AnimateProp(I)).play();}mstrmojo.winphone._IsMobileBookletWinPhone={_mixinName:"mstrmojo.winphone._IsMobileBookletWinPhone",cleanCurrentPage:function A(I){C(I);},turnPageAnimation:function E(I,K,J){F.call(this,K,500);},moveNextView:function D(J,I){},hideMessage:function H(){var I=this.msg.domNode;(new mstrmojo.fx.FadeOut({target:I})).play();mstrmojo.css.parkAfterFade({target:I});}};}());(function(){mstrmojo.requiresCls("mstrmojo.android.medium.RootView","mstrmojo.winphone._IsMobileBookletWinPhone");mstrmojo.winphone.RootView=mstrmojo.declare(mstrmojo.android.medium.RootView,[mstrmojo.winphone._IsMobileBookletWinPhone],{scriptClass:"mstrmojo.winphone.RootView"});})();(function(){mstrmojo.requiresCls("mstrmojo.MobileDoc","mstrmojo.winphone._IsMobileBookletWinPhone");mstrmojo.winphone.MobileDoc=mstrmojo.declare(mstrmojo.MobileDoc,[mstrmojo.winphone._IsMobileBookletWinPhone],{scriptClass:"mstrmojo.winphone.RootView"});})();(function(){mstrmojo.requiresCls("mstrmojo.android.medium.ViewFactory","mstrmojo.winphone.MobileDoc");mstrmojo.winphone.ViewFactory=mstrmojo.declare(mstrmojo.android.medium.ViewFactory,null,{scriptClass:"mstrmojo.winphone.ViewFactory",newRootView:function A(B){return new mstrmojo.winphone.RootView(B);},mobileDoc:mstrmojo.winphone.MobileDoc});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.css","mstrmojo.hash");var H=mstrmojo.css,D=mstrmojo.hash,B="glow";var F=mstrmojo.android.ui.Button=mstrmojo.declare(mstrmojo.Button,[mstrmojo._TouchGestures],{scriptClass:"mstrmojo.android.ui.Button",onclick:mstrmojo.emptyFn,touchBegin:function E(){if(this.enabled){H.addClass(this.domNode,B);}},touchTap:function C(J){if(this.enabled){this.onclick({e:J.evt});}},touchSelectBegin:mstrmojo.emptyFn,touchSelectEnd:function A(J){if(this.enabled){this.onclick({e:J.evt});}},touchEnd:function I(){H.removeClass(this.domNode,B);}});F.prototype.markupString=F.prototype.markupString.replace(new RegExp(" mstrAttach:[a-zA-Z,]*"),"");F.newButton=function G(M,L,K){var J={scriptClass:"mstrmojo.android.ui.Button",text:M};if(L){J.onclick=L;}D.copy(K,J);return J;};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.css","mstrmojo.TextBox");mstrmojo.TextBoxWithLabel=mstrmojo.declare(mstrmojo.TextBox,null,{scriptClass:"mstrmojo.TextBoxWithLabel",label:"",rightLabel:"",cssDisplay:"inline",type:"text",markupString:'<div class="mstrmojo-TextBoxWithLabel {@cssClass}" style="{@cssText}"><span class="mstrmojo-TextBox-label">{@label}</span><input id="{@id}" class="mstrmojo-TextBox {@inputNodeCssClass}"  style="{@inputNodeCssText}" title="{@tooltip}" type="{@type}" value="{@value}" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keyup,blur /><span class="mstrmojo-TextBox-label-right">{@rightLabel}</span></div>',markupSlots:{inputNode:function(){return this.domNode.firstChild.nextSibling;}},preBuildRendering:function(){this.markupMethods=mstrmojo.hash.copy({onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";},oncssClassChange:function(){this.domNode.className="mstrmojo-TextBoxWithLabel "+(this.cssClass||"");}},mstrmojo.hash.copy(this.markupMethods));}});})();(function(){mstrmojo.requiresCls("mstrmojo.ServerProxy","mstrmojo.android.ui.Button","mstrmojo.Box","mstrmojo.TextBoxWithLabel","mstrmojo.Label","mstrmojo.hash","mstrmojo.mstr.EnumWebAPIErrorCodes");mstrmojo.requiresDescs(11,17,18,26,7904,5088,9935,10672);var D="mobileLogin",Z="changePassword",a=mstrmojo.android.ui.Button.newButton,N=mstrmojo.desc,W=mstrmojo.hash,g=mstrmojo.mstr.EnumWebAPIErrorCodes,C={},c={},A={ANDROID_PHONE:3,ANDROID_TAB:4},H={OLD_PASSWORD:0,NEW_PASSWORD:1,CONFIRM_NEW_PASSWORD:2},P={};function V(l){var k=this,h=l.pid,j=l.params.projectID,m=l.id,i=C[h],j=l.params.projectID,n={taskId:"getProjectSettings"};if(i){n.sessionState=i;}else{n.projectID=j;}mstrApp.serverRequest(n,{success:function(o){P[h]=true;k.transport.serverRequest(k.id,m,l);},failure:function(o){var p=l.callback;if(p.failure!==undefined){p.failure(o);}p.complete(m);}},{skipLogin:true,doNotHold:true});}function M(m){var k=String(mstrMobileApp.getLocaleInfo());if(k){var l=k.split(",");for(var j=0;j<l.length;j++){var h=l[j].split(":");m[h[0]]=h[1];}}return m;}function f(n,h){var l,j=[],k={id:"new_pwd_reqd",title:N(5088),cssClass:"mstrmojo-CredentialsDialog",loginInfo:n.loginInfo},i=n.loginInfo,m=function(o,q){return function(){q(o);};}(n,h);j.push({scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-PasswordDialog-Label",text:"You must supply a new password."});k.children=j;k.buttons=[a(N(221,"Cancel"),function(){l.manualClose=true;mstrApp.cancelPending();}),a(N(1442,"OK"),m,{enabled:true})];l=mstrApp.showDialog(k);}function d(o,h){var m,l,j=[],k={id:"password_prompt"+mstrmojo.now(),title:o.title,cssClass:"mstrmojo-CredentialsDialog",loginInfo:o.loginInfo},i=o.loginInfo,n=function(q,r){return function(){var s=m.children,p=s[0].children[0];switch(q.dlgType){case H.OLD_PASSWORD:i.pwd=p.value;break;case H.NEW_PASSWORD:i.npwd=p.value;break;}r(q);};}(o,h);l=mstrmojo.getInstance(a(N(1442,"OK"),n,{enabled:o.enableOK}));j.push({scriptClass:"mstrmojo.Box",cssDisplay:"table",children:[{scriptClass:"mstrmojo.TextBoxWithLabel",label:N(18)+":",value:"",type:"password",cssDisplay:"table-row",onvalueChange:function(){if(o.dlgType==H.CONFIRM_NEW_PASSWORD){l.set("enabled",this.value==i.npwd);}}}]});k.children=j;k.buttons=[a(N(221,"Cancel"),function(){mstrApp.cancelPending();}),l];m=mstrApp.showDialog(k);}function L(k){var h=this._mobileCfg,i=k.pid,m=h.getProject(i),l={cfg:h,projectId:i,project:m,transport:this.transport,loginInfo:h.getLoginInfo(i)},j=this;mstrApp.hideMessage();l.loginInfo.uid=k.params.userid;f(l,function(n){d(W.copy({title:"Enter your old password",dlgType:H.OLD_PASSWORD,enableOK:true},n),function(o){d(W.copy({title:"Enter your new password",dlgType:H.NEW_PASSWORD,enableOK:true},o),function(p){d(W.copy({title:"Confirm your new password",dlgType:H.CONFIRM_NEW_PASSWORD,enableOK:(p.loginInfo.npwd=="")},p),function(r){var q=function(t){return function(w){var u=t.loginInfo,y=u.npwd,v=u.uid;if(m.udc){var x=h.getServerByProjectId(i);x.pdc.ps=y;x.pdc.lo=v;}else{m.pc.ps=y;m.pc.lo=v;}h.saveConfiguration();k.params.password=y;R.call(j,k);};}(r),s=function(t){var u=k.callback;if(u.failure!==undefined){u.failure(t);}u.complete(k.id);};j.request({success:q,failure:s},{taskId:Z,server:r.project.sn,userid:r.loginInfo.uid,oldPassword:r.loginInfo.pwd,newPassword:r.loginInfo.npwd},false,{projectId:i,mobileConfig:h,doNotHold:true});});});});});}function G(o,n,m){var k,p,i=mstrmojo.getInstance,h=function(t,q,s,r){return i(W.copy(r,{scriptClass:"mstrmojo.TextBoxWithLabel",cssDisplay:"table-row",label:N(t)+":",value:o[q],type:s||"text",onEnter:function(){if(p.enabled){p.onclick({e:{stopPropagation:mstrmojo.emptyFn}});}}}));},j=h(17,"uid",null,{onRender:function(){this.focus();},onvalueChange:function(){p.set("enabled",!!this.value.length);}}),l=h(18,"pwd","password");p=i(a(N(9935,"Log In"),function(){var q=o.uid=j.value;o.pwd=l.value;if(q.length){window.setTimeout(function(){m();},100);}},{enabled:false}));k=mstrApp.showDialog({id:"user_creds_prompt",title:(n?N(7904):N(11))+" "+N(26),cssClass:"mstrmojo-CredentialsDialog",loginInfo:o,children:[{scriptClass:"mstrmojo.Box",cssDisplay:"table",children:[j,l]}],buttons:[a(N(221,"Cancel"),function(){k.manualClose=true;mstrApp.cancelPending();}),p]});}function K(h){return((h.wsam>1)&&!h.wsuid);}function J(h){return(!h.uid&&h.am!=2);}function T(h,n){var i=h,l=false;var k=function(o){var p={uid:i.wsuid,pwd:i.wspwd},q=function(){i.wsuid=p.uid;i.wspwd=p.pwd;i.updateCfgAfterLogin|=1;o();};G.call(this,p,true,q);};var m=function(o){var p={uid:i.uid,pwd:i.pwd},q=function(){i.uid=p.uid;i.pwd=p.pwd;i.updateCfgAfterLogin|=2;o();};G.call(this,p,false,q);};if(K(i)&&J(i)){var j=this;k.call(this,function(){m.call(j,n);});}else{if(K(i)){k.call(this,n);}else{if(J(i)){m.call(this,n);}else{n();}}}}function b(l){var i=this._mobileCfg,j=l.pid,m=i.getProject(j),k=m.realPid,h=i.getLoginInfo(j);if(mstrApp.useBinaryFormat&&k&&h.uid){l.params.projectID=k;return true;}return false;}function e(l){var o=this,n=o._mobileCfg,m=l.pid,p=l.params.projectID,j=o.transport,h=o.id,q={success:function(s){var r=c[m]=mstrmojo.hash.obj2array(s);mstrmojo.hash.copy(r,mstrmojo.locales);if(mstrApp.useBinaryFormat){V.call(o,l);}else{P[m]=true;j.serverRequest(h,l.id,l);}},failure:function(s){var r=l.callback;if(r.failure!==undefined){r.failure(s);}r.complete(l.id);}},k={taskId:"getLocaleInfo"},i={projectId:m,mobileConfig:n,skipLogin:true,doNotHold:true};if(p){k.projectID=p;}o.request(q,k,false,i);}function R(l){var o=this,n=o._mobileCfg,m=l.pid,r=n.getProject(m),k=o.transport,h=o.id,s=n.getLoginInfo(m),j=false,i,q=function(u){r.posLoginFlag=false;var w={success:function(z){clearInterval(i);r.es=z.hasEmailScreenPriv;if(s.updateCfgAfterLogin){n.updateLoginInfo(m,s);}n.setRealPid(r,z.projectID);var y=C[m]=z.sessionState;mstrMobileApp.putSession(m,y);l.params.sessionState=y;if(z.isCompatible===false){mstrApp.handleCompatibilityError(l);}e.call(o,l);},failure:function(AC){var AF=l.callback,AH=b.call(o,l),y=(AC.status==401),AG=(AC.code==g.AUTHEN_E_LOGIN_FAIL)||(AC.status==401),AB=mstrmojo.emptyFn,AE=n.getLoginInfo(m),z=y||AG||(K(AE)||J(AE));if((AF.failure!==undefined)&&!y){AC.noErrorMessage=AH||z||AC.requireDeviceCertificate;AC.handledError=z||AC.requireDeviceCertificate;AF.failure(AC);}if(!z){AF.complete(l.id);}if(AH&&!mstrMobileApp.isOnline()){e.call(o,l);}else{AC.method="login";if(z){if(AG){n.clearLoginInfoForProject(m);}if(y){var AA=n.getServerByProjectId(m),AD;if(AA.udc){AD=n.getDefaultServerCreds();}else{AD=AA.wsc;}delete AD.lo;delete AD.ps;n.saveConfiguration();AC.message=N(10672,"The username or password you entered is incorrect.");}AC.handledError=false;AB=function(){j=true;};}mstrApp.onerror(AC,AB);}}},x=A,v=M({taskId:D,server:r.sn,project:r.pn,userid:s.uid,password:s.pwd,wsSize:10,authMode:s.am,wsuid:s.wsuid,wspwd:s.wspwd,wsam:s.wsam,clientVersion:mstrMobileApp.getAppVersion(),clientType:mstrMobileApp.isTablet()?x.ANDROID_TAB:x.ANDROID_PHONE}),t={projectId:m,mobileConfig:n,doNotHold:true};o.request(w,v,false,t);},p=q;T.call(this,s,q);i=setInterval(function(){if(j){j=false;s=n.getLoginInfo(m);T.call(o,s,q);}},500);}mstrmojo.MobileServerProxy=mstrmojo.declare(mstrmojo.ServerProxy,null,{scriptClass:"mstrmojo.MobileServerProxy",getSessions:function(){return C;},request:function I(k,j,i,h){this._projectId=h.projectId;this._mobileCfg=h.mobileConfig;this._super(k,j,i,h);},createRequest:function Y(l,n,m,i){var k;try{k=this._super(l,n,m,i);var h=this._projectId;k.pid=h;if(!i.noTaskURL){k.taskURL=this._mobileCfg.getTaskUrlByProject(h);}k.isLogin=(m.taskId===D);k.isPwdChange=(m.taskId==Z);}catch(j){this.deleteRequest(l);throw j;}return k;},userInteractionRequired:function E(k){var h=false;if(k.pid&&!C[k.pid]){var j=k.config.mobileConfig.getLoginInfo(k.pid),l=((j.wsam>1)&&!j.wsuid),i=(!j.uid&&j.am!=2);return l||i;}return h;},submitRequest:function U(i){if(i.isLogin||i.isPwdChange){this._super(i);return ;}var j=C[i.pid],h=c[i.pid];if(j){i.params.sessionState=j;if(h){mstrmojo.hash.copy(h,mstrmojo.locales);}this._super(i);}else{if(i.config.skipLogin){this._super(i);return ;}if(mstrMobileApp.isOnline()){R.call(this,i);}else{if(b.call(this,i)){if(!P[i.pid]){e.call(this,i);}else{this._super(i);}}else{R.call(this,i);}}}},response:function B(k,h,i){var j=this.getRequest(k);if(!j){return ;}if(!h&&mstrMobileApp.isOnline()){switch(parseInt(i.code,10)){case g.AUTHEN_E_LOGIN_FAIL_EXPIRED_PWD:case g.AUTHEN_E_LOGIN_FAILED_NEW_PASSWORD_REQD:L.call(this,j);return ;break;case g.MSI_INBOX_MSG_NOT_FOUND:break;case g.E_MSI_USERMGR_USER_NOTFOUND:if(!j.isLogin){delete j.params.sessionState;R.call(this,j);return ;}break;}}this._super(k,h,i);},getSession:function X(h){return C[h];},closeSession:function Q(h){},closeAllSessions:function S(){C={};},getLocaleInfo:function F(h){return c[h];},hasEmailScreenPrivilege:function O(h){return false;}});}());