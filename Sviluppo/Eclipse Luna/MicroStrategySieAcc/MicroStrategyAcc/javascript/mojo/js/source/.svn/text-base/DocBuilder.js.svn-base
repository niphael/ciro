(function(){mstrmojo.requiresCls("mstrmojo.EnumRWUnitType","mstrmojo.DocLayout","mstrmojo.DocLayoutHoriz","mstrmojo.DocSection","mstrmojo.DocSubsection","mstrmojo.DocTextfield","mstrmojo.DocXtabModel","mstrmojo.DocVisModel","mstrmojo.XtabBase","mstrmojo.DocPortlet","mstrmojo.DocResizablePortlet","mstrmojo.DocXtabGraph","mstrmojo.DocGridGraph","mstrmojo.DocLine","mstrmojo.DocImage","mstrmojo.DocHTMLContainer","mstrmojo.DocRectangle","mstrmojo.DocRoundRectangle","mstrmojo.DocPanel","mstrmojo.DocSelector","mstrmojo.DocActionSelector","mstrmojo._HasDocLink","mstrmojo.DocVisualization","mstrmojo.DynamicClassFactory","mstrmojo._Formattable","mstrmojo._IsDocXtab","mstrmojo._IsSelectorTarget","mstrmojo.DocInfoWindow","mstrmojo._CanSupportTransaction","mstrmojo._IsEditableXtab","mstrmojo._IsEditableTextfield","mstrmojo.DocSelectorViewFactory","mstrmojo._HasHoverButton","mstrmojo.hash");var $HASH=mstrmojo.hash;var en=mstrmojo.EnumRWUnitType,clsMap={};clsMap[en.LAYOUT]={n:"Layout"};clsMap[en.HEADER]=clsMap[en.FOOTER]=clsMap[en.PAGEHEADER]=clsMap[en.PAGEFOOTER]=clsMap[en.DETAILS]={n:"Section",scriptClass:"mstrmojo.DocSection"};clsMap[en.SUBSECTION]={n:"SubSection",scriptClass:"mstrmojo.DocSubsection"};clsMap[en.TEXTFIELD]={n:"Textfield",scriptClass:"mstrmojo.DocTextfield"};clsMap[en.GRID]={n:"Xtab",scriptClass:"mstrmojo.DocXtab"};clsMap[en.GRAPH]={n:"XtabGraph",scriptClass:"mstrmojo.DocXtabGraph"};clsMap[en.GRIDGRAPH]={n:"GridGraph",scriptClass:"mstrmojo.DocGridGraph"};clsMap[en.SELECTOR]={n:"Selector",scriptClass:"mstrmojo.DocSelector"};clsMap[en.LINE]={n:"Line",scriptClass:"mstrmojo.DocLine"};clsMap[en.IMAGE]={n:"Image",scriptClass:"mstrmojo.DocImage"};clsMap[en.HTMLCONTAINER]={n:"HTMLContainer",scriptClass:"mstrmojo.HTMLContainer"};clsMap[en.RECTANGLE]={n:"Rectangle",scriptClass:"mstrmojo.DocRectangle"};clsMap[en.ROUNDEDRECTANGLE]={n:"RoundedRectangle",scriptClass:"mstrmojo.DocRoundRectangle"};clsMap[en.PANEL]={n:"Panel",scriptClass:"mstrmojo.DocPanel"};clsMap[en.VISUALIZATION]={n:"Visualization",scriptClass:"mstrmojo.DocVisualization"};clsMap[en.MOJOVISUALIZATION]={n:"MojoVisualization"};var linkClsMap={};var $CFC=mstrmojo.DynamicClassFactory.newComponent;var _EH=mstrmojo.elementHelper;function getPortletButtonHandler(action){return function(){return this.parent.parent["on"+action]();};}var fMx=getPortletButtonHandler("maximize"),fRs=getPortletButtonHandler("restore"),fMn=getPortletButtonHandler("minimize"),fCo=getPortletButtonHandler("collapse"),fEx=getPortletButtonHandler("expand");mstrmojo.DocXtab=$CFC(mstrmojo.XtabBase,[mstrmojo._Formattable,mstrmojo._IsDocXtab],{scriptClass:"mstrmojo.DocXtab"});var getPopupDelegate=function(widget,openMenu){var w=widget&&widget.parent;while(w){if(w[openMenu]){return w;}w=w.parent;}return null;};function createResizeButton(t,c,fn,bds,cds){return mstrmojo.Button.newIconButton(t,c,fn,null,{ds:bds,visible:(cds!==bds)});}function getLinkDrillingClass(clazz,type,useHover){var className=clsMap[type].n+(useHover?"Hover":""),Cls=linkClsMap[className];if(!Cls){Cls=linkClsMap[className]=$CFC(clazz,[mstrmojo._HasDocLink].concat(this.getLinkDrillMixins(useHover)));}return Cls;}mstrmojo.DocBuilder=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DocBuilder",visList:null,destroy:function destroy(){var selectorFactory=this.selectorFactory;if(selectorFactory){selectorFactory.destroy();}this._super();},classMap:clsMap,build:function build(nodes,model){var arr=[],mthMap=this.classMap,len=((nodes&&nodes.length)||0),i;for(i=0;i<len;i++){var node=nodes[i],nodeDefn=node&&node.defn,nodeData=node&&node.data,t=(nodeDefn&&nodeDefn.t)||mstrmojo.EnumRWUnitType.LAYOUT,config=mthMap[t];var isDocButton=(t===en.TEXTFIELD&&((nodeDefn&&nodeDefn.dpst)));if(isDocButton){config=mthMap[t+"B"];}var fn=(config&&config.n)?"new"+config.n:"",w;if(this[fn]){w=this[fn](model,node);}else{if(config&&config.scriptClass){var Cls=config.cls;if(!Cls){Cls=$HASH.walk(config.scriptClass,window);}if(t===en.TEXTFIELD||t===en.IMAGE){var dataDlRef=nodeData.dl,defnDlRef=nodeDefn.dl,hasLinks=(dataDlRef&&dataDlRef.items&&dataDlRef.items.length)||(defnDlRef&&defnDlRef.items&&defnDlRef.items.length>0);if(hasLinks||nodeData.url||nodeDefn.url||nodeDefn.ifw){Cls=getLinkDrillingClass.call(this,Cls,t+(isDocButton?"B":""),hasLinks);}else{if((t===en.TEXTFIELD)&&nodeDefn.txi){Cls=$CFC(Cls,[mstrmojo._CanSupportTransaction,mstrmojo._IsEditableTextfield]);}}}if(Cls){w=new Cls({id:node.id,node:node,controller:this.parent.controller,model:model});}}}if(w){w.k=node.k;w.formatResolver=model.formatResolver;w.builder=this;w.tooltip=nodeData.tooltip||nodeDefn.tooltip||"";if(!w.defn){w.defn=nodeDefn;}w.disposables.push(w.defn);if(w.update){w.update(node);}if((nodeDefn.ttl!==undefined&&t!==en.PANEL)||nodeDefn.qsm){w=this.createPortlet(t,node,w);}arr.push(w);}}return arr;},createPortlet:function createPortlet(t,node,w){var defn=node.defn,ds=defn.ds,resizable=(defn.iifp||!(t===en.PANELSTACK||(defn.ttl===undefined&&defn.qsm)||t===en.SELECTOR)),hasGraph=(t===en.GRAPH||t===en.GRIDGRAPH),children=[],$NIB=mstrmojo.Button.newIconButton,leftToolbarNodeCssClass="",toolbarNodeCssClass="",buttonbarNodeClass="",isExportGrid=(t===en.GRID||hasGraph||t===en.VISUALIZATION)&&parseInt(defn.eo,10)!==2,toolbarNode=[],tbCssClass="mstrmojo-oivmSprite ",hasTitlebarMenuButton=false;if(defn.qsm){leftToolbarNodeCssClass="qks";var fnQuickSwitchBtn=function(title,css,qsm){return $NIB(title,tbCssClass+css,function(){return this.parent.parent.content.quickSwitch();},{visible:"this.parent.parent.defn.qsm !== this.qsm"},{qsm:qsm});};children.push({scriptClass:"mstrmojo.ToolBar",slot:"leftToolbarNode",alias:"leftToolbar",cssClass:(!resizable)?"grouped":"",children:[fnQuickSwitchBtn(mstrmojo.desc(3547,"View: Grid"),"tbGrid",1),fnQuickSwitchBtn(mstrmojo.desc(3548,"View: Graph"),"tbGraph",2)]});}if(isExportGrid){var tb=this.getPortletExportGridToolbar(w.k);if(tb){toolbarNodeCssClass=tb.css;toolbarNode=tb.node;children.push(toolbarNode);}}if(resizable){if(defn.iifp){leftToolbarNodeCssClass="wrap";children.push({scriptClass:"mstrmojo.ToolBar",slot:"leftToolbarNode",alias:"leftToolbar",children:[createResizeButton(mstrmojo.desc(8973,"Collapse"),"co",fCo,1,ds),createResizeButton(mstrmojo.desc(8972,"Expand"),"ex",fEx,0,ds)]});}else{var btns=[createResizeButton(mstrmojo.desc(4539,"Minimize"),"mn",fMn,1,ds),createResizeButton(mstrmojo.desc(4540,"Restore"),"rs",fRs,0,ds),createResizeButton(mstrmojo.desc(4541,"Maximize"),"mx",fMx,2,ds)];if(isExportGrid){toolbarNode.children=(toolbarNode.children||[]).concat(btns);}else{toolbarNodeCssClass="resize";children.push({scriptClass:"mstrmojo.ToolBar",slot:"toolbarNode",alias:"rightToolbar",children:btns});}}}w.slot="contentNode";w.alias="content";w.title=defn.ttl||"";if(defn.sec){if(defn.style!==mstrmojo.DocSelectorViewFactory.STYLES.SCROLLER&&!defn.sos){var nodeData=node.data,es=nodeData.elms,ces=nodeData.ces;if(ces&&es&&es.length){w.count=_EH.buildElemsCountStr(ces,es);}}}children.push(w);if(t===en.PANELSTACK){var fnNewNavButton=function(title,css,binding,dir){return $NIB(title,tbCssClass+css,function(){return this.parent.parent.content.switchToPanel(dir);},{enabled:"this.parent.parent."+binding});},rTb=[],lTb=[],hasPanelNav=!!node.sw,isInfoWindow=!!defn.ifw,isFilterPanel=!!defn.ifp;if(hasPanelNav){lTb.push(fnNewNavButton(mstrmojo.desc(1058,"Previous"),"tbPrev","prevEnabled",-1));rTb.push(fnNewNavButton(mstrmojo.desc(2917,"Next"),"tbNext","nextEnabled",1));}if(isInfoWindow){rTb.push($NIB(mstrmojo.desc(2102,"Close"),tbCssClass+"mstrmojo-DocInfoWindow-close",function(){this.parent.parent.parent.close();}));}if(isFilterPanel){buttonbarNodeClass="ifp";children.push({scriptClass:"mstrmojo.HBox",slot:"buttonbarNode",alias:"buttonbar",cssClass:"buttonBox",children:[{scriptClass:"mstrmojo.Button",alias:"applyNow",title:mstrmojo.desc(2164,"Apply"),text:mstrmojo.desc(2164,"Apply"),cssClass:"mstrmojo-FilterPanel-Btn apply",bindings:{visible:function(){return !defn.cas;},enabled:function(){return this.parent.parent.applyEnabled;}},onclick:function onclick(){if(w&&w.applyBufferedSlices){w.applyBufferedSlices();}}}]});rTb.push({scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-oivmSprite tbDown",alias:"btnMenu",onclick:function onclick(){this.openPopupMenu();},openPopupMenu:function(){var dl=getPopupDelegate(this,"openPopupMenu");if(dl){dl.openPopupMenu("mstrmojo.FilterPanelMenu",{openerButton:this,fps:w,cmPos:this.cmPos});}}});hasTitlebarMenuButton=true;}if(isInfoWindow||isFilterPanel){var boxCss=[];if(hasPanelNav){boxCss[0]="pst-l";}if(isFilterPanel){boxCss.push("ifp");}lTb.push({scriptClass:"mstrmojo.Box",cssClass:boxCss.join(" ")});}if(isInfoWindow||hasPanelNav||isFilterPanel){var ifwCss=isInfoWindow?"ifw ":"",ifpCss=isFilterPanel?"ifp ":"",casCss=!defn.cas?"cas ":"";toolbarNodeCssClass=(hasPanelNav?"pst-r ":"")+ifwCss+ifpCss+casCss;leftToolbarNodeCssClass=(hasPanelNav?"pst-l ":"")+ifwCss+ifpCss+casCss;children.push({scriptClass:"mstrmojo.ToolBar",slot:"leftToolbarNode",alias:"leftToolbar",children:lTb});children.push({scriptClass:"mstrmojo.ToolBar",slot:"toolbarNode",alias:"rightToolbar",children:rTb});}}if(t===en.SELECTOR&&w.spm){toolbarNodeCssClass="spm";children.push({scriptClass:"mstrmojo.ToolBar",slot:"toolbarNode",alias:"rightToolbar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-oivmSprite tbDown",alias:"btnMenu",onclick:function onclick(){this.openPopupMenu();},openPopupMenu:function(){var dl=getPopupDelegate(this,"openPopupMenu");if(dl){dl.openPopupMenu("mstrmojo.SelectorMenu",{openerButton:this,selector:w,cmPos:this.cmPos});}}}]});hasTitlebarMenuButton=true;}var Cls="Doc"+(resizable?"Resizable":"")+"Portlet",props={defn:w.defn,model:w.model,children:children,title:w.title,count:w.count,floatingTitle:(defn.ttl===undefined&&defn.qsm),leftToolbarNodeClass:leftToolbarNodeCssClass,loadDataOnResize:hasGraph,toolbarNodeClass:toolbarNodeCssClass,buttonbarNodeClass:buttonbarNodeClass,attachContextMenuEvent:hasTitlebarMenuButton};if(t===en.PANELSTACK){props.bindings={title:"this.children[0].title"};if(node.sw){props.bindings.prevEnabled=function(){return this.children[0].hasPreviousPanel;};props.bindings.nextEnabled=function(){return this.children[0].hasNextPanel;};}if(defn.ifp){props.bindings.applyEnabled=function(){return this.children[0].applyEnabled;};}}return new mstrmojo[Cls](props);},getPortletExportGridToolbar:mstrmojo.emptyFn,getLayoutViewerClass:function getLayoutViewerClass(node){return mstrmojo.DocLayoutViewer;},newLayout:function newLayout(model,node){var chs=[],nodeData=node.data,nodeDefn=node.defn,LayoutViewerCls=this.getLayoutViewerClass(node),dlv=new LayoutViewerCls({n:nodeDefn.title,model:model,node:node,controller:this.parent.controller,tbc:nodeDefn.tbc,slot:"containerNode",visible:false,ifs:nodeData.ifs,gb:nodeData.gbys});var defn=dlv.defn=$HASH.copy(nodeDefn);defn.fmts=$HASH.copy(nodeDefn.fmts);var fnHeaders=function(headers,slot){var cnt=headers.length;if(cnt){var h,f;for(h=0;h<cnt;h++){f=this.build([headers[h]],model)[0];f.slot=slot;chs.push(f);}}};fnHeaders.call(this,model.getFixedHeaders(node),"fixedHeaderNode");var LayoutCls=mstrmojo["DocLayout"+((nodeDefn.horiz)?"Horiz":"")];chs.push(new LayoutCls({slot:"layout",id:node.id,k:node.k,minHeight:nodeData.mh,formatResolver:model.formatResolver,rules:nodeDefn.rules,builder:this,node:node,defn:nodeDefn,model:model}));fnHeaders.call(this,model.getFixedFooters(node),"fixedFooterNode");dlv.addChildren(chs);return dlv;},newSection:function(model,node){var cls=(node.defn.horiz&&node.data.subsections.length>1)?"DocSectionHoriz":"DocSection";return new mstrmojo[cls]({id:node.id,node:node,model:model});},newHTMLContainer:function(model,node){var cls=(node.defn.ht===0)?"DocHTMLContainer":"DocTextfield";return new mstrmojo[cls]({id:node.id,node:node,model:model});},adjustMojoVisualizationClass:function adjustMojoVisualizationClass(className){return className;},newMojoVisualization:function(model,node){var visList=this.visList,nodeData=node.data,visInfo=visList.getVis(nodeData.visName);if(!visInfo){var className=nodeData.className;if(!className){return this.newXtab(model,node);}visInfo={dc:className};}var viewClassName=(visInfo.dc!==undefined)?visInfo.dc:visInfo.c;viewClassName=this.adjustMojoVisualizationClass(viewClassName);mstrmojo.requiresCls("mstrmojo."+viewClassName);var ViewClass=$HASH.walk(viewClassName,mstrmojo),ModelClass=$HASH.walk(visInfo.m||"DocVisModel",mstrmojo);if(!ViewClass||!ModelClass){throw new Error("Missing visualization class.");}ViewClass=visList.getVisClass(ViewClass,node.defn);var vis=new ViewClass($HASH.copy(nodeData.extProps,{id:node.id,node:node,n:node.defn.title,controller:this.parent.controller,gb:nodeData.gbys}));vis.setModel(new ModelClass({xtab:vis,controller:this.parent.controller,docModel:model}));vis.model.set("data",nodeData);if(!!node.data.sdp){var sdpKey;for(sdpKey in node.data.sdp){node.data.sdp[sdpKey].defn={};var obj=this.newXtab(model,node.data.sdp[sdpKey]);obj.setModel(new ModelClass({xtab:obj,controller:this.parent.controller,docModel:model,data:node.data.sdp[sdpKey]}));obj.k=sdpKey;}}return vis;},newInfoWindow:function newInfoWindow(cfg){return new mstrmojo.DocInfoWindow(cfg);},newRoundedRectangle:function newRoundedRectangle(model,node){var $D=mstrmojo.dom,cls=($D.supports($D.cssFeatures.ROUND_CORNERS))?"DocRectangle":"DocRoundRectangle";return new mstrmojo[cls]({id:node.id,node:node,model:model});},newSelector:function newSelector(model,node){var cls=(node.defn.ct==="4"?"DocActionSelector":"DocSelector");return new mstrmojo[cls]({id:node.id,node:node,controller:this.parent.controller,model:model});},newXtab:function newXtab(model,node){var txi=node.defn.txi,xtab,Cls=mstrmojo.DocXtab;if(txi){Cls=$CFC(mstrmojo.DocXtab,[mstrmojo._CanSupportTransaction,mstrmojo._IsEditableXtab],{scriptClass:"mstrmojo.DocXtab"});}xtab=new Cls({id:node.id,node:node,controller:this.parent.controller});xtab.model=new mstrmojo.DocXtabModel({xtab:xtab,docModel:model});return xtab;},getLinkDrillMixins:function getLinkDrillMixins(useHover){return useHover?[mstrmojo._HasHoverButton]:[];}});}());