(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._Formattable","mstrmojo._HasWaitIcon","mstrmojo._IsSelectorTarget","mstrmojo._IsPanelStack","mstrmojo._HasBuilder","mstrmojo.array","mstrmojo.css","mstrmojo.Serializer");function updateSelectedIndex(ps,dir){var idx=mstrmojo.array.find(ps.node.data.panels,"k",ps.selectedKey);idx+=(dir||0);ps.set("selectedIdx",idx);}function updatePSNavigationProps(ps){ps.set("hasNextPanel",(ps.selectedIdx<(ps.node.data.panels.length-1)));ps.set("hasPreviousPanel",(ps.selectedIdx>0));}mstrmojo.DocPanelStack=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable,mstrmojo._HasWaitIcon,mstrmojo._IsSelectorTarget,mstrmojo._HasBuilder,mstrmojo._IsPanelStack],{scriptClass:"mstrmojo.DocPanelStack",markupString:'<div id="{@id}" title="{@tooltip}" class="mstrmojo-DocPanelStack {@cssClass}" style="{@domNodeCssText}"><div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},formatHandlers:{domNode:["RW","B","overflow"]},hasNextPanel:false,hasPreviousPanel:false,applyEnabled:false,renderMode:"onshow",init:function init(props){this._super(props);updateSelectedIndex(this);this.node.sw=(this.node.data.panels.length>1&&this.defn.sw);},addChildren:function ac(panels,idx,silent){var i=0,cnt=panels.length;this._super(panels,idx,silent);for(i=0;i<cnt;i++){var pnl=panels[i],isSelected=(pnl.k===this.selectedKey);pnl.selected=pnl.visible=isSelected;if(isSelected){break;}}return true;},onselectedKeyChange:function onselKeyChg(evt){var panelInfo=this._super(evt),on=panelInfo.on;if(on._delayRefresh){if(!on.defn.dirtyKeys){on.refresh();}delete on._delayRefresh;}updateSelectedIndex(this);},updateSelectedIdx:function updateSelected(dir){updateSelectedIndex(this,dir);},onselectedIdxChange:function onselectedIdxChange(){updatePSNavigationProps(this);},_bufferedSlices:null,bufferSlice:function(rEvt){this._bufferedSlices=this._bufferedSlices||{};var bs=this._bufferedSlices;if(rEvt.ctlKey){bs[rEvt.ctlKey]=rEvt;this.set("applyEnabled",true);}},applyBufferedSlices:function(){var bs=this._bufferedSlices;if(!bs){return ;}var m=this.model,s=mstrmojo.Serializer,evt,evta,i,events=[];for(i in bs){evt=bs[i];if("eid" in evt){evta=[2048084,"mstrWeb.rwb.2048084","selectorKeyContext",evt.ck,"elemList",evt.eid,"ctlKey",evt.ctlKey,"applyNow",false];if(evt.include!==null&&evt.include!==undefined){evta.push("include");evta.push(evt.include);}if(evt.disablePU){evta.push("usePartDisplay");evta.push(0);evta.push("treesToRender");evta.push(3);}else{evta.push("usePartDisplay");evta.push(1);evta.push("treesToRender");evta.push(2);}}else{if("srct" in evt&&evt.srct===4){evta=[2048132,"mstrWeb.rwb.2048132","unitKeyContext",evt.ck,"ctlKey",evt.ctlKey,"objectID",evt.srcid,"objType",evt.srct,"expFunction",evt.f,"expFunctionType",evt.ft,"applyNow",false,"usePartDisplay",1];if(evt.cs){evta.push("expConstants");evta.push(evt.cs);evta.push("dataType");evta.push(evt.dtp);}}else{if(evt.unset){evta=[2048128,"mstrWeb.rwb.2048128","unitKeyContext",evt.ck,"ctlKey",evt.ctlKey];}else{evta=[2048133,"mstrWeb.rwb.2048133","include",evt.include,"ctlKey",evt.ctlKey];}}}if(evta){events.push(evta);}}if(!events.length){return ;}events=s&&s.serializeValueGroup(events);this.clearBuffSlices();m.slice({isMultipleEvents:true,tks:evt.tks,events:events});},clearBuffSlices:function(){this._bufferedSlices=null;this.set("applyEnabled",false);},update:function(node){if(this._super){this._super(node);}var selKey=node.data&&node.data.selKey;if(selKey&&selKey!==this.selectedKey){this.defn.newSelKey=selKey;}},postBuildRendering:function(){this._super();if(this.defn.itb){mstrmojo.css.addClass(this.domNode,"tableControl");}}});}());