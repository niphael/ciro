(function(){mstrmojo.requiresCls("mstrmojo.SuggestionList");var buildTooltip=function(w,item){var opener=w.parent.opener,showDesc=opener&&opener.showDesc,showPath=opener&&opener.showPath,n=item[w.itemField];var encode=mstrmojo.string.escape4HTMLText,tooltip="";if(showPath){var its=item.anc&&item.anc.items,len=its&&its.length;if(len>0){for(var i=0;i<len-1;i++){tooltip+=its[i].n+" > ";}tooltip+=encode(its[len-1].n);}else{if(item.path){tooltip+=item.path;}}}tooltip+=(tooltip.length==0?"":" > ")+encode(n);if(showDesc){var desc=item[w.itemDescField],ml=120;if(desc){tooltip+="\r\n\r\n"+encode(desc.substring(0,ml)+(desc.length>ml?"...":""));}}return tooltip;};var requestPath=function(w,el,item){if(!el||!item){return ;}window.clearTimeout(this.pathTmr);this.pathTmr=window.setTimeout(function(){var path=el.path||el.getAttribute("path");if(path){return ;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(res){var path=pathParser(res.toString())||"";item.path=path;el.path=1;el.title=buildTooltip(w,item);}},{taskId:"getObjectDetails",objectID:item.did,objectType:item.t,sessionState:mstrApp.sessionState},undefined);},200);};var pathParser=function(pathXmlString){if(window.DOMParser){parser=new DOMParser();xmlDoc=parser.parseFromString(pathXmlString,"text/xml");}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(pathXmlString);}var pathNode=xmlDoc.getElementsByTagName("path")[0],cns=pathNode.childNodes,path="";if(cns){for(var i=0,len=cns.length;i<len;i++){var vNode=cns[i].childNodes&&cns[i].childNodes[0];if(vNode){path+=mstrmojo.string.escape4HTMLText(vNode.nodeValue)+(i<len-2?"> ":"");}}}return path;};mstrmojo.LegacySuggestionList=mstrmojo.declare(mstrmojo.SuggestionList,null,{scriptClass:"mstrmojo.LegacySuggestionList",itemDescField:"desc",getItemMarkup:function(item,idx){var opener=this.parent.opener,tooltip=buildTooltip(this,item);return'<div class="mstrmojo-suggest-text '+((opener&&opener.item2textCss(item))||"")+'" idx="'+idx+'" title="'+tooltip+'">'+opener.getHighlightedText(opener.getSearchPattern(),mstrmojo.string.escape4HTMLText(item[this.itemField]))+"</div>";},getItemProps:function getItemProps(item,idx){return{};},onmouseover:function(evt){var opener=this.parent.opener;if(opener&&opener.showPath){var el=mstrmojo.dom.eventTarget(evt.hWin,evt.e),idx=el.getAttribute("idx"),item=idx!=null?this.items[idx]:null;if(item&&item.t>-1){requestPath(this,el,item);}}}});}());