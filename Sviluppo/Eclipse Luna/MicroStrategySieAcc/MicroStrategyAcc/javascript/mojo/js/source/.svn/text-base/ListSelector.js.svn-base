(function(){mstrmojo.requiresCls("mstrmojo.dom");var _D=mstrmojo.dom;function _findGtEq(h,min){var ret=[];if(h){for(var k in h){var i=Number(k);if(i>=min){ret.push(i);}}}ret.sort(mstrmojo.array.numSorter);return ret;}mstrmojo.ListSelector=mstrmojo.provide("mstrmojo.ListSelector",{premousedown:function pmd(w,p,evt){var hWin=evt.hWin,e=evt.e,el=_D.eventTarget(hWin,e),idx=w.listMapper.findIndex(w,p,el);if(idx>-1){var m=w.multiSelect,c=_D.ctrlKey(hWin,e),s=_D.shiftKey(hWin,e);if(c||s){_D.clearBrowserHighlights(hWin);}if(m&&(c||(w.selectionPolicy==="toggle"))){w.toggleSelect(idx);}else{if(m&&s){w.rangeSelect(idx);}else{w.singleSelect(idx);}}}},premouseup:function pmu(w,p,evt){var hWin=evt.hWin,e=evt.e,c=_D.ctrlKey(hWin,e),s=_D.shiftKey(hWin,e);if(c||s){_D.clearBrowserHighlights(hWin);}},onadd:function oa(w,evt){var c=evt&&evt.value&&evt.value.length;if(c){var idx=evt.index,sel=w.selectedIndices,inc=_findGtEq(sel,idx);for(var j=inc.length-1;j>-1;j--){var at=inc[j];sel[at+c]=true;delete sel[at];}if(w.selectedIndex>=idx){w.selectedIndex+=c;}}},onremove:function oa(w,evt){var c=evt&&evt.value&&evt.value.length;if(c){var idx=evt.index,idxLast=idx+c-1,h=w.selectedIndices,si=w.selectedIndex,dec=[],rem=[],b=false;if(h){for(var k in h){var i=Number(k);if(i>idxLast){dec.push(i);}else{if(i>=idx){rem.push(i);b=true;}}}}dec.sort(mstrmojo.array.numSorter);for(var j=0,len=dec.length;j<len;j++){var at=dec[j];h[at-c]=true;delete h[at];}if(si>idxLast){w.selectedIndex-=c;}if(b){w.removeSelect(rem);}}}});})();