(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.Popup","mstrmojo.List","mstrmojo.DropDownButton");mstrmojo.Pulldown=mstrmojo.declare(mstrmojo.DropDownButton,null,{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-Pulldown",items:null,itemIdField:"dssid",itemField:"n",itemCSS:"css",defaultSelection:0,defaultText:null,title:"",value:null,popupToBody:false,popupCssClass:"",popupZIndex:null,fixWidth:false,fixHeight:false,_set_items:function(n,v){var was=this.items;this.items=v||[];return was!==this.items;},markupMethods:mstrmojo.hash.copy({onvalueChange:function(){var v=this.value,idx=this.selectedIndex,its=this.items||[],selItem,t;if(idx===undefined||(v!==null&&(idx===-1||(idx!==-1&&its[idx]&&its[idx][this.itemIdField]!==v)))){idx=mstrmojo.array.find(its,this.itemIdField,v);idx=(idx>-1)?idx:this.defaultSelection;this.selectedIndex=idx;}else{if(v===null){this.selectedIndex=this.defaultSelection;}}this.selectedItem=selItem=its[this.selectedIndex];if(selItem){t=selItem[this.itemField];}else{t=this.defaultText||"";}this.set("text",t);}},mstrmojo.hash.copy(mstrmojo.DropDownButton.prototype.markupMethods)),prevalueChange:function(evt){var v=this.value,idx=-1;if(v!==null){idx=mstrmojo.array.find(this.items,this.itemIdField,v);}if(idx>-1){this.selectedItem=this.items[idx];this.selectedIndex=idx;}},togglePopup:function togglePopup(){if(this.popupToBody){var pos=mstrmojo.dom.position(this.popupNode,true),pr=this.popupRef,cfg={left:Math.round(pos.x)+"px",top:Math.round(pos.y)+"px"};if(!pr.hasRendered){delete pr.slot;cfg.placeholder=document.body.appendChild(document.createElement("div"));}this.popupOpenConfig=this.popupOpenConfig||{};mstrmojo.hash.copy(cfg,this.popupOpenConfig);}else{this.popupRef.slot="popupNode";}if(this._super){this._super();}var pn=this.popupRef.domNode;if(pn){if(this.fixWidth){pn.style.width=(this.domNode.offsetWidth-2)+"px";}else{pn.style.minWidth=(this.domNode.offsetWidth-2)+"px";}}},premousedown:function premousedown(evt){this.togglePopup();},unrender:function unrender(ignoreDom){var pr=this.popupRef;if(this.popupToBody&&pr.hasRendered){pr.unrender(false);}if(this._super){this._super(ignoreDom);}},popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",cssClass:"mstrmojo-Pulldown-Popup",autoCloses:false,modal:false,autoClose:true,locksHover:true,onOpen:function(){var o=this.opener,z=o&&o.popupZIndex,c=o&&o.popupCssClass||"",dn=this.domNode;if(z){dn.style.zIndex=z;}if(c){mstrmojo.css.addClass(dn,[c]);}if(o&&o.fixWidth){mstrmojo.css.addClass(dn,["fix-width"]);}if(o&&o.fixHeight){mstrmojo.css.addClass(dn,["fix-height"]);}},children:[{scriptClass:"mstrmojo.List",alias:"list",itemMarkupFunction:function(item,idx,w){return'<div class="mstrmojo-Pulldown-listItem"><div class="mstrmojo-text '+(item[w.itemCSS]||"")+'" title="'+item[w.itemField]+'">'+(item[w.itemField]||"&nbsp;")+"</div></div>";},renderOnScroll:false,bindings:{itemIdField:"this.parent.opener.itemIdField",itemField:"this.parent.opener.itemField",itemCSS:"this.parent.opener.itemCSS",items:"this.parent.opener.items",selectionPolicy:"this.parent.opener.selectionPolicy",selectedIndex:"this.parent.opener.selectedIndex"},onmousedown:function(){this.parent.close();},onchange:function(){var p=this.parent,visible=p.visible,pd=p.opener,si=this.selectedItem;if(!pd||!si||!visible){return ;}pd.set("value",si[this.itemIdField]);}}]}});})();