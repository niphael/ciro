(function(){mstrmojo.requiresCls("mstrmojo.XtabBase","mstrmojo._Formattable","mstrmojo._HasWaitIcon","mstrmojo._IsSelectorTarget","mstrmojo._IsDocXtab","mstrmojo._XtabSelections","mstrmojo._XtabCellHoverMgr");var LOCK_OFF=0,OVERFLOW_A="overflow:auto",OVERFLOW_H="overflow:hidden",$DOM=mstrmojo.dom,$PS="mstrmojo.DocPanelStack";var fc=function findContainerByScriptName(w,s){var anc=w&&w.parent;while(anc&&anc.scriptClass!==$PS){if(anc.scriptClass===s){return anc;}anc=anc.parent;}return anc;};mstrmojo.Xtab=mstrmojo.declare(mstrmojo.XtabBase,[mstrmojo._Formattable,mstrmojo._HasWaitIcon,mstrmojo._IsSelectorTarget,mstrmojo._IsDocXtab,mstrmojo._XtabSelections],{scriptClass:"mstrmojo.Xtab",cellHoverMgr:"mstrmojo._XtabCellHoverMgr",cellHoverPopupRef:"mstrmojo.XtabCellHoverPopup",preBuildRendering:function preBuildRendering(){var rtn=this._super();var gd=this.gridData;var overflowClip=this.lockHeadersCase===LOCK_OFF&&gd.co;this.scrollboxNodeOverflow=overflowClip&&!this.numRowFixed?OVERFLOW_H:OVERFLOW_A;var f=this.getFormats();if(mstrmojo.dom.isIE8&&!gd.co&&this.lockHeadersCase===LOCK_OFF&&(!gd.rw||gd.rw&&(gd.rw.row.bc>=gd.rw.row.tc))&&mstrmojo.string.isEmpty(f.height)&&mstrmojo.string.isEmpty(f.width)){this.scrollboxNodeOverflow="";}this._useFilter=this._useFilter||gd.cssflt||false;return rtn;},postBuildRendering:function postBldRndr(){var gd=this.gridData,rtn=this._super();if(!$DOM.supportsTouches){var xtab=this;if(this.contentNode){this.contentNode.onmouseover=function(){xtab.requiresContrib("cellHoverMgr",true);xtab.contentNode.onmouseover=null;};}}if(!this.getFormats().width&&this.model.docModel.addAutoWidthID){this.model.docModel.addAutoWidthID(this.id);gd=this.gridData;var afc=gd&&gd.afc;if(afc&&mstrmojo.dom.isIE7){var p=fc(this,$PS);if(p&&p.scriptClass===$PS){this.viewport.style.width=this.contentNode.offsetWidth+(this.scrollboxNode.offsetWidth-this.scrollboxNode.clientWidth)+"px";}}}if($DOM.isIE&&!$DOM.isIE8&&this._useFilter&&!this.lockHeadersCase){var sn=this.scrollboxNode;window.setTimeout(function(){var img=document.createElement("img");sn.appendChild(img);sn.removeChild(img);},0);}return rtn;},createZone:function(cfg){return new mstrmojo.XtabZone(cfg||{});},onCGBMapChange:function(evt){var updatedTks=this._resolveCGBToTKS(evt.cgbMap);if(updatedTks){this.defaultAction(this._currentSelectedTD);}},_resolveCGBToTKS:function _resolveCGBToTKS(cgbMap){if(!cgbMap){return ;}var scm=this.model.scm,delim="\u001E",i=0,id=null,curSelector=null,cgb=null,targetKey=null,updatedTks=false;for(id in scm){curSelector=scm[id];cgb=curSelector.cgb;for(i in cgb){targetKey=cgbMap[cgb[i]];if(targetKey){if(!curSelector.tks){curSelector.tks=targetKey;updatedTks=true;}else{if(curSelector.tks&&(curSelector.tks.indexOf(targetKey)<0)){curSelector.tks+=delim+targetKey;updatedTks=true;}}}}}return updatedTks;},onGridWidthChanged:function onGridWidthChange(b){if(this.cellHoverMgr.onXtabWidthChanged){this.cellHoverMgr.onXtabWidthChanged();}if(this._super){this._super(b);}},getDim:function(){var cn=this.contentNode;return{w:cn.scrollWidth,h:cn.scrollHeight};},unrender:function unrender(ignoreDom){var chm=this.cellHoverMgr;if(chm&&chm.shutdown){chm.shutdown();}this._super(ignoreDom);},link:function link(cell,idx){this.controller.onLink(this,this.model.getLinkAction(cell,idx));},sort:function sort(cell,isAsc){this.controller.onSort(this,this.model.getSortAction(cell,isAsc));},pivot:function pivot(cell,btn){this.controller.onPivot(this,this.model.getPivotAction(cell,btn));},drill:function drill(cell){this.controller.onDrill(this,this.model.getDrillAction(this.getActionCells(cell)));}});}());