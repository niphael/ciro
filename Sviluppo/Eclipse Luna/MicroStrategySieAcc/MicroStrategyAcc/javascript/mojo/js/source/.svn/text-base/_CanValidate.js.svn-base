(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.expr","mstrmojo.date","mstrmojo.num","mstrmojo.string");mstrmojo.validation={STATUSCODE:{UNKNOWN:-1,VALID:0,INVALID:1,INVALID_EMPTY:2,INVALID_CHAR:3,INVALID_OUTOFRANGE:4,INVALID_REGEX:5,INVALID_VALIDATOR:6,INVALID_BAD_NUMERICFORMAT:7,INVALID_BAD_DATESTRING:8},TRIGGER:{NONE:0,ONBLUR:1,ONKEYUP:2,VALUESET:4,ALL:7},REGEXP:{US_ZIP:/^\d{5}([- ]?\d{4})?$/,EMAIL_ADDRESS:/^([a-zA-Z0-9\_\.\-])+@(([a-zA-Z0-9\-])+[\.])+([a-zA-Z0-9]{2,4})+$/,SOCIAL_SECURITY_NUMBER:/^((?!000)(?!666)\d{3})(\s|\-)?((?!00)\d{2})\2((?!0000)\d{4})$/,PHONE_NUMBER:/^(?!-)[ \d\-\(\)\.\+]+$/,FILE_NAME:new RegExp('^[^:*?"<>|/\\\\()]+$'),FOLDER_PATH_WIN:new RegExp('^([a-zA-Z]:|\\\\\\\\[^:*?"<>|/\\\\]+|[^:*?"<>|/\\\\]*)(\\\\[^:*?"<>|/\\\\]+)*(\\\\){0,1}$'),FOLDER_PATH_UNIX:new RegExp('^(/){0,1}([^:*?"<>|/\\\\]+/)*([^:*?"<>|/\\\\]+){0,1}$'),PRINTER_PATH_SINGLE:new RegExp('^[^$%:*?"<>|/\\\\]*$'),PRINTER_PATH_MULTIPLE:new RegExp('^((/|\\\\\\\\)[^$%:*?"<>|/\\\\]+)((/|\\\\)[^$%:*?"<>|/\\\\]+)*(/|\\\\){0,1}$')},VALIDATOR:{DEMO:function customValidator(v){var parsed=parseInt(v,10),SC=mstrmojo.validation.STATUSCODE;if(parsed===0||parsed===1||parsed>10){return{code:SC.VALID};}return{code:SC.INVALID,msg:"This field must be either 0, 1 or greater than 10"};},VALIDATE_PHONENO:function validatePhoneNo(v){var dt=this.dtp,phoneNo=String(v).replace(/[^\d]/g,"");if(phoneNo.length<10){return{code:_SC.INVALID,msg:mstrmojo.desc(9203)};}if(!_V.REGEXP.PHONE_NUMBER.test(v)){return{code:_SC.INVALID,msg:mstrmojo.desc(9204)};}return{code:_SC.VALID};},VALIDATE_ZIPCODE:function validateZipCode(v){var msg="",dt=this.dtp;if(!_V.REGEXP.US_ZIP.test(v)){if(_V.isNumeric(dt)||_V.isInt(dt)){msg=mstrmojo.desc(9208);}else{if(_V.isString(dt)){msg=mstrmojo.desc(9206);}}return{code:_SC.INVALID,msg:msg};}return{code:_SC.VALID};},VALIDATE_EMAIL:function validateEmail(v){var atSignIdx=v.indexOf("@");if(atSignIdx===-1){return{code:_SC.INVALID,msg:mstrmojo.desc(9197)};}if(v.substring(atSignIdx).indexOf(".")===-1){return{code:_SC.INVALID,msg:mstrmojo.desc(9198)};}return _V.REGEXP.EMAIL_ADDRESS.test(v)?{code:_SC.VALID}:{code:_SC.INVALID,msg:mstrmojo.desc(9207)};},VALIDATE_SSN:function validateSSN(v){var dt=this.dtp,ssnNo;if(_V.isNumeric(dt)||_V.isInt(dt)){ssnNo=String(v).replace(/[^\d]/g,"");if(ssnNo.length!=9){return{code:_SC.INVALID,msg:mstrmojo.desc(9209)};}}if(!_V.REGEXP.SOCIAL_SECURITY_NUMBER.test(v)){return{code:_SC.INVALID,msg:mstrmojo.desc(9210)};}return{code:_SC.VALID};}},isInt:function(dtp){return DTP2TYPE[dtp]==1;},isNumeric:function(dtp){return DTP2TYPE[dtp]==2||DTP2TYPE[dtp]==5;},isString:function(dtp){return DTP2TYPE[dtp]==3;}};var _G=window.mstrConfig,listSep=_G.listSep,_E=mstrmojo.expr,DTP=_E.DTP,_V=mstrmojo.validation,_TR=_V.TRIGGER,_SC=_V.STATUSCODE,_C=mstrmojo.css,_N=mstrmojo.num,_S=mstrmojo.string,_DP=mstrmojo.date,DTP2TYPE={"-1":-1,1:1,2:1,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:4,12:4,13:4,14:6,15:6,16:6,21:2,22:2,23:3,24:4,25:3,30:5};function _containsInvalidChar(me,v){var dtp=me.dtp,c=me.constraints,allows=c.allowedFormatChars?c.allowedFormatChars:"",isInt=(DTP2TYPE[dtp]==1),isNumeric=(DTP2TYPE[dtp]==2),isDT=(DTP2TYPE[dtp]==6),thousand=mstrmojo.locales.number.THOUSANDSEPARATOR,decimal=mstrmojo.locales.number.DECIMALSEPARATOR,regExp;if(isInt){if(!me._intRegExp){allows+="0-9-"+(me.isList?listSep:"")+thousand;me._intRegExp=new RegExp("[^"+allows+"]");}regExp=me._intRegExp;}if(isNumeric){if(!me._numericRegExp){allows+="0-9-"+(me.isList?listSep:"")+decimal+thousand;me._numericRegExp=new RegExp("[^"+allows+"]");}regExp=me._numericRegExp;}if(isDT){}return !!regExp&&regExp.test(v);}function _valueOutOfRange(me,v){var dtp=me.dtp,c=me.constraints,isInt=(DTP2TYPE[dtp]==1),isNumeric=(DTP2TYPE[dtp]==2),isDT=(DTP2TYPE[dtp]==6),min=c.min,max=c.max,parsed;if(min==undefined&&max==undefined){return false;}if(isInt||isNumeric){return _N.inNumericRange(v,min,max)!==0;}if(isDT){return _DP.inDateTimeRange(v,min,max)!==0;}return false;}function _badNumericFormat(me,v){return !_N.isNumeric(v);}function _badDTString(me,v){var isD=(me.dtp===DTP.DATE),isT=(me.dtp===DTP.TIME);return(isD?!_DP.isDate(v):(isT?!_DP.isTime(v):!_DP.isDateAndOrTime(v)));}mstrmojo._CanValidate=mstrmojo.provide("mstrmojo._CanValidate",{constraints:null,required:false,dtp:DTP.INTEGER,isList:false,autoFormat:false,validationStatus:null,init:function init(props){this._super(props);if(!this.constraints){this.constraints={};}var c=this.constraints;if(!("trigger" in c)){c.trigger=_TR.NONE;}},_set_value:function(n,v){var vWas=this.value,bChanged=(vWas!==v);if(bChanged){this.value=v;var t=this.constraints.trigger,cv=(t&_TR.VALUESET)>0;if(cv){this.validate(v);}}return bChanged;},validate:function validate(){var v=(this.value!==null&&this.value!==undefined)?this.value:"",vl=this.isList?v.split(listSep):[v],r,isInvalid,method;for(var i=0,len=vl.length;i<len;i++){r=this.doValidation(vl[i]);isInvalid=(r.code>_SC.VALID);if(isInvalid){if(len>1){r.msg=mstrmojo.locales.validation.invalidValueInListError.replace("#",vl[i]?vl[i]:" ");}break;}}method=isInvalid?"onInvalid":"onValid";if(!isInvalid&&this.autoFormat){this.format();}this.set("validationStatus",r);if(this[method]){this[method](r);}},format:function format(){var dtp=this.dtp,isDT=(DTP2TYPE[dtp]==6);if(!isDT){return ;}var listSep=mstrConfig.listSep,v=this.value||"",vl=this.isList?v.split(listSep):[v],isD=dtp===14,va=[],dt,_DT=mstrmojo.locales.datetime;for(var i=0,len=vl.length;i<len;i++){v=vl[i];dt=_DP.parseDateAndOrTime(v);if(dt){if(isD&&dt.date){va.push(_DP.formatDateInfo(dt.date,_DT.DATEOUTPUTFORMAT));}else{va.push((dt.date?_DP.formatDateInfo(dt.date,_DT.DATEOUTPUTFORMAT):"")+" "+(dt.time?_DP.formatTimeInfo(dt.time,_DT.TIMEOUTPUTFORMAT):""));}}}this.set("value",va.join(listSep));},isValid:function isValid(){var s=this.validationStatus;if(!s){this.validate();}return this.validationStatus.code===_SC.VALID;},clearValidation:function clearValidation(){this.set("validationStatus",{code:_SC.VALID});if(this.onClearValidation){this.onClearValidation();}},doValidation:function doValidation(v){var c=this.constraints,regExp=c.regExp,validator=c.validator,r={id:this.id,code:_SC.VALID,msg:""},dtp=this.dtp,isInt=(DTP2TYPE[dtp]==1),isNumeric=(DTP2TYPE[dtp]==2||DTP2TYPE[dtp]==5),isString=(DTP2TYPE[dtp]==3),isDT=(DTP2TYPE[dtp]==6),isEmpty=_S.isEmpty(v),vLen=String(v).length;err="",_VAL=mstrmojo.locales.validation;if(this.required&&isEmpty){r.code=_SC.INVALID_EMPTY;r.msg=_VAL.requiredFieldError;return r;}v=_S.trim(v);if(!isEmpty&&_containsInvalidChar(this,v)){if(isInt){err=_VAL.integerDataType;}if(isNumeric){err=_VAL.numericDataType;}if(isDT){err=_VAL.dateDataType;}r.code=_SC.INVALID_CHAR;r.msg=_VAL.invalidCharError.replace("#",err);return r;}if(!isEmpty&&isDT&&_badDTString(this,v)){r.code=_SC.INVALID_BAD_DATESTRING;r.msg=_VAL.invalidDateStringError;return r;}if(!isEmpty&&(isNumeric||isInt)&&_badNumericFormat(this,v)){r.code=_SC.INVALID_BAD_NUMERICFORMAT;r.msg=_VAL.invalidNumericFormatError;return r;}if(!isEmpty&&(isInt||isNumeric||isDT)&&_valueOutOfRange(this,v)){r.code=_SC.INVALID_OUTOFRANGE;if(c.min!=null&&c.max!=null){err=_VAL.outofRangeError.replace("#","").replace("##",c.min).replace("###",c.max);}else{if(c.min!=null){err=_VAL.noLessMinError.replace("##",c.min).replace("#","");}else{if(c.max!=null){err=_VAL.noGreaterMaxError.replace("###",c.max).replace("#","");}}}r.msg=err;return r;}if(isString&&c.minLen!=null&&c.maxLen!=null){if(vLen<c.minLen||vLen>c.maxLen){r.code=_SC.INVALID;r.msg=mstrmojo.desc(9211).replace(/#/,c.minLen).replace(/##/,c.maxLen);return r;}}if(regExp&&!regExp.test(v)){r.code=_SC.INVALID_REGEX;r.msg=mstrmojo.desc(9205);return r;}var _t=validator&&validator.apply(this,[v]);if(_t){r.code=_t.code;r.msg=_t.msg;return r;}return r;}});})();