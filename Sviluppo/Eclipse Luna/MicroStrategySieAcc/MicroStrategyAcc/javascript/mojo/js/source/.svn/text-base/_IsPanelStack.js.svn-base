(function(){mstrmojo.requiresCls("mstrmojo.array");var $ARR=mstrmojo.array;mstrmojo._IsPanelStack=mstrmojo.provide("mstrmojo._IsPanelStack",{_mixinName:"mstrmojo._IsPanelStack",TTL_SRC_PANEL:0,init:function init(props){this._super(props);var defn=this.defn;if(!defn){defn=this.defn=this.node&&this.node.defn;this.titleSrc=this.titleSrc||defn.ttlSrc;}var key=this.selectedKey=this.defn.selKey=this.node.data.selKey;this.set("selectedIdx",$ARR.find(this.node.data.panels,"k",key));defn.attachEventListener("selKeyChange",this.id,function(evt){this.set("selectedKey",evt.value);});},addChildren:function addChildren(panels,idx,silent){var fmts=this.getFormats(),overflow=fmts&&fmts.overflow;if(overflow){$ARR.forEach(panels,function(panel){var pnlFmts=panel.getFormats();if(pnlFmts){pnlFmts.overflow=overflow;}});}return this._super(panels,idx,silent);},refresh:function refresh(){if(this.hasRendered){var refreshKey=this.defn.newSelKey||this.selectedKey;$ARR.forEach(this.children,function(child){child._delayRefresh=(child.k!==refreshKey);if(!child._delayRefresh){child.refresh();}});}delete this.defn.newSelKey;},selectPanel:function selectPanel(key,hasLoader){if(key!==this.selectedKey){this.defn.set("selKeyChange",key);this.model.slice({type:3,tks:this.k,eid:key,sid:this.node.data.wid,ck:this.k,hasLoader:hasLoader});}},onselectedKeyChange:function onselKeyChg(evt){var off,on,selectedIdx;$ARR.forEach(this.children,function(panel,idx){var panelKey=panel.k;if(evt.value===panelKey){on=panel;selectedIdx=idx;panel.set("selected",true);}else{if(evt.valueWas===panelKey){off=panel;panel.set("selected",false);}}if(on&&off){return false;}});if(this.titleSrc===this.TTL_SRC_PANEL&&this.title){this.set("title",on.title);this.defn.ttl=on.title;}this.prevSelectIdx=this.selectedIdx;this.set("selectedIdx",selectedIdx);this.raiseEvent({name:"panelSelected",key:on.k});return{on:on,off:off};},setDirty:function setDirty(isDirty){if(isDirty){this.setDirtyChildren(true);}this._super(isDirty);},setDirtyChildren:function setDirtyChildren(includeAll){var selectedKey=this.selectedKey;$ARR.forEach(this.children,function(child){var key=child.k;child[((includeAll||key!==selectedKey)?"add":"remove")+"DirtyKey"](key);});},clearDirtyChild:function clearDirtyChild(key){var panels=this.children,panel=panels[$ARR.find(panels,"k",key)];if(panel){panel.removeDirtyKey(panel.k);}},isPanelStack:true,checkRequiredObjects:function checkRequiredObjects(){var txWidgets=this.txWidgets||{},i,w,flag=true;for(i in txWidgets){flag&=!!txWidgets[i].checkRequiredObjects();}return flag;},updateSelectedIdx:mstrmojo.emptyFn,switchToPanel:function switchToPanel(dir,selectedIdx){if(selectedIdx!==undefined){this.set("selectedIdx",selectedIdx);}else{this.updateSelectedIdx(dir);}this.children[this.selectedIdx]&&this.selectPanel(this.children[this.selectedIdx].k);}});}());