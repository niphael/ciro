(function(){mstrmojo.requiresCls("mstrmojo.DI.OAuthSource");var _getReports=function getReports(sfModel,callback){var taskParams={taskId:"qBuilder.FetchSourceObjects",accessToken:sfModel.oAuth.accessToken,flags:7,instanceURL:sfModel.instanceUrl,refreshToken:sfModel.oAuth.refreshToken,userDisplayName:sfModel.userDisplayName,sessionState:mstrApp.sessionState};var cb={success:function(res){callback.success(res);},failure:function(res){callback.failure(res);}};mstrmojo.xhr.request("POST",mstrmojo.App.taskURL,cb,taskParams);};var _getToken=function getToken(sfModel,callback){var taskParams={taskId:"flashProxyLoader",headerRequest:"Authorization=OAuth "+sfModel.oAuth.accessToken,postData:sfModel.oAuth.getAuthorizationPostData(sfModel.code),sessionState:mstrApp.sessionState,url:"https://login.salesforce.com/services/oauth2/token"};var cb={success:function(res){sfModel.idUrl=res.id;sfModel.instanceUrl=res.instance_url;sfModel.signature=res.signature;sfModel.oAuth.refreshToken=res.refresh_token;sfModel.oAuth.accessToken=res.access_token;_getUserIdentity(sfModel,callback);},failure:function(res){callback.failure(res);}};mstrmojo.xhr.request("POST",mstrmojo.App.taskURL,cb,taskParams);};var _getUserIdentity=function getUserIdentity(sfModel,callback){var taskParams={taskId:"flashProxyLoader",headerRequest:"Authorization=OAuth "+sfModel.oAuth.accessToken,sessionState:mstrApp.sessionState,url:sfModel.idUrl};var cb={success:function(res){sfModel.userIdentity=res.id;sfModel.userDisplayName=res.display_name;_getReports(sfModel,callback);},failure:function(res){callback.failure(res);}};mstrmojo.xhr.request("POST",mstrmojo.App.taskURL,cb,taskParams);};var _oAuth=new mstrmojo.DI.OAuthSource({});mstrmojo.DI.SalesforceModel=mstrmojo.declare(mstrmojo.Obj,null,{id:"SalesforceModel",code:"",idUrl:"",instanceUrl:"",oAuth:_oAuth,signature:"",userDisplayName:"",userIdentity:"",getReports:function getReports(callback){_getToken(this,callback);}});}());