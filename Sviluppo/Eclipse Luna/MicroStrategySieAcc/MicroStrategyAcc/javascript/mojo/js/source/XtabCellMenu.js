(function(){var $ID="mstrXtabCellMenu",$SD="mstrmojo.all['"+$ID+"'].selectedData",$XT="mstrmojo.all['"+$ID+"'].xtab",$IB="mstrmojo-InteractiveButton",$BOX="mstrmojo.Box",$BOXC="mstrmojo-Menu-Box",$MN="mstrmojo.MenuItem";function fnClick(mth,args){var p=mstrmojo.all[$ID],xtab=p.xtab,newArgs=[p.selectedData].concat(args||[]);p.close();xtab[mth].apply(xtab,newArgs);}function fnClickLinkMenuItem(){fnClick("link",[this.index]);}function createMenuButton(t,c,fn,b){var btn={scriptClass:$MN,text:t,iconClass:"mstrmojo-oivmSprite "+c,cssClass:$IB,onclick:fn};if(b){btn.bindings=b;}return btn;}function createPivotButton(t,c,id){var b=createMenuButton(t,"tbPivot"+c,function(){fnClick("pivot",[id]);});b.bid=id;return b;}function createSortButton(t,c,b){return createMenuButton(t,"tbSort"+c,function(){fnClick("sort",[(b==="true")]);},{selected:"mstrmojo.all['"+$ID+"Sort'].so === "+b});}function createDrillButton(visible,xtab,data){if(!visible){return null;}var item=xtab.model.getCellDrillsInfo(data);if(!item||!item.k){return null;}return createMenuButton(mstrmojo.desc(183,"Drill to")+" "+(item.n||""),"tbDrill",function(){fnClick("drill");});}mstrmojo.XtabCellMenu=mstrmojo.registry.ref({id:$ID,slot:"popupNode",scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-Menu",shadowNodeCssClass:mstrmojo.dom.isIE?"mstrmojo-Menu-shadow":"",contentNodeCssClass:"mstrmojo-Menu-content",autoCloses:false,locksHover:true,updatePopupConfig:function(cfg){cfg=cfg||{};this.xtab=cfg.xtab;this.selectedNode=cfg.td;var data=this.selectedData=cfg.xtab&&cfg.td&&cfg.xtab.getCellForNode(cfg.td);this.onClose=cfg.onClose;var w=this.sortOptions;w.set("visible",((data&&data.at)||0)&8);w.set("so",data&&data.so);w=this.pivotOptions;var pVis=((data&&data.at)||0)&16;if(pVis){for(var i=0;i<6;i++){var c=w.children[i];c.set("visible",this.xtab.model.isPvtButtonVisible(data,c.bid));}}w.set("visible",pVis);w=this.linkOptions;w.set("visible",((data&&data.at)||0)&4);w=this.drillOptions;var v=((data&&data.at)||0)&1;w.set("visible",v);w.set("children",[createDrillButton(v,this.xtab,data)]);this.cfg=cfg;},onOpen:function(){var cfg=this.cfg,op=cfg.opener,opPos=op&&op.domNode&&mstrmojo.dom.position(op.domNode),opTop=opPos.y||0,cmPos=cfg.cmPos,x,y;if(cmPos){x=cmPos.x;y=cmPos.y-opTop;}else{var el=cfg.btn&&cfg.btn.domNode;var diff=mstrmojo.boxmodel.offset(el,op&&op[this.slot]);x=diff.left;y=diff.top+((el&&el.offsetHeight)||0);}var dim=mstrmojo.dom.windowDim(),dn=this.domNode;var h=dn.offsetHeight,bH=dim.h-opTop,diff=Math.max(0,y+h-bH);this.set("top",y-diff+"px");var w=dn.offsetWidth,bW=dim.w,diff=Math.max(0,x+w-bW);this.set("left",x-diff+"px");},children:[{id:$ID+"Links",alias:"linkOptions",scriptClass:$BOX,cssClass:$BOXC,visible:false,children:[{scriptClass:"mstrmojo.WidgetList",autoHide:true,itemFunction:function(item,idx){if(idx===0){mstrmojo.requiresCls($MN);}return new mstrmojo.MenuItem({text:item.n||item.url||(item.target&&(item.target.n||item.target.did)),cssClass:$IB,cssText:(idx===this.itemsInfo&&this.itemsInfo.di)?"font-weight: bold":"",index:idx,onclick:fnClickLinkMenuItem});},bindings:{itemsInfo:"this.parent.parent.visible ? "+$XT+".model.getCellLinksInfo("+$SD+") : null",items:"this.itemsInfo.links"}}]},{id:$ID+"Drill",alias:"drillOptions",scriptClass:$BOX,cssClass:$BOXC,visible:false},{id:$ID+"Sort",alias:"sortOptions",scriptClass:$BOX,cssClass:$BOXC,children:[createSortButton(mstrmojo.desc(7974,"Sort Ascending"),"Asc","true"),createSortButton(mstrmojo.desc(7975,"Sort Descending"),"Desc","false")]},{id:$ID+"Pivot",alias:"pivotOptions",scriptClass:$BOX,cssClass:$BOXC,children:[createPivotButton(mstrmojo.desc(5362,"Move Left"),"Left","l"),createPivotButton(mstrmojo.desc(5363,"Move Right"),"Right","r"),createPivotButton(mstrmojo.desc(7978,"Move Up"),"Up","u"),createPivotButton(mstrmojo.desc(7979,"Move Down"),"Down","d"),createPivotButton(mstrmojo.desc(7976,"Move to Columns"),"Cols","2"),createPivotButton(mstrmojo.desc(7977,"Move to Rows"),"Rows","1")]}]});})();