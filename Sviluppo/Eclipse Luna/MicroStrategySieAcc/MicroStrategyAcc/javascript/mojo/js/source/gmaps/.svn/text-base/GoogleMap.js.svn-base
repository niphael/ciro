googleMapScript=true;if(typeof (mstrmap)=="undefined"){mstrmap={};}if(typeof (mstrApp)=="undefined"){mstrApp={};}if(typeof (mstrmojo.gmaps)=="undefined"){mstrmojo.gmaps={};}(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.Button","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.SelectBox","mstrmojo.form","mstrmojo.array","mstrmojo.css","mstrmojo._HasPopup","mstrmojo._CanLoadMapExternalScript","mstrmojo.Vis","mstrmojo.gmaps.GoogleMapViewer","mstrmojo.Box","mstrmojo.gmaps._CanShowMapToolbar");var PRIMARY_DATA_PROVIDER=0;var SECONDARY_DATA_PROVIDER=1;var EnumMarkerType={MARKER:"1",BUBBLE:"2",POLYGON:"3",DENSITY:"4"};var EnumAreaSelectionType={RECTANGLE:1,CIRCLE:2,POLYGON:3};var $CSS=mstrmojo.css;mstrmojo.gmaps.GoogleMap=mstrmojo.declare(mstrmojo.Vis,[mstrmojo._HasPopup,mstrmojo._CanLoadMapExternalScript,mstrmojo.gmaps._CanShowMapToolbar,mstrmojo._Formattable],{scriptClass:"mstrmojo.gmaps.GoogleMap",iconClass:"",_affinityGlow:false,affinityEnabled:true,affinityLineColors:["#FF0000","#F98435","#EA0F87","#06CCC2"],bolAfterMouseDown:false,bounds:null,curpolygon:null,curpolygonList:null,curpolygonListBounds:null,loadingCount:0,defaultBounds:null,defaultZoom:1,refitContent:false,path:[],polyline:null,dragStart:false,freeFormPolylineList:[],freeFormPolygonList:[],freeFormEventListeners:[],circleList:[],circleEventListeners:[],_docModel:null,enableClickSelect:false,enableZoom:false,zoomChangeBoundsListener:null,fitBoundsTimer:null,min_longitude:180,max_longitude:-180,swlatLng:null,nelatLng:null,MAP_MIN_ZOOM_LEVEL:1,zoomRectangle:null,rectangleLengthLabel:null,rectangleHeightLabel:null,markerSelected:false,toolBarActive:false,drillable:true,enableDebug:true,enablePopup:true,enableRectangleSelect:false,enableFreeFormSelect:false,enableCircleSelect:false,formatHandlers:{domNode:["left","top","z-index","height","width"]},gridBone:null,gridDataViewer:null,gridKeysMap:null,gridNamesSelectorItems:null,gridParams:null,grids:null,height:"auto",infoWindowVisible:true,isCtrl:false,maxBubbleRadius:0,mouseDownHandler:null,mouseMoveHandler:null,mouseUpHandler:null,nextAffinityLineColorIndex:0,NO_OF_POINTS:20,overlay:null,params:{},_primaryGridIndex:0,registeredSDPKeys:null,secondaryDPFirstAttrColIndex:-1,secondaryDPSecondAttrColIndex:-1,searchBounds:null,startLatLng:null,sdpDataCache:null,title:"",totalLayersRendered:0,widgetProps:null,width:"auto",markupString:'<div id="{@id}" title="{@title}" sty="gmap" style="{@domNodeCssText};position:relative;width:{@width}px;" mstrAttach:click,mousedown,mouseup,drawEnd><div id="{@id}-toolbar" style="height:50px"></div><div id="{@id}-map" style="width:{@width}px;"></div><div id="{@id}-merticSelectDiv"></div><div id="{@id}-clearAllPopupDiv"></div><div id="{@id}-singleSelectPopupDiv"></div></div>',markupSlots:{mapDiv:function(){return this.domNode.childNodes[1];},toolBarDiv:function(){return this.domNode.firstChild;},merticSelectDiv:function(){return this.domNode.childNodes[2];},clearAllPopupDiv:function(){return this.domNode.childNodes[3];},singleSelectPopupDiv:function(){return this.domNode.childNodes[4];}},handleSingleSelection:function handleSingleSelection(apply){for(var i in this.gridDataViewer){if(!!this.gridDataViewer[i].previousState){var viewer=this.gridDataViewer[i];var columnIndex=viewer.previousState.columnIndex;if(apply){var currentSelections=viewer.getCurrentSelections(columnIndex);if(currentSelections.length>0){viewer.command.applySelection(viewer.savedSliceInfo);}}else{viewer.currentSelections[columnIndex]=viewer.previousState.currentSelections;viewer.selectedRowIndices[columnIndex]=viewer.previousState.selectedRowIndices;viewer.highlightedGraphics[columnIndex]=viewer.previousState.highlightedGraphics;var selectedObjList=viewer.previousState.mapObjectsState.selectedObj;var unselectedObjList=viewer.previousState.mapObjectsState.unselectedObj;for(var j in selectedObjList){var mapObj=selectedObjList[j];if(mapObj.onisSelectedChange){mapObj.set("isSelected",true);}else{mapObj.isSelected=true;}if(typeof (mapObj.hili)!="undefined"){mapObj.setIcon(mapObj.hili);}}for(var k in unselectedObjList){var mapObj=unselectedObjList[k];if(mapObj.onisSelectedChange){mapObj.set("isSelected",false);}else{mapObj.isSelected=false;}if(typeof (mapObj.image)!="undefined"){mapObj.setIcon(mapObj.image);}}}viewer.previousState=null;viewer.savedSliceInfo=[];}}this.set("markerSelected",!this.noMarkerSelected());},addGridLayer:function addGridLayer(layerIndex){this.gridDataViewer[layerIndex].render(true,this.refitContent,function(){this.doAreaSearchOnGridLayer(layerIndex);});},arrangeGridLayersVerticalOrderingOnMap:function arrangeGridLayersVerticalOrderingOnMap(){var tempGrid=[],primaryGridIndex;this.grids[0].isPrimary=true;for(var i=this.grids.length-1;i>=0;i--){if(this.grids[i].widgetProps.mtp===EnumMarkerType.BUBBLE){tempGrid.unshift(this.grids.splice(i,1)[0]);}else{if(this.grids[i].widgetProps.mtp===EnumMarkerType.MARKER){tempGrid.push(this.grids.splice(i,1)[0]);}}}for(var i=this.grids.length-1;i>=0;i--){if(this.grids[i].widgetProps.mtp===EnumMarkerType.DENSITY&&this.isCanvasSupported()){tempGrid.unshift(this.grids.splice(i,1)[0]);}else{tempGrid.push(this.grids.splice(i,1)[0]);}}for(var i=0;i<tempGrid.length;i++){if(tempGrid[i].isPrimary&&tempGrid[i].isPrimary==true){primaryGridIndex=i;}}this.grids=tempGrid.slice();return primaryGridIndex;},centerMap:function centerMap(){if(this.bounds){var totalRows=0;for(var i=0;i<this.gridDataViewer.length;i++){var mm=this.gridDataViewer[i].getMapModel(PRIMARY_DATA_PROVIDER);if(mm){totalRows+=mm.getTotalRows();}}if(totalRows>1){this.map.fitBounds(this.bounds);if(this.refitContent==false){this.map.setZoom(this.defaultZoom);}}else{this.map.setCenter(this.bounds.getCenter());if(this.refitContent==false){this.map.setZoom(this.defaultZoom);}else{this.map.setZoom(6);}}if(this.refitContent){var me=this;me.zoomChangeBoundsListener=google.maps.event.addListenerOnce(this.map,"bounds_changed",function(){var bounds=me.map.getBounds();var projection=me.overlay.getProjection();if(!bounds||!projection){return ;}var sw=projection.fromLatLngToContainerPixel(me.swlatLng);var ne=projection.fromLatLngToContainerPixel(me.nelatLng);if((sw.x>ne.x&&me.map.getZoom()>me.MAP_MIN_ZOOM_LEVEL)||ne.x>parseInt(me.width)){me.map.setCenter(me.bounds.getCenter());me.map.setZoom(me.MAP_MIN_ZOOM_LEVEL);}});}}},cleanMap:function cleanMap(){this.hideInfoWindow(null);},clearAllHighlight:function clearAllHighlight(){for(var i=0;i<this.gridDataViewer.length;i++){this.gridDataViewer[i].clearAllHighlight();}},clearSelections:function clearSelections(){for(var i=0;i<this.gridDataViewer.length;i++){var currentGridDataViewer=this.gridDataViewer[i];currentGridDataViewer.clearAllHighlight();currentGridDataViewer.currentSelections={};currentGridDataViewer.selectedRowIndices={};if(currentGridDataViewer.highlightedGraphics){currentGridDataViewer.highlightedGraphics={};}}},noMarkerSelected:function noMarkerSelected(){for(var i in this.gridDataViewer){var selections=this.gridDataViewer[i].currentSelections;if(!!selections){for(var j in selections){if(selections[j]&&selections[j].length>0){return false;}}}}return true;},noPolygonsPresentOnMap:function noPolygonsPresentOnMap(){if(this.curpolygonList&&this.curpolygonList.length>0||this.freeFormPolylineList.length>0||this.circleList.length>0){return false;}else{return true;}},createClusterBounds:function createClusterBounds(latlng,width,height){var mapBounds=this.map.getBounds();var mapNorthEast=mapBounds.getNorthEast();var mapSouthWest=mapBounds.getSouthWest();var mapEast=mapNorthEast.lng();var mapNorth=mapNorthEast.lat();var mapSouth=mapSouthWest.lat();var mapWest=mapSouthWest.lng();var latDistance=(mapEast>mapWest)?mapEast-mapWest:360+mapEast-mapWest;var pixelPerLng=this.width/latDistance;var pixelPerLat=this.height/(mapNorth-mapSouth);var south=latlng.lat()-height/pixelPerLat;var north=latlng.lat()+height/pixelPerLat;var east=latlng.lng()+width/pixelPerLng;var west=latlng.lng()-width/pixelPerLng;return new google.maps.LatLngBounds(new google.maps.LatLng(south,west),new google.maps.LatLng(north,east));},clearMap:function clearMap(){},createNewFormatWidgetPropsXML:function createNewFormatWidgetPropsXML(){var widgetPropsXml="<widgetProps><fmt>";var k,wps=this.getPrimaryGridViewer().getWidgetProps();for(k in wps){if(k=="sgProps"){continue;}widgetPropsXml+="<"+k+' value="'+this.encode(this.encode(wps[k]))+'" />';}widgetPropsXml+='<sgProps value="';var gridsValue="<sgProps>";for(var i=0;i<this.gridDataViewer.length;i++){if(i==this._primaryGridIndex){continue;}wps=this.gridDataViewer[i].getWidgetProps();gridsValue+='<g k="'+this.gridDataViewer[i].data.k+'">';for(k in wps){gridsValue+="<"+k+' value="'+wps[k]+'" />';}gridsValue+="</g>";}gridsValue+="</sgProps>";widgetPropsXml+=this.encode(this.encode(gridsValue));widgetPropsXml+='"/>';widgetPropsXml+="</fmt></widgetProps>";return widgetPropsXml;},createOldFormatWidgetPropsXML:function createOldFormatWidgetPropsXML(){var widgetPropsXml="<widgetProps><fmt>";var k;for(k in this.widgetProps){widgetPropsXml+="<"+k+' value="'+this.encode(this.encode(this.widgetProps[k]))+'" />';}var wps=this.gridDataViewer[this._primaryGridIndex].getWidgetProps();for(k in wps){widgetPropsXml+="<"+k+' value="'+this.encode(this.encode(wps[k]))+'" />';}widgetPropsXml+="</fmt></widgetProps>";return widgetPropsXml;},createSearchBounds:function createSearchBounds(startlatlng,endlatlng){var startlat=startlatlng.lat();var startlng=startlatlng.lng();var endlat=endlatlng.lat();var endlng=endlatlng.lng();var north,south,east,west;if(startlat>endlat){north=startlat;south=endlat;}else{north=endlat;south=startlat;}var projection=this.map.getProjection();var startPoint=projection.fromLatLngToPoint(startlatlng);var endPoint=projection.fromLatLngToPoint(endlatlng);if(startPoint.x<endPoint.x){west=startlng;east=endlng;}else{west=endlng;east=startlng;}return new google.maps.LatLngBounds(new google.maps.LatLng(south,west),new google.maps.LatLng(north,east));},createWidgetPropsXML:function createWidgetPropsXML(){if(!this.widgetProps.sgProps){return this.createOldFormatWidgetPropsXML();}else{return this.createNewFormatWidgetPropsXML();}},debug:function debug(s){if(this.enableDebug){}},destroy:function destroy(ignoreDom){var dm=this.fnGetDocModel();if(dm&&this.registeredSDPKeys){for(var key in this.registeredSDPKeys){dm.removeSDP(key);}}this._super(ignoreDom);},doClearRectangle:function doClearRectangle(forceClear){if(!forceClear&&!this.enableRectangleSelect){return ;}var i;for(i=0;i<this.freeFormEventListeners.length;i++){google.maps.event.removeListener(this.freeFormEventListeners[i]);}this.freeFormEventListeners.length=0;for(i=0;i<this.circleEventListeners.length;i++){google.maps.event.removeListener(this.circleEventListeners[i]);}this.circleEventListeners.length=0;if(this.curpolygonList){for(i=0;i<this.curpolygonList.length;i++){this.curpolygonList[i].setMap(null);this.curpolygonListBounds[i]=null;}this.curpolygonList.length=0;this.curpolygonListBounds.length=0;}for(i=0;i<this.freeFormPolylineList.length;i++){this.freeFormPolylineList[i].setMap(null);}this.freeFormPolylineList.length=0;for(i=0;i<this.freeFormPolygonList.length;i++){this.freeFormPolygonList[i].setMap(null);}this.freeFormPolygonList.length=0;for(i=0;i<this.circleList.length;i++){this.circleList[i].setMap(null);}this.circleList.length=0;},drawRectangleEnd:function drawRectangleEnd(event){if(!this.enableRectangleSelect&&!this.enableZoom){return ;}var startlatlng=this.startLatLng,endlatlng;if(event.latLng){endlatlng=event.latLng;}else{endlatlng=this.getLatLngFromPoint(event.clientX,event.clientY);}var path=[new google.maps.LatLng(startlatlng.lat(),startlatlng.lng()),new google.maps.LatLng(endlatlng.lat(),startlatlng.lng()),new google.maps.LatLng(endlatlng.lat(),endlatlng.lng()),new google.maps.LatLng(startlatlng.lat(),endlatlng.lng()),new google.maps.LatLng(startlatlng.lat(),startlatlng.lng())];if(this.enableRectangleSelect){this.curpolygon.setPath(path);this.searchBounds=this.createSearchBounds(startlatlng,endlatlng);this.curpolygonListBounds.push(this.searchBounds);var selectionType=EnumAreaSelectionType.RECTANGLE;for(var i=0;i<this.gridDataViewer.length;i++){this.gridDataViewer[i].drawRectangleEnd(this.searchBounds,selectionType);}this.set("markerSelected",!this.noMarkerSelected());this.setDrilLButtonEnable();}else{if(this.enableZoom){this.zoomRectangle.setPath(path);this.zoomRectangle._bounds.extend(endlatlng);var z=this.map.getZoom();this.map.fitBounds(this.zoomRectangle._bounds);if(this.map.getZoom()<z){this.map.setZoom(z);}var ne=new google.maps.LatLng(startlatlng.lat(),endlatlng.lng());var nw=new google.maps.LatLng(startlatlng.lat(),startlatlng.lng());var sw=new google.maps.LatLng(endlatlng.lat(),startlatlng.lng());var se=new google.maps.LatLng(endlatlng.lat(),endlatlng.lng());var path=[nw,sw,se,ne,nw];this.zoomRectangle.setPath(path);this.positionRectangleLengthLabel(nw,ne);this.positionRectangleHeightLabel(sw,nw);var me=this;var timer=window.setTimeout(function(){me.rectangleLengthLabel.style.display="none";me.rectangleHeightLabel.style.display="none";me.zoomRectangle.setMap(null);me.zoomRectangle=null;},0);}}},drawRectangleStart:function drawRectangleStart(event){var startlatlng;if(event.latLng){startlatlng=event.latLng;}else{startlatlng=this.getLatLngFromPoint(event.clientX,event.clientY);}var path=[new google.maps.LatLng(startlatlng.lat(),startlatlng.lng()),new google.maps.LatLng(startlatlng.lat(),startlatlng.lng()),new google.maps.LatLng(startlatlng.lat(),startlatlng.lng()),new google.maps.LatLng(startlatlng.lat(),startlatlng.lng()),new google.maps.LatLng(startlatlng.lat(),startlatlng.lng())];var polygonOptions;if(this.enableRectangleSelect){polygonOptions={paths:path,strokeColor:"#3d6d80",strokeWeight:2,strokeOpacity:1,fillColor:"#53D4FC",fillOpacity:0.6};}else{if(this.enableZoom){polygonOptions={paths:path,strokeColor:"#68228B",strokeWeight:2,strokeOpacity:1,fillColor:"#696969",fillOpacity:0.3};}}var polygon=new google.maps.Polygon(polygonOptions);var that=this;google.maps.event.addListener(polygon,"mousedown",function(event){that.onMouseDown(event);});google.maps.event.addListener(polygon,"mousemove",function(event){that.onMouseMove(event);});google.maps.event.addListener(polygon,"mouseup",function(event){that.onMouseUp(event);});this.startLatLng=startlatlng;if(this.enableRectangleSelect){this.curpolygon=polygon;this.curpolygon.setMap(this.map);this.curpolygonList.push(polygon);}else{if(this.enableZoom){this.zoomRectangle=polygon;this.zoomRectangle._bounds=new google.maps.LatLngBounds();this.zoomRectangle._bounds.extend(startlatlng);this.zoomRectangle.setMap(this.map);if(this.rectangleLengthLabel===null&&this.rectangleHeightLabel===null){this.rectangleLengthLabel=document.createElement("div");this.rectangleHeightLabel=document.createElement("div");this.rectangleHeightLabel.id="rectangleHeightLabel";this.mapDiv.appendChild(this.rectangleLengthLabel);this.mapDiv.appendChild(this.rectangleHeightLabel);$CSS.addClass(this.rectangleLengthLabel,"dimensionLabel");$CSS.addClass(this.rectangleHeightLabel,"dimensionLabel");}this.rectangleLengthLabel.style.display="none";this.rectangleHeightLabel.style.display="none";var lengthLabelMoveListener=google.maps.event.addDomListener(this.rectangleLengthLabel,"mousemove",function(event){that.onMouseMove(event);});var heightLabelMoveListener=google.maps.event.addDomListener(this.rectangleHeightLabel,"mousemove",function(event){that.onMouseMove(event);});var lengthLabelListener=google.maps.event.addDomListener(this.rectangleLengthLabel,"mouseup",function(event){that.onMouseUp(event);google.maps.event.removeListener(lengthLabelListener);google.maps.event.removeListener(lengthLabelMoveListener);google.maps.event.removeListener(heightLabelListener);google.maps.event.removeListener(heightLabelMoveListener);});var heightLabelListener=google.maps.event.addDomListener(this.rectangleHeightLabel,"mouseup",function(event){that.onMouseUp(event);google.maps.event.removeListener(heightLabelListener);google.maps.event.removeListener(heightLabelMoveListener);google.maps.event.removeListener(heightLabelListener);google.maps.event.removeListener(heightLabelMoveListener);});}}},encode:function encode(oldStr,toServer){var sb=oldStr;if(toServer==null){toServer=false;}if((oldStr!=null)&&(oldStr.length>0)){sb="";for(var i=0,len=oldStr.length;i<len;i++){switch(oldStr.charAt(i)){case"&":if((oldStr.length!=(i+1))&&(oldStr.charAt(i+1)=="#")){sb+="&";}else{sb+="&amp;";}break;case"<":sb+="&lt;";break;case">":sb+="&gt;";break;case"'":sb+="&#039;";break;case"\n":if(!toServer){sb+="<br />";}else{sb+=oldStr.charAt(i);}break;case'"':sb+="&quot;";break;case" ":if(i==0||(i<oldStr.length-1&&oldStr.charAt(i+1)==" ")){sb+="&nbsp;";}else{sb+=oldStr.charAt(i);}break;default:sb+=oldStr.charAt(i);break;}}}return sb;},findPanelStackAsInfoWindowSelectorTarget:function findPanelStackAsInfoWindowSelectorTarget(sc){var ifws=null;if(sc&&sc.tks){var dm=mstrApp.docModel,targets=sc.tks.split("\u001E");if(!dm){return ifws;}for(var i=0,len=targets.length;i<len;++i){var d=dm.getTargetDefn(targets[i]);if(d[targets[i]]&&d[targets[i]].ifw){if(!ifws){ifws=[];}ifws.push(targets[i]);}}}return ifws;},findPointsOnArc:function findPointsOnArc(from,to){var nPoints=this.NO_OF_POINTS;var coords=[];var radToDeg=180/Math.PI;var lat1=from.lat()/radToDeg;var lng1=from.lng()/radToDeg;var lat2=to.lat()/radToDeg;var lng2=to.lng()/radToDeg;var degree=2*Math.asin(Math.sqrt(Math.pow((Math.sin(lat1-lat2)/2),2)+Math.cos(lat1)*Math.cos(lat2)*Math.pow((Math.sin(lng1-lng2)/2),2)));var i;for(i=0;i<=this.NO_OF_POINTS;i++){var f=Number(i/nPoints);var a=Math.sin((1-f)*degree)/Math.sin(degree);var b=Math.sin(f*degree)/Math.sin(degree);var x=a*Math.cos(lat1)*Math.cos(lng1)+b*Math.cos(lat2)*Math.cos(lng2);var y=a*Math.cos(lat1)*Math.sin(lng1)+b*Math.cos(lat2)*Math.sin(lng2);var z=a*Math.sin(lat1)+b*Math.sin(lat2);var rLat=Math.atan2(z,Math.sqrt(Math.pow(x,2)+Math.pow(y,2)));var rLng=Math.atan2(y,x);coords[i]=new google.maps.LatLng(rLat*radToDeg,rLng*radToDeg);}return coords;},findPointsOnLine:function findPointsOnLine(from,to){var m=Infinity;var c;var pts=[];var interval;var lat;var lng;var i;if(to.lng()-from.lng()!=0){m=(to.lat()-from.lat())/(to.lng()-from.lng());c=from.lat()-m*from.lng();interval=(to.lng()-from.lng())/this.NO_OF_POINTS;}else{interval=(to.lat()-from.lat())/this.NO_OF_POINTS;}for(i=0;i<=this.NO_OF_POINTS;i++){if(m===Infinity){lng=from.lng();lat=from.lat()+interval*i;}else{lng=from.lng()+interval*i;lat=m*lng+c;}pts[i]=new google.maps.LatLng(lat,lng);}return pts;},findWrapperDom:function findWrapperDom(){return this.domNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;},fnGetDocModel:function fnGetDocModel(){return this._docModel;},fnGetWidget:function(_key){for(var i in mstrmojo.all){if(mstrmojo.all[i].k===_key){return mstrmojo.all[i];}}return null;},getBeanPath:function getBeanPath(){var beanPath=this.gridParams.beanPath;if(this.gridParams.isRW&&(typeof (microstrategy)!="undefined")){this.gridBone=microstrategy.bone(this.gridParams.boneId);if(!!this.gridBone){beanPath=this.gridBone.getDocViewer().beanPath;}}return beanPath;},getGeoIndex:function getGeoIndex(){return this.shapePosition;},getLatLngFromPoint:function getLatLngFromPoint(x,y){var position=mstrmojo.dom.position(this.domNode,true),xCord=x-position.x,yCord=y-position.y;var point=this.overlay.getProjection().fromContainerPixelToLatLng(new google.maps.Point(xCord,yCord));return point;},getNextDefaultAffinityLineColor:function getNextDefaultAffinityLineColor(){var colorIndex=this.nextAffinityLineColorIndex++;return this.affinityLineColors[colorIndex%(this.affinityLineColors.length-1)];},getPrimaryGridViewer:function getPrimaryGridViewer(){return this.gridDataViewer[this._primaryGridIndex];},getVisProps:function(gridParams){return this.model.vp;},handleAffinityAnimationKeyUp:function handleAffinityAnimationKeyUp(){for(var i=0;i<this.gridDataViewer.length;i++){this.gridDataViewer[i].handleAffinityAnimationKeyUp();}},hideInfoWindow:function hideInfoWindow(evt){if(this.infowindow){this.infowindow.close();}},initDocModel:function initDocModel(key){var _xtabModel=this.xtabModel||this.model;this._docModel=_xtabModel.docModel;},initMultipleDataProviders:function initMultipleDataProviders(gridParams){this.loadWidgetPropsAndGridData();this._primaryGridIndex=this.arrangeGridLayersVerticalOrderingOnMap();if(!this.grids){return ;}this.gridDataViewer=[];this.gridNamesSelectorItems=[];this.registeredSDPKeys=[];var key,xtab,dm=this.fnGetDocModel();this.gridKeysMap={};for(i=0;i<this.grids.length;i++){key=this.grids[i]["grid1"].k;xtab=this.fnGetWidget(key);this.gridDataViewer[i]=new mstrmojo.gmaps.GoogleMapViewer({parent:this,grids:this.grids[i],data:this.grids[i].grid1,widgetProps:this.grids[i].widgetProps,key:key,gridParams:gridParams,isPrimary:(i==this._primaryGridIndex)?true:false,_xTabModel:xtab&&(xtab.xtabModel||xtab.model),map:this.map,layerIndex:i});this.gridKeysMap[key]=i;this.gridNamesSelectorItems.push({v:i,n:this.grids[i]["grid1"].n,id:key});if(this.grids[i]["grid2"]){if(dm){dm.addSDP(this.grids[i]["grid2"].k,{k:this.grids[this._primaryGridIndex]["grid1"].k,visName:this.grids[this._primaryGridIndex]["grid1"].visName});this.registeredSDPKeys.push(this.grids[i]["grid2"].k);}}if(!this.gridDataViewer[i].isPrimary){if(dm){dm.addSDP(key,{k:this.grids[this._primaryGridIndex]["grid1"].k,visName:this.grids[this._primaryGridIndex]["grid1"].visName});this.registeredSDPKeys.push(key);}}}},isAsp:function isAsp(){return(microstrategy.servletName.indexOf("aspx")!=-1);},isCanvasSupported:function isCanvasSupported(){var elem=document.createElement("canvas");return !!(elem.getContext&&elem.getContext("2d"));},isToolbarPositionFixed:function isToolbarPositionFixed(){return false;},loadGoogleMap:function loadGoogleMap(mapping){this.bounds=new google.maps.LatLngBounds();var latlng=new google.maps.LatLng(31,-97);var myOptions={center:latlng,minZoom:this.MAP_MIN_ZOOM_LEVEL,zoom:4,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false};var controlOptions=null;var mapTypeIdsCustomized=[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.TERRAIN,google.maps.MapTypeId.HYBRID];for(var i in this.model.mstProp){mapTypeIdsCustomized.push(i);}if(this.model.vp!=undefined&&this.model.vp.mvo!=="0"){controlOptions={style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:mapTypeIdsCustomized};myOptions.mapTypeControlOptions=controlOptions;myOptions.mapTypeControl=true;}if(this.model.vp!=undefined&&this.model.vp.zb==="0"){myOptions.zoomControl=false;myOptions.panControl=false;myOptions.streetViewControl=false;}var element=document.getElementById(this.mapDiv.id);if(!element){return ;}this.map=new google.maps.Map(document.getElementById(this.mapDiv.id),myOptions);this.overlay=new google.maps.OverlayView();this.overlay.draw=function(){};this.overlay.setMap(this.map);this.loadMapTheme();if(this.model.vp.dv!==undefined){this.map.setMapTypeId(mapTypeIdsCustomized[this.model.vp.dv]);}this.refitContent=this.model.vp.rosa==="1"?true:false;this.infowindow=new google.maps.InfoWindow({content:"",hasShadow:false,maxWidth:500});this.initMultipleDataProviders(this.gridParams);for(var i=0;i<this.gridDataViewer.length;i++){try{this.gridDataViewer[i].render(false,true);}catch(e){mstrmojo.alert(e);}}this.prepareDivs();var that=this;google.maps.event.addListener(this.map,"bounds_changed",function(event){that.defaultBounds=that.map.getBounds();that.defaultZoom=that.map.getZoom();});mstrApp.docModel&&mstrApp.docModel.attachEventListener("secondaryDataSliced",this.id,function(evt){that.onSecondaryDataSliced(evt.key,evt.data);});google.maps.event.addListener(this.map,"mouseup",function(event){that.hideInfoWindow(event);for(var i=0;i<that.gridDataViewer.length;i++){that.gridDataViewer[i].handleMapOnMouseUp();}});google.maps.event.addListener(this.overlay,"projection_changed",function(event){for(var i=0;i<that.gridDataViewer.length;i++){that.gridDataViewer[i].doPostMapRendering();}});google.maps.event.addListener(this.map,"zoom_changed",function(event){for(var i=0;i<that.gridDataViewer.length;i++){that.gridDataViewer[i].doPostMapRendering();}});},loadMapTheme:function loadMapTheme(){var mstProp=this.model.mstProp;var nameList={4:"Desert",5:"Blank",6:"Ice",7:"Dark",8:"Nature",9:"Arctic"};var mapTypeList={};for(var i in mstProp){mapTypeList[i]=new google.maps.StyledMapType(eval("("+mstProp[i]+")"),{name:nameList[i]});}for(var name in mapTypeList){this.map.mapTypes.set(name,mapTypeList[name]);this.map.setMapTypeId(name);}},loadWidgetPropsAndGridData:function loadWidgetPropsAndGridData(){var M=this.model,sdpKey,i;if(!this.sdpDataCache&&!!M.sdp){this.sdpDataCache=M.sdp;}else{if(!!M.vp.sgProps&&!M.sdp){if(!!this.sdpDataCache){M.sdp=this.sdpDataCache;}}}this.initDocModel(M.k);this.grids=[];this.widgetProps=this.getVisProps(this.gridParams);this.grids[0]={grid1:M,grid2:null,widgetProps:M.vp};sdpKey=M.vp.ag;if(sdpKey&&M.sdp&&M.sdp[sdpKey]){this.grids[0].grid2=M.sdp[sdpKey];}i=1;if(M.vp.sgProps){for(var key in M.vp.sgProps){if(M.sdp&&M.sdp[key]){this.grids[i]={grid1:M.sdp[key],grid2:null,widgetProps:M.vp.sgProps[key]};sdpKey=this.grids[i].grid1.ag;if(sdpKey&&M.sdp[sdpKey]){this.grids[i].grid2=M.sdp[sdpKey];}i++;}}}},onAffinityAnimationModeChange:function onAffinityAnimationModeChange(){for(var ind=0;ind<this.gridDataViewer.length;ind++){this.gridDataViewer[ind].onAffinityAnimationModeChange();}},onenablePopupChange:function onenablePopupChange(){this.hideInfoWindow(null);},onenableRectangleSelectChange:function onenableRectangleSelectChange(){if(this.enableRectangleSelect){$CSS.addClass(this.mapDiv,"cursorDrawingArea");this.attachMouseListeners();if(!this.curpolygonList){this.curpolygonList=[];}if(!this.curpolygonListBounds){this.curpolygonListBounds=[];}}else{$CSS.removeClass(this.mapDiv,"cursorDrawingArea");this.detachMouseListeners();}},onenableZoomChange:function onenableZoomChange(){if(this.enableZoom){this.attachMouseListeners();}else{this.detachMouseListeners();}},onenableFreeFormSelectChange:function onenableFreeFormSelectChange(){if(this.enableFreeFormSelect){$CSS.addClass(this.mapDiv,"cursorDrawingArea");this.attachMouseListeners();}else{$CSS.removeClass(this.mapDiv,"cursorDrawingArea");this.detachMouseListeners();}},attachMouseListeners:function attachMouseListeners(){this.toggleDragging(false);var that=this;this.mouseDownHandler=google.maps.event.addListener(this.map,"mousedown",function(evt){that.onMouseDown(evt);});this.mouseMoveHandler=google.maps.event.addListener(this.map,"mousemove",function(evt){that.onMouseMove(evt);});this.mouseUpHandler=google.maps.event.addListener(this.map,"mouseup",function(evt){that.onMouseUp(evt);});},detachMouseListeners:function detachMouseListeners(){this.toggleDragging(true);if(this.mouseDownHandler){google.maps.event.removeListener(this.mouseDownHandler);this.mouseDownHandler=null;}if(this.mouseMoveHandler){google.maps.event.removeListener(this.mouseMoveHandler);this.mouseMoveHandler=null;}if(this.mouseUpHandler){google.maps.event.removeListener(this.mouseUpHandler);this.mouseUpHandler=null;}},onenableCircleSelectChange:function onenableCircleSelectChange(){if(this.enableCircleSelect){this.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.CIRCLE,drawingControl:false,drawingControlOptions:{drawingModes:[google.maps.drawing.OverlayType.CIRCLE]},circleOptions:{editable:false,strokeColor:"#3d6d80",strokeWeight:2,fillColor:"#53D4FC",fillOpacity:0.6}});this.drawingManager.setMap(this.map);var that=this;this.overlaycompleteHandler=google.maps.event.addListener(this.drawingManager,"circlecomplete",function(circle){that.circleList.push(circle);var circleMouseupListener=google.maps.event.addListener(circle,"mouseup",function(evt){that.onMouseUp(evt);});var circleMouseMoveListener=google.maps.event.addListener(circle,"mousemove",function(evt){that.onMouseMove(evt);});that.circleEventListeners.push(circleMouseupListener,circleMouseMoveListener);var selectionType=EnumAreaSelectionType.CIRCLE;for(var i=0;i<that.gridDataViewer.length;i++){that.gridDataViewer[i].drawRectangleEnd(circle,selectionType);}that.set("markerSelected",!that.noMarkerSelected());that.setDrilLButtonEnable();that.setToolbarState(0);});}else{this.drawingManager.setMap(null);this.drawingManager=null;}},onmarkerSelectedChange:function onmarkerSelectedChange(){this.setClearAllButtonEnable(this.markerSelected);if(this.drillable){this.setDrilLButtonEnable();}},onMouseDown:function onMouseDown(event){if(this.enableRectangleSelect||this.enableZoom){if(this.enableZoom&&(event.latLng==undefined&&event.button==2||event.Sa!=undefined&&event.Sa.button==2)){return ;}this.bolAfterMouseDown=true;this.drawRectangleStart(event);}else{if(this.enableFreeFormSelect){var startlatlng;if(event.latLng){startlatlng=event.latLng;}this.path=[];this.path.push(startlatlng);this.polyline=new google.maps.Polyline({paths:this.path,strokeColor:"#3d6d80",strokeWeight:2,strokeOpacity:1});this.freeFormPolylineList.push(this.polyline);this.polyline.setMap(this.map);this.dragStart=true;var that=this;var freeFormMouseupListener=google.maps.event.addListener(this.polyline,"mouseup",function(evt){that.onMouseUp(evt);});var freeFormMouseMoveListener=google.maps.event.addListener(this.polyline,"mousemove",function(evt){that.onMouseMove(evt);});this.freeFormEventListeners.push(freeFormMouseupListener,freeFormMouseMoveListener);}else{return ;}}},onMouseMove:function onMouseMove(event){if(this.enableRectangleSelect||this.enableZoom){var startlatlng=this.startLatLng;var currentLatLng;if(event.latLng){currentLatLng=event.latLng;}else{currentLatLng=this.getLatLngFromPoint(event.clientX,event.clientY);}if(this.bolAfterMouseDown){var nw=new google.maps.LatLng(startlatlng.lat(),startlatlng.lng()),sw=new google.maps.LatLng(currentLatLng.lat(),startlatlng.lng()),se=new google.maps.LatLng(currentLatLng.lat(),currentLatLng.lng()),ne=new google.maps.LatLng(startlatlng.lat(),currentLatLng.lng()),path=[nw,sw,se,ne,nw];if(this.enableRectangleSelect){this.curpolygon.setPath(path);}else{if(this.enableZoom){this.zoomRectangle.setPath(path);var area=Math.round(google.maps.geometry.spherical.computeLength([nw,ne])/1500);this.positionRectangleLengthLabel(nw,ne);this.rectangleLengthLabel.innerHTML=area+" "+mstrmojo.desc(11140,"Miles");area=Math.round(google.maps.geometry.spherical.computeLength([nw,sw])/1500);this.positionRectangleHeightLabel(sw,nw);this.rectangleHeightLabel.innerHTML=area+" "+mstrmojo.desc(11140,"Miles");if(this.rectangleLengthLabel.style.display==="none"&&this.rectangleHeightLabel.style.display==="none"){this.rectangleLengthLabel.style.display="inline-block";this.rectangleHeightLabel.style.display="inline-block";}}}}}else{if(this.enableFreeFormSelect){if(this.dragStart){var currentLatLng;if(event.latLng){currentLatLng=event.latLng;}this.path.push(currentLatLng);this.polyline.setPath(this.path);}}else{return ;}}},onMouseUp:function onMouseUp(event){if(this.enableRectangleSelect||this.enableZoom){if(this.enableZoom&&(event.latLng==undefined&&event.button==2||event.Sa!=undefined&&event.Sa.button==2)){return ;}this.bolAfterMouseDown=false;this.drawRectangleEnd(event);this.setToolbarState(0);}else{if(this.enableFreeFormSelect){if(this.dragStart){var currentLatLng;if(event.latLng){currentLatLng=event.latLng;}this.path.push(currentLatLng);this.polyline.setPath(this.path);var polygon=new google.maps.Polygon({paths:this.path,strokeColor:"#3d6d80",strokeWeight:2,strokeOpacity:1,fillColor:"#53D4FC",fillOpacity:0.6});this.freeFormPolygonList.push(polygon);var selectionType=EnumAreaSelectionType.POLYGON;for(var i=0;i<this.gridDataViewer.length;i++){this.gridDataViewer[i].drawRectangleEnd(polygon,selectionType);}polygon.setMap(this.map);var that=this;var freeFormMouseupListener=google.maps.event.addListener(polygon,"mouseup",function(evt){that.onMouseUp(evt);});var freeFormMouseMoveListener=google.maps.event.addListener(polygon,"mousemove",function(evt){that.onMouseMove(evt);});this.freeFormEventListeners.push(freeFormMouseupListener,freeFormMouseMoveListener);this.dragStart=false;this.set("markerSelected",!this.noMarkerSelected());this.setDrilLButtonEnable();}this.setToolbarState(0);}else{return ;}}},positionRectangleLengthLabel:function positionRectangleLengthLabel(nw,ne){var nePos=this.overlay.getProjection().fromLatLngToContainerPixel(ne);var nwPos=this.overlay.getProjection().fromLatLngToContainerPixel(nw);var xPos=Math.abs(nwPos.x+(nePos.x-nwPos.x)/2);var lengthLabelCssObject=$CSS.getComputedStyle(this.rectangleLengthLabel),lengthLabelHeight=Math.abs(this.getPropertyValue(lengthLabelCssObject,"height")),lengthLabelWidth=Math.abs(this.getPropertyValue(lengthLabelCssObject,"width")),lengthLabelPadding=Math.abs(this.getPropertyValue(lengthLabelCssObject,"padding")),lengthLabelBorder=Math.abs(this.getPropertyValue(lengthLabelCssObject,"border"));if(Math.abs(nePos.x-nwPos.x)<lengthLabelWidth){this.rectangleLengthLabel.style.left=nwPos.x+"px";}else{this.rectangleLengthLabel.style.left=xPos+"px";}this.rectangleLengthLabel.style.top=nePos.y-(lengthLabelHeight+2*lengthLabelPadding+2*lengthLabelBorder)+"px";},positionRectangleHeightLabel:function positionRectangleHeightLabel(sw,nw){var swPos=this.overlay.getProjection().fromLatLngToContainerPixel(sw);var nwPos=this.overlay.getProjection().fromLatLngToContainerPixel(nw);var yPos=Math.abs(nwPos.y+(swPos.y-nwPos.y)/2);var heightLabelCssObject=$CSS.getComputedStyle(this.rectangleHeightLabel),heightLabelHeight=Math.abs(this.getPropertyValue(heightLabelCssObject,"height")),heightLabelWidth=Math.abs(this.getPropertyValue(heightLabelCssObject,"width")),heightLabelPadding=Math.abs(this.getPropertyValue(heightLabelCssObject,"padding")),heightLabelBorder=Math.abs(this.getPropertyValue(heightLabelCssObject,"border"));if(Math.abs(swPos.y-nwPos.y)<heightLabelWidth){this.rectangleHeightLabel.style.top=nwPos.y+"px";}else{this.rectangleHeightLabel.style.top=yPos+"px";}this.rectangleHeightLabel.style.left=(nwPos.x-2*(heightLabelHeight+heightLabelPadding+heightLabelBorder)-2)+"px";},onSecondaryDataSliced:function onSecondaryDataSliced(key,data){var ind=-1,sdp=this.fnGetDocModel().sdp;if(!!this.gridKeysMap[key]){ind=this.gridKeysMap[key];}if(ind!=-1){this.gridDataViewer[ind].resetModel(data);}if(sdp&&sdp[key]){if(this.model.sdp&&this.model.sdp[key]){this.model.sdp[key]=data;}ind=this.gridKeysMap[sdp[key].k];this.gridDataViewer[ind].resetAffinityLinesData(data);}},onselectedMetricIndexChange:function onselectedMetricIndexChange(gridIndex,metricIndex,metricId){this.debug("selected metric Index Changed");this.gridDataViewer[gridIndex].selectedMetricIndexChange(metricIndex,metricId);},onShow:function onShow(){if(this.map){google.maps.event.trigger(this.map,"resize");if(this.bounds){this.map.setCenter(this.bounds.getCenter());this.map.fitBounds(this.bounds);}}},onStartLoadGoogleMap:function onStartLoadGoogleMap(){var that=this;document.onkeydown=function(evt){that.processMapKeydown(evt);};document.onkeyup=function(evt){that.processMapKeyup(evt);};if(typeof (microstrategy)!="undefined"){this.gridBone=microstrategy.bone(this.gridParams.boneId);}this.loadGoogleMap(null);mstrmojo.gmaps.GoogleMap.newMapViewer(this);var toolbar=this.getToolbar();mstrmap[this.gridParams.boneId]=toolbar&&toolbar.id;},doAreaSearchOnGridLayer:function doAreaSearchOnGridLayer(layerIndex){if(this.curpolygonListBounds&&this.curpolygonListBounds.length>0){this.searchMarkersOnGridLayer(this.curpolygonListBounds,EnumAreaSelectionType.RECTANGLE,layerIndex);}if(this.circleList&&this.circleList.length>0){this.searchMarkersOnGridLayer(this.circleList,EnumAreaSelectionType.CIRCLE,layerIndex);}if(this.freeFormPolygonList&&this.freeFormPolygonList.length>0){this.searchMarkersOnGridLayer(this.freeFormPolygonList,EnumAreaSelectionType.POLYGON,layerIndex);}this.set("markerSelected",!this.noMarkerSelected());this.setDrilLButtonEnable();},searchMarkersOnGridLayer:function searchMarkersOnGridLayer(boundsList,selectionType,layerIndex){for(var i=0;i<boundsList.length;i++){this.gridDataViewer[layerIndex].drawRectangleEnd(boundsList[i],selectionType);}},persistWidgetProps:function persistWidgetProps(){if(this.widgetProps){var widgetPropsXml=this.createWidgetPropsXML();var ac=[];this.gridBone.setVisualizationSettings(null,null,null,null,ac,widgetPropsXml);this.gridBone.um.add(ac);this.gridBone.um.flushAndSubmitChanges();}},postBuildRendering:function postBuildRendering(){this._super();if(this.getModel().eg){this.mapDiv.innerHTML='<div class="map-err-message" style = "font-size:15px;height:100%;width:100%;background-color:white;color:black">'+this.getModel().eg+"</div>";return ;}if(!this.gridParams.clientId&&!this.gridParams.trialKey){this.mapDiv.innerHTML='<div class="map-err-message" style = "font-size:15px;height:100%;width:100%;background-color:white;color:black">'+mstrmojo.desc(11186,"The Google map requires a valid key")+"</div>";return ;}this.loadingCount++;if(!!this.gridParams.clientId){this.setPremiere(true);this.setPremiereKey(this.gridParams.clientId);}else{this.setTrialKey(this.gridParams.trialKey);}this.setLocaleLang(this.gridParams.lang);this.setLocaleRegion(this.gridParams.region);if(!!this.gridParams.channel){this.setChannel(this.gridParams.channel);}this.width=parseInt(this.width,10);this.height=parseInt(this.height,10);this.mapDiv.style.width=this.width+"px";this.mapDiv.style.height=this.height+"px";this.min_longitude=180;this.max_longitude=-180;if(mstrmojo.googleMapLib===undefined){mstrmojo.googleMapLib={};mstrmojo.gmaps.loadScriptListeners=[];this.loadExternalScript(this.onStartLoadGoogleMap,this);}else{var me=this;if(typeof (mstrmojo.googleMapLibLoaded)!=="undefined"&&mstrmojo.googleMapLibLoaded==true){this.onStartLoadGoogleMap();}else{mstrmojo.gmaps.loadScriptListeners.push(function(){me.onStartLoadGoogleMap();});}}},prepareDivs:function prepareDivs(){this.infoTabDiv=document.createElement("div");this.infoTabDiv.id="infoDiv";this.infoTabDiv.style.paddingTop="3px";this.infoTabDiv.style.overflow="auto";this.infoTabDiv.style.maxWidth="640px";this.infoTabDiv.style.maxHeight="200px";var table=document.createElement("table"),tableHead=document.createElement("tHead"),tableBody=document.createElement("tBody"),cssString,isIE=(navigator.appVersion.indexOf("MSIE")!=-1)?true:false;table.setAttribute("cellspacing","0");table.setAttribute("cellpadding","2");table.appendChild(tableHead);table.appendChild(tableBody);this.infoTabDiv.appendChild(table);cssString=this.gridDataViewer[this._primaryGridIndex].getMapModel(PRIMARY_DATA_PROVIDER).getCSSString();if(cssString!==undefined){var cssStyle=document.createElement("style");cssStyle.type="text/css";var node=cssStyle.styleSheet||cssStyle;if(mstrmojo.dom.isWK){if(node.firstChild){node.firstChild.nodeValue=cssString;}else{node.appendChild(document.createTextNode(cssString));}}else{node[mstrmojo.dom.isIE?"cssText":"innerHTML"]=cssString;}this.infoTabDiv.appendChild(cssStyle);}},processDrill:function processDrillRequest(){for(var i=0;i<this.gridDataViewer.length;i++){this.gridDataViewer[i].processDrill();}},processMapKeydown:function processMapKeydown(_event_){var winObj;if(window.event){winObj=window.event;}else{winObj=_event_;}var intCtrlKey=winObj.ctrlKey;if(intCtrlKey){var oldValue=this.isCtrl;this.isCtrl=true;}},processMapKeyup:function processMapKeyup(_event_){var winObj;if(window.event){winObj=window.event;}else{winObj=_event_;}var intCtrlKey=winObj.ctrlKey;if(!intCtrlKey){this.handleAffinityAnimationKeyUp();this.isCtrl=false;}},removeGridLayer:function removeGridLayer(layerIndex){this.gridDataViewer[layerIndex].unrender();if(this.gridDataViewer[layerIndex].currentSelections){this.gridDataViewer[layerIndex].currentSelections={};}if(this.gridDataViewer[layerIndex].selectedRowIndices){this.gridDataViewer[layerIndex].selectedRowIndices={};}if(this.gridDataViewer[layerIndex].highlightedGraphics){this.gridDataViewer[layerIndex].highlightedGraphics={};}},saveCustomInfo:function saveCustomInfo(){this.persistWidgetProps();this.closePopup();},setDrilLButtonEnable:function setDrillButtonEnable(){var enabled=false;for(var i=0;i<this.gridDataViewer.length;i++){if(this.gridDataViewer[i].primaryModel.getTotalRows()>0&&this.gridDataViewer[i].getDrillStatus()){enabled=true;break;}}this.setToolbarButtonState(this.EnumToolbarButtonType.DRILL,"enabled",enabled);},isDrillable:function isDrillable(){for(var i=0;i<this.gridDataViewer.length;i++){if(this.gridDataViewer[i].primaryModel.getTotalRows()>0&&this.gridDataViewer[i].getDrillStatus()){return true;}}return false;},isMapDrillEnabled:function isMapDrillEnabled(){var PRIMARY_DATA_PROVIDER=0;var HYPERLINK_ACTION=4;for(var i=0;i<this.gridDataViewer.length;i++){var index=this.gridDataViewer[i].getGeoColumnIndex();if(this.gridDataViewer[i].getMapModel(PRIMARY_DATA_PROVIDER).getTotalRows()==0){continue;}var actionType=this.gridDataViewer[i].getMapModel(PRIMARY_DATA_PROVIDER).getRowHeaders(0).getHeader(index).getActionType();if(actionType===undefined||isNaN(actionType)){continue;}if((actionType&HYPERLINK_ACTION)>0){return true;}}return false;},isSelectedDensity:function isSelectedDensity(layerChosen){for(var i in layerChosen){var gridViewer=this.gridDataViewer[layerChosen[i]];if(gridViewer.wpMarkerType!=EnumMarkerType.DENSITY){return false;}}return true;},setClearAllButtonEnable:function setClearAllButtonEnable(enableFlag){this.setToolbarButtonState(this.EnumToolbarButtonType.CLEAR_ALL,"enabled",enableFlag);},shapeDrill:function shapeDrill(){this.doDrill(this.shapePosition);},toggleDragging:function toggleDragging(bolEnableDrag){var opts={draggable:bolEnableDrag};this.map.setOptions(opts);},updateMapExtent:function updateMapExtent(loadByGridChange){if(!loadByGridChange){this.totalLayersRendered++;if(this.totalLayersRendered!=this.gridDataViewer.length){return ;}this.totalLayersRendered=0;}if(this.defaultBounds==null){this.defaultBounds=new google.maps.LatLngBounds();this.defaultZoom=this.map.getZoom();for(var i=0;i<this.gridDataViewer.length;i++){this.defaultBounds.union(this.gridDataViewer[i].getBounds());}}if(this.refitContent==true){if(loadByGridChange==true){this.bounds=this.layerChosen.length==0?this.defaultBounds:new google.maps.LatLngBounds();for(var i in this.layerChosen){this.bounds.union(this.gridDataViewer[this.layerChosen[i]].getBounds());}}else{for(var i=0;i<this.gridDataViewer.length;i++){this.bounds.union(this.gridDataViewer[i].getBounds());}}}else{this.bounds=this.defaultBounds;}this.centerMap();},updateMinMaxLatLng:function updateMinMaxLatLng(latlng){if(this.min_longitude>latlng.lng()){this.min_longitude=latlng.lng();this.swlatLng=latlng;}if(this.max_longitude<latlng.lng()){this.max_longitude=latlng.lng();this.nelatLng=latlng;}},updateMaxBubbleRadius:function updateMaxBubbleRadius(radius){if(radius>this.maxBubbleRadius){this.maxBubbleRadius=radius;}},isMapEnabledAffinityLine:function isMapEnabledAffinityLine(){for(var i=0;i<this.gridDataViewer.length;i++){if(this.gridDataViewer[i].isAffinityLinesEnabled()){return true;}}return false;}});mstrmojo.gmaps.GoogleMap.newMapViewer=function newMapViewer(map,scriptClass){var url=unescape(map.gridParams.params),splitUrl=url.split("?"),baseUrl=splitUrl[0],params=splitUrl[1].split("&"),splitParams={},p,scriptClass=scriptClass?scriptClass:"mstrmojo.gmaps.GoogleMap";for(p in params){if(params.hasOwnProperty(p)){var param=params[p].split("=");map.gridParams[param[0]]=param[1];}}mstrApp.localeId=map.gridParams.localeId;map.gridParams.includeOptimizedDrillPathSetting="true";mstrmojo.gmaps.GoogleMap.initMapViewer(map,scriptClass);};mstrmojo.gmaps.GoogleMap.initMapViewer=function initMapViewer(googlemap){var placeholder=googlemap.toolBarDiv.id,merticSelectPlaceholder=googlemap.merticSelectDiv.id,clearAllPopupPlaceholder=googlemap.clearAllPopupDiv.id,singleSelectPopupPlaceholder=googlemap.singleSelectPopupDiv.id,gridParams=googlemap.gridParams,metricData=[],metricsString=mstrmojo.desc(1158,"Metrics");for(var ind=0;ind<googlemap.gridDataViewer.length;ind++){if(googlemap.gridDataViewer[ind].getMapModel(PRIMARY_DATA_PROVIDER).getTotalRows()==0){continue;}cols=googlemap.gridDataViewer[ind].getMapModel(PRIMARY_DATA_PROVIDER).getColTitles();metricData[ind]={metrics:[],gridName:googlemap.gridDataViewer[ind].getLayerGridName()};for(var i=0;i<cols.size();i++){col=cols.getTitle(i);if(col.getName()==metricsString){var es=col.getHeaderValues();for(j=0;j<es.length;j++){var o={v:j,n:es[j].n,id:es[j].id,gIdx:ind};metricData[ind].metrics.push(o);}break;}}}var oldId=mstrmap[gridParams.boneId];var oldContainer=mstrmojo.all[oldId];if(oldContainer){oldContainer.destroy();}if(googlemap.model.vp!=undefined&&googlemap.model.vp.mt!=="0"){var toolbarButtonsFlag=googlemap.EnumToolbarButtonType.SINGLE_SELECT|googlemap.EnumToolbarButtonType.RECTANGLE_SELECT|googlemap.EnumToolbarButtonType.CLEAR_ALL|googlemap.EnumToolbarButtonType.AFFINITY|googlemap.EnumToolbarButtonType.DRILL|googlemap.EnumToolbarButtonType.FREE_SELECT|googlemap.EnumToolbarButtonType.CIRCLE_SELECT|googlemap.EnumToolbarButtonType.ZOOM;googlemap.initMapToolbar(googlemap,metricData,toolbarButtonsFlag,placeholder,merticSelectPlaceholder,clearAllPopupPlaceholder,singleSelectPopupPlaceholder);googlemap.renderToolbar();googlemap.mapDiv.style.height=parseInt(googlemap.height,10)+"px";}};})();