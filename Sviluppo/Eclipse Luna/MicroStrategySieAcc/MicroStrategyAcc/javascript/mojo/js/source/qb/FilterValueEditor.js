(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.Label","mstrmojo.Editor");var $H=mstrmojo.hash;var LIST_OPERATOR={2219:" IN ",2220:"[Not In]"},STRING_OPERATOR={525:" LIKE ",526:"[Not Like]",686:" Contains ",2784:"[Not Contains]",687:"[Begins With]",2785:"[Not Begins With]",688:"[Ends with]",2786:"[Not ends with]"},LOGICAL_OPERATORS=$H.copy(LIST_OPERATOR,{520:"=",612:"<>",521:">",523:"<",522:">=",524:"<=",Between:" between ","Not between":"[Not Between]"});LOGICAL_OPERATORS=$H.copy(STRING_OPERATOR,LOGICAL_OPERATORS);var SEP=",",SINGLE_QUOTE="'",DOUBLE_QUOTE='"',HAS_QUOTE={"'":1,'"':1};function getDateTimeFormat(value){var length=value.length;value=value.substring(HAS_QUOTE[value[0]]?1:0,(HAS_QUOTE[value[length-1]]?length-1:length));return[SINGLE_QUOTE,value,SINGLE_QUOTE].join("");}function preprocessBigDecimalValue(value){var result=value.toString();if(result.match(/#\d+#/)){return result;}return"#"+result+"#";}function preprocessDateTimeValue(dtvalue){var tempArray=dtvalue.split(SEP),result=[];mstrmojo.array.forEach(tempArray,function(value){result.push(getDateTimeFormat(value));});return result.join(SEP);}mstrmojo.qb.FilterValueEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.FilterValueEditor",zIndex:100,id:"fve1",title:mstrmojo.desc(9124,"Enter Value"),cssClass:"mstrmojo-qb-filtervalue-editor",help:(mstrApp.helpTopics&&mstrApp.helpTopics.filterValue)||"Enter_Value_dialog_box.htm",column:null,operatorID:null,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-filtervalue-box",alias:"box",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-qb-filtervalue-name",alias:"filter"},{scriptClass:"mstrmojo.TextBox",alias:"txtname",cssClass:"mstrmojo-qb-filtervalue-textbox"}]},{scriptClass:"mstrmojo.Label",alias:"err",cssClass:"mstrmojo-qb-filtervalue-errmsg",text:""},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",cssText:"float:right;",text:mstrmojo.desc(1442,"OK"),onclick:function onclick(){var filterEditor=this.parent.parent,box=filterEditor.box,operatorID=filterEditor.operatorID,filterValue=filterEditor.box.txtname.value,isDateTime=filterEditor.isDateTime,expression;if(filterValue==""){return ;}if(isDateTime){filterValue=preprocessDateTimeValue(filterValue);}if(filterEditor.isBigDecimal){filterValue=preprocessBigDecimalValue(value);}if(STRING_OPERATOR[operatorID]){filterValue=DOUBLE_QUOTE+filterValue+DOUBLE_QUOTE;}if(LIST_OPERATOR[operatorID]){filterValue="("+filterValue+")";}expression=[mstrmojo.all.QBuilderModel.brackets(filterEditor.column)," ",LOGICAL_OPERATORS[filterEditor.operatorID]," ",filterValue].join("");mstrApp.getRootController().parseExpression({expr:expression,qbrex:2,cIndex:1,vo:1},{success:function(res){if(res&&res.mi){var mi=res.mi,errormsg=mi.reject_error_description;if(errormsg){if(isDateTime&&mi.reject_error_code===-2147214817){errormsg="(Please enter a valid date/time value.)";}filterEditor.err.set("text",errormsg);}else{filterEditor.close();mstrApp.getRootController().addNewFilter({et:"*",expr:mi.tknstrm.mi.tkn,n:expression,sqltp:mi.exp.sqltp});}}}});}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(evt){var e=this.parent.parent;if(e.onCancel){e.onCancel();}e.close();}}]}],onOpen:function onOpen(){var box=this.box,txtname=box.txtname;this.err.set("text","");box.filter.set("text",this.n);txtname.set("value","");txtname.focus();}});mstrmojo.qb.FilterValueEditor2=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.FilterValueEditor2",zIndex:100,id:"fve2",title:mstrmojo.desc(9124,"Enter Value"),cssText:"width:260px;",help:(mstrApp.helpTopics&&mstrApp.helpTopics.filterValue)||"Enter_Value_dialog_box.htm",column:null,children:[{scriptClass:"mstrmojo.HBox",alias:"box",cssClass:"mstrmojo-qb-filtervalue-box",children:[{scriptClass:"mstrmojo.Label",alias:"filter"},{scriptClass:"mstrmojo.TextBox",alias:"txtname1",cssClass:"mstrmojo-qb-filtervalue-textbox2"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(5282,"AND"),cssText:"width:30px;"},{scriptClass:"mstrmojo.TextBox",alias:"txtname2",cssClass:"mstrmojo-qb-filtervalue-textbox2"}]},{scriptClass:"mstrmojo.Label",alias:"err",cssClass:"mstrmojo-qb-filtervalue-errmsg",text:""},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",cssText:"float:right;",text:mstrmojo.desc(1442,"OK"),onclick:function onclick(){var filterEditor=this.parent.parent,box=filterEditor.children[0],value1=box.txtname1.value,value2=box.txtname2.value,isDateTime=filterEditor.isDateTime,expresion;if(value1==""||value2==""){return ;}if(isDateTime){value1=preprocessDateTimeValue(value1);value2=preprocessDateTimeValue(value2);}else{if(filterEditor.isBigDecimal){value1=preprocessBigDecimalValue(value1);value2=preprocessBigDecimalValue(value2);}}expression=[mstrmojo.all.QBuilderModel.brackets(filterEditor.column)," ",LOGICAL_OPERATORS[filterEditor.operatorID]," ",value1," AND ",value2].join("");mstrApp.getRootController().parseExpression({expr:expression,qbrex:2,cIndex:1,vo:1},{success:function(res){if(res&&res.mi){var mi=res.mi,errormsg=mi.reject_error_description;if(errormsg){if(isDateTime&&mi.reject_error_code===-2147214817){errormsg="(Please enter a valid date/time value.)";}filterEditor.err.set("text",errormsg);}else{filterEditor.close();mstrApp.getRootController().addNewFilter({et:"*",expr:mi.tknstrm.mi.tkn,n:expression,sqltp:mi.exp.sqltp});}}}});}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(evt){var e=this.parent.parent;if(e.onCancel){e.onCancel();}e.close();}}]}],onOpen:function onOpen(){var box=this.box,txtname1=box.txtname1;this.err.set("text","");box.filter.set("text",this.n);box.txtname2.set("value","");txtname1.set("value","");txtname1.focus();}});})();